<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GiDCity –ú–µ–Ω—é</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --purple:#b37aff; --green:#7BFF5A; --text:#fff;
    --bg1:#000; --bg2:#2b0040; --bg3:#500080;
    --card:#111116; --muted:#9ba0a5;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text); min-height:100vh; padding:20px;
    background:linear-gradient(140deg,var(--bg1),var(--bg2),var(--bg3),var(--bg1));
    background-size:240% 240%; animation:moveGradient 18s ease-in-out infinite;
    display:flex; flex-direction:column; gap:16px;
  }
  @keyframes moveGradient{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
  h1{margin:0 0 6px; font-weight:800; font-size:34px; color:var(--purple); text-shadow:0 0 10px rgba(179,122,255,.6)}
  .tag{color:var(--green); margin-bottom:12px; text-shadow:0 0 8px rgba(123,255,90,.45)}
  .screen{display:none}
  .show{display:block}
  .tiles{display:grid; grid-template-columns:1fr; gap:12px}
  .btn{
    display:block; width:100%; padding:14px 16px; border-radius:14px; text-decoration:none; text-align:center;
    color:#000; background:var(--green); font-weight:700; font-size:16px;
    box-shadow:0 0 10px rgba(123,255,90,.65),0 0 22px rgba(123,255,90,.45); transition:.2s transform,.2s box-shadow;
  }
  .btn:hover{transform:translateY(-1px) scale(1.02); box-shadow:0 0 16px rgba(123,255,90,.95),0 0 30px rgba(123,255,90,.75)}
  .secondary{background:#1f1f29; color:#fff; box-shadow:none; border:1px solid #2c2c39}
  .wrap{background:var(--card); border:1px solid #242433; border-radius:16px; padding:14px}
  label{font-size:12px; color:var(--muted)}
  input,select,textarea{
    width:100%; margin-top:6px; margin-bottom:10px; background:#0f0f15; color:#fff; border:1px solid #2a2a39;
    border-radius:12px; padding:12px 14px; font-size:15px; outline:none;
  }
  textarea{min-height:110px; resize:vertical}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .list{display:flex; flex-direction:column; gap:10px}
  .item{background:#0f0f15; border:1px solid #2a2a39; border-radius:14px; padding:12px}
  .title2{font-weight:700}
  .muted{color:var(--muted); font-size:12px}
  .badge{display:inline-block; background:#1b1b27; border:1px solid #2f2f40; padding:4px 8px; border-radius:999px; margin-right:6px; font-size:12px}
  .top{display:flex; align-items:center; justify-content:space-between}
  .nav{position:sticky; top:0; background:transparent; padding-top:4px}
  .back{color:#fff; background:#1b1b27; border:1px solid #2a2a39; border-radius:999px; padding:8px 12px; text-decoration:none; font-size:14px}
  .spacer{height:6px}
  @media(min-width:540px){ .tiles{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>

  <!-- SCREEN: HOME -->
  <section id="home" class="screen show">
    <h1>GiDCity</h1>
    <div class="tag">–ó–∞—à—ë–ª ‚Ä¢ –°–¥–µ–ª–∞–ª ‚Ä¢ –ó–∞—Ä–∞–±–æ—Ç–∞–ª</div>
    <div class="tiles">
      <a class="btn" href="#find">üîç –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã</a>
      <a class="btn" href="#create">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</a>
      <a class="btn" href="#exec">üõ† –°—Ç–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º</a>
      <a class="btn" href="#mine">üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
      <a class="btn secondary" href="https://t.me/GiDCityBot">–û—Ç–∫—Ä—ã—Ç—å –≤ —á–∞—Ç–µ</a>
    </div>
  </section>

  <!-- SCREEN: FIND ORDERS -->
  <section id="find" class="screen">
    <div class="nav">
      <a class="back" href="#home">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    <h1>–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã</h1>
    <div class="wrap">
      <div class="row">
        <div>
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select id="f_category">
            <option value="">–õ—é–±–∞—è</option>
            <option>–ö—É—Ä—å–µ—Ä</option><option>–£–±–æ—Ä–∫–∞</option><option>–†–µ–º–æ–Ω—Ç</option>
            <option>–î–∏–∑–∞–π–Ω</option><option>IT</option><option>–î—Ä—É–≥–æ–µ</option>
          </select>
        </div>
        <div>
          <label>–ì–æ—Ä–æ–¥</label>
          <input id="f_city" placeholder="–ê–ª–º–∞—Ç—ã / –ê—Å—Ç–∞–Ω–∞">
        </div>
      </div>
      <div class="row">
        <div>
          <label>–ë—é–¥–∂–µ—Ç –æ—Ç (‚Ç∏)</label>
          <input id="f_price_min" type="number" min="0" placeholder="0">
        </div>
        <div>
          <label>–ë—é–¥–∂–µ—Ç –¥–æ (‚Ç∏)</label>
          <input id="f_price_max" type="number" min="0" placeholder="100000">
        </div>
      </div>
      <button class="btn" id="applyFilters">üîé –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
    </div>
    <div class="spacer"></div>
    <div class="list" id="ordersList"></div>
  </section>

  <!-- SCREEN: CREATE ORDER -->
  <section id="create" class="screen">
    <div class="nav">
      <a class="back" href="#home">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    <h1>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h1>
    <div class="wrap">
      <div class="row">
        <div>
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select id="c_category" required>
            <option>–ö—É—Ä—å–µ—Ä</option><option>–£–±–æ—Ä–∫–∞</option><option>–†–µ–º–æ–Ω—Ç</option>
            <option>–î–∏–∑–∞–π–Ω</option><option>IT</option><option>–î—Ä—É–≥–æ–µ</option>
          </select>
        </div>
        <div>
          <label>–ì–æ—Ä–æ–¥</label>
          <input id="c_city" placeholder="–ê–ª–º–∞—Ç—ã" required>
        </div>
      </div>
      <div class="row">
        <div>
          <label>–ë—é–¥–∂–µ—Ç (‚Ç∏)</label>
          <input id="c_budget" type="number" min="0" placeholder="15000" required>
        </div>
        <div>
          <label>–î–µ–¥–ª–∞–π–Ω</label>
          <input id="c_deadline" type="date" required>
        </div>
      </div>
      <label>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
      <textarea id="c_desc" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å? –ê–¥—Ä–µ—Å, –≤—Ä–µ–º—è, –¥–µ—Ç–∞–ª–∏‚Ä¶" required></textarea>

      <div class="row">
        <div>
          <label>–ö–æ–Ω—Ç–∞–∫—Ç (—Ç–µ–ª–µ–≥—Ä–∞–º/—Ç–µ–ª.)</label>
          <input id="c_contact" placeholder="@username –∏–ª–∏ +7‚Ä¶">
        </div>
        <div>
          <label>–ò–º—è</label>
          <input id="c_name" placeholder="–ò–º—è –∑–∞–∫–∞–∑—á–∏–∫–∞">
        </div>
      </div>

      <button class="btn" id="createBtn">üöÄ –°–æ–∑–¥–∞—Ç—å</button>
    </div>
  </section>

  <!-- SCREEN: MY ORDERS -->
  <section id="mine" class="screen">
    <div class="nav">
      <a class="back" href="#home">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    <h1>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
    <div class="list" id="myOrders"></div>
  </section>

  <!-- SCREEN: EXECUTOR -->
  <section id="exec" class="screen">
    <div class="nav">
      <a class="back" href="#home">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    <h1>–ê–Ω–∫–µ—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</h1>
    <div class="wrap">
      <div class="row">
        <div>
          <label>–ì–æ—Ä–æ–¥</label>
          <input id="e_city" placeholder="–ê–ª–º–∞—Ç—ã" />
        </div>
        <div>
          <label>–ù–∞–≤—ã–∫–∏</label>
          <input id="e_skills" placeholder="–ö—É—Ä—å–µ—Ä, —Ä–µ–º–æ–Ω—Ç, —É–±–æ—Ä–∫–∞‚Ä¶" />
        </div>
      </div>
      <label>–û —Å–µ–±–µ</label>
      <textarea id="e_about" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ –≤–∞—à–µ–º –æ–ø—ã—Ç–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏"></textarea>
      <button class="btn" id="execBtn">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É</button>
    </div>
  </section>

<script>
  const tg = window.Telegram?.WebApp;
  tg && tg.expand();

  // ===== –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ hash =====
  const screens = ["home","find","create","mine","exec"];
  function show(id){
    screens.forEach(s=>document.getElementById(s).classList.remove('show'));
    document.getElementById(id).classList.add('show');
    location.hash = id==='home'?'':('#'+id);
    if(id==='find') renderOrders();
    if(id==='mine') renderMyOrders();
  }
  window.addEventListener('hashchange', () => {
    const id = location.hash.replace('#','') || 'home';
    if(screens.includes(id)) show(id);
  });
  // –ø–µ—Ä–≤—ã–π –ø–æ–∫–∞–∑
  show((location.hash||'#home').replace('#',''));

  // ====== –•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–∫–∞–∑–æ–≤ ======
  const KEY = 'gidcity_orders';
  function getOrders(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){return []} }
  function setOrders(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

  // ====== –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ======
  document.getElementById('createBtn').onclick = () => {
    const order = {
      id: 'o_'+Date.now(),
      category: document.getElementById('c_category').value,
      city: document.getElementById('c_city').value.trim(),
      budget: Number(document.getElementById('c_budget').value||0),
      deadline: document.getElementById('c_deadline').value,
      desc: document.getElementById('c_desc').value.trim(),
      contact: document.getElementById('c_contact').value.trim(),
      name: document.getElementById('c_name').value.trim(),
      created: new Date().toISOString()
    };
    if(!order.city || !order.budget || !order.deadline || !order.desc){
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è: –≥–æ—Ä–æ–¥, –±—é–¥–∂–µ—Ç, –¥–µ–¥–ª–∞–π–Ω, –æ–ø–∏—Å–∞–Ω–∏–µ.');
      return;
    }
    const list = getOrders();
    list.unshift(order);
    setOrders(list);

    // –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –±–æ—Ç–∞
    try { tg && tg.sendData(JSON.stringify({type:'create_order', order})); } catch(e){}

    alert('–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!');
    // –æ—á–∏—Å—Ç–∏–º —Ñ–æ—Ä–º—É
    ['c_city','c_budget','c_deadline','c_desc','c_contact','c_name'].forEach(id=>document.getElementById(id).value='');
    show('mine');
  };

  // ====== –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤ ======
  function card(o){
    return `
      <div class="item">
        <div class="top">
          <div class="title2">${o.category} ‚Ä¢ ${o.city}</div>
          <div class="badge">‚Ç∏ ${o.budget.toLocaleString('ru-RU')}</div>
        </div>
        <div class="muted">–¥–æ ${o.deadline}</div>
        <div style="margin:6px 0 8px">${escapeHtml(o.desc)}</div>
        ${o.contact ? `<div class="muted">–ö–æ–Ω—Ç–∞–∫—Ç: ${escapeHtml(o.contact)}</div>` : ''}
      </div>`;
  }
  function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m]))}

  function renderOrders(){
    const list = getOrders();
    const cat = document.getElementById('f_category').value;
    const city = document.getElementById('f_city').value.trim().toLowerCase();
    const pmin = Number(document.getElementById('f_price_min').value||0);
    const pmax = Number(document.getElementById('f_price_max').value||1e12);
    const filtered = list.filter(o =>
      (!cat || o.category===cat) &&
      (!city || o.city.toLowerCase().includes(city)) &&
      o.budget>=pmin && o.budget<=pmax
    );
    document.getElementById('ordersList').innerHTML =
      filtered.length ? filtered.map(card).join('') : `<div class="muted">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.</div>`;
  }
  document.getElementById('applyFilters').onclick = renderOrders;

  function renderMyOrders(){
    const list = getOrders();
    document.getElementById('myOrders').innerHTML =
      list.length ? list.map(card).join('') : `<div class="muted">–í—ã –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–ª–∏ –∑–∞–∫–∞–∑–æ–≤.</div>`;
  }

  // ====== –ê–Ω–∫–µ—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è ======
  document.getElementById('execBtn').onclick = () => {
    const payload = {
      type:'executor_profile',
      city: document.getElementById('e_city').value.trim(),
      skills: document.getElementById('e_skills').value.trim(),
      about: document.getElementById('e_about').value.trim()
    };
    try { tg && tg.sendData(JSON.stringify(payload)); } catch(e){}
    alert('–ê–Ω–∫–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ú—ã –ø–æ–¥–±–µ—Ä—ë–º –∑–∞–¥–∞–Ω–∏—è!');
    show('home');
  };
</script>
</body>
</html>
