<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GiDCity –ú–µ–Ω—é</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --purple:#b37aff; --green:#7BFF5A; --text:#fff; --card:#111116; --muted:#9ba0a5;
  --focus: 0 0 0 3px rgba(123,255,90,.35);
  /* —Ñ–æ–Ω ‚Äî –∫–Ω–∏–∂–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è */
  --bg-img: url("data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?>\
<svg xmlns='http://www.w3.org/2000/svg' width='2400' height='1400'>\
<defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>\
<stop offset='0%' stop-color='%23b37aff'/><stop offset='55%' stop-color='%236671ff'/>\
<stop offset='100%' stop-color='%237BFF5A'/></linearGradient></defs>\
<rect fill='%230b0b12' width='100%' height='100%'/>\
<g opacity='0.88'>\
<path fill='url(%23g)' d='M0 300 C 400 200, 800 420, 1200 280 S 2000 220, 2400 340 L 2400 0 L 0 0 Z'/>\
<path fill='url(%23g)' opacity='0.45' d='M0 820 C 520 920, 920 700, 1420 820 S 2100 900, 2400 780 L 2400 1400 L 0 1400 Z'/>\
</g>\
<g fill='%23ffffff' fill-opacity='0.14'>\
<circle cx='200' cy='300' r='2'/><circle cx='420' cy='640' r='1.6'/>\
<circle cx='760' cy='180' r='1.8'/><circle cx='1220' cy='260' r='1.4'/>\
<circle cx='1680' cy='520' r='1.8'/><circle cx='2100' cy='940' r='1.6'/>\
</g></svg>");
}

/* —Ñ–æ–Ω */
body{
  margin:0; padding:20px; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text); min-height:100vh;
  background: linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.55)), var(--bg-img);
  background-size:cover; background-position:center; background-attachment:fixed;
}

/* –∑–∞–≥–æ–ª–æ–≤–∫–∏ */
h1{margin:0 0 6px; font-weight:800; font-size:38px; color:var(--purple); text-shadow:0 0 14px rgba(179,122,255,.6)}
.tag{color:var(--green); margin-bottom:16px; text-shadow:0 0 8px rgba(123,255,90,.45)}
.tiles{display:grid; gap:14px; max-width:860px}

/* –ö–Ω–æ–ø–∫–∏ (glass) ‚Äî –∏–∫–æ–Ω–∫–∞ —Å–ª–µ–≤–∞, —Å–ª–æ–≤–æ —Å–ø—Ä–∞–≤–∞ */
.btn{
  position:relative;
  display:flex; align-items:center; gap:14px;
  width:100%; padding:16px 20px; border-radius:18px; cursor:pointer;
  text-decoration:none; font-size:18px; font-weight:800; letter-spacing:.2px;
  color:#fff; background:rgba(255,255,255,0.10); border:1px solid rgba(255,255,255,0.35);
  backdrop-filter:blur(18px);
  box-shadow:0 0 16px rgba(179,122,255,.35), 0 0 38px rgba(123,255,90,.28);
  transition:.25s ease;
}
.btn:hover{background:rgba(255,255,255,0.18); transform:translateY(-2px) scale(1.04)}
.btn:active{transform:scale(0.96)}
.btn:focus{outline:none; box-shadow:var(--focus)}
.secondary{background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.25); box-shadow:none}

.btn .icon{width:28px; height:28px; flex:0 0 28px; filter: drop-shadow(0 0 8px rgba(123,255,90,.55)) drop-shadow(0 0 12px rgba(179,122,255,.45));}
.btn .btn-text{margin-left:auto; text-align:right;}

/* –±–µ–π–¥–∂ */
.badge-btn{
  position:absolute; top:-8px; right:-8px;
  min-width:24px; height:24px; padding:0 6px;
  display:flex; align-items:center; justify-content:center;
  background:#ff4d4f; color:#fff; border-radius:999px; font-size:12px; border:2px solid rgba(255,255,255,.3);
}

/* –æ–∫–Ω–∞-–æ–≤–µ—Ä–ª–µ–∏ + –∞–Ω–∏–º–∞—Ü–∏—è —Å–Ω–∏–∑—É */
/* –ò–∑–º–µ–Ω–µ–Ω–æ: –ø–∞–Ω–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã \"—Å—Ç–µ–∫–ª—è–Ω–Ω—ã–µ\" ‚Äî –¥–µ–ª–∞–µ–º –ø–ª–æ—Ç–Ω—ã–π —Ñ–æ–Ω, –±–µ–∑ backdrop-filter,
   —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞ –Ω–∏–º–∏ */
.screen{ display:none; position:fixed; inset:0; padding:20px; overflow-y:auto; background:rgba(0,0,0,0.45); }
.screen.active{ display:block }
.panel{
  max-width:860px; margin:0 auto;
  /* —Ä–∞–Ω—å—à–µ: background:rgba(0,0,0,0.55); backdrop-filter:blur(16px); */
  /* —Ç–µ–ø–µ—Ä—å –ø–ª–æ—Ç–Ω—ã–π, —Å–ª–µ–≥–∫–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω, –ø–æ—á—Ç–∏ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π */
  background: linear-gradient(180deg, rgba(12,12,18,0.97), rgba(8,8,12,0.98));
  border:1px solid rgba(255,255,255,0.06); border-radius:20px; padding:16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  transform:translateY(32px); opacity:0; animation:slideUp .28s cubic-bezier(.22,.8,.24,1) forwards;
}
@keyframes slideUp{ from{transform:translateY(34px);opacity:0} to{transform:translateY(0);opacity:1} }

.nav{display:flex; align-items:center; gap:10px; margin-bottom:8px}
.back{color:#fff; background:rgba(255,255,255,0.16); border:1px solid rgba(255,255,255,0.25); border-radius:12px; padding:8px 14px; text-decoration:none}
.wrap{
  /* —Ç–∞–∫–∂–µ –¥–µ–ª–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–±—ë—Ä—Ç–∫–∏ –ø–ª–æ—Ç–Ω—ã–º–∏, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—Ä–æ—Å–≤–µ—á–∏–≤–∞–Ω–∏—è */
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.04); border-radius:16px; padding:16px;
}
label{font-size:13px; color:var(--muted)}
input,select,textarea{
  width:100%; margin-top:6px; margin-bottom:12px; background:rgba(255,255,255,0.03);
  color:#fff; border:1px solid rgba(255,255,255,0.12); border-radius:14px; padding:12px 14px; font-size:15px; outline:none;
}
input:focus,select:focus,textarea:focus{box-shadow:var(--focus); border-color:#3a3a59}
textarea{min-height:120px; resize:vertical}
.row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
@media(max-width:560px){ .row{grid-template-columns:1fr} }
.list{display:flex; flex-direction:column; gap:12px}
.item{background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04); border-radius:16px; padding:14px;}
.title2{font-weight:700; font-size:17px}
.muted{color:var(--muted); font-size:13px}
.badge{display:inline-block; background:rgba(255,255,255,0.06); padding:4px 10px; border-radius:999px; margin-left:8px; font-size:12px}
.spacer{height:6px}

/* —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π —Ñ–∏–ª—å—Ç—Ä */
.collapse{overflow:hidden; max-height:0; transition:max-height .25s ease}
.collapse.open{max-height:500px}

/* –º–æ–¥–∞–ª–∫–∏ */
.modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,.55); z-index:50}
.modal.active{display:block}
.modal .panel{max-width:560px}
</style>
</head>
<body>

<!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
<section id="home">
  <h1>GiDCity</h1>
  <div class="tag">–ó–∞—à—ë–ª ‚Ä¢ –°–¥–µ–ª–∞–ª ‚Ä¢ –ó–∞—Ä–∞–±–æ—Ç–∞–ª</div>
  <div class="tiles">
    <!-- –°–û–ó–î–ê–¢–¨ -->
    <button class="btn" onclick="openScreen('create')">
      <!-- –∏–∫–æ–Ω–∫–∞: –Ω–µ–æ–Ω–æ–≤–æ–µ –ø–µ—Ä–æ -->
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <defs>
          <linearGradient id="grad1" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/>
          </linearGradient>
        </defs>
        <path d="M3 21l6-1 11-11a3 3 0 10-4.24-4.24L4.76 15.76 3 21z" stroke="url(#grad1)" stroke-width="2" />
        <path d="M14 6l4 4" stroke="url(#grad1)" stroke-width="2" />
      </svg>
      <span class="btn-text">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</span>
    </button>

    <!-- –ù–ê–ô–¢–ò -->
    <button class="btn" onclick="openScreen('find')">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <defs><linearGradient id="grad2" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
        <circle cx="11" cy="11" r="6.5" stroke="url(#grad2)" stroke-width="2"/>
        <path d="M16.5 16.5L21 21" stroke="url(#grad2)" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="btn-text">üîç –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã</span>
      <span id="ordersCountBadge" class="badge-btn" style="display:none">0</span>
    </button>

    <!-- –ö–û–®–ï–õ–Å–ö -->
    <button class="btn" onclick="openScreen('wallet')">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <defs><linearGradient id="grad3" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
        <rect x="3" y="6" width="18" height="12" rx="3" stroke="url(#grad3)" stroke-width="2"/>
        <circle cx="17" cy="12" r="1.5" fill="#7BFF5A"/>
      </svg>
      <span class="btn-text">üíé –ö–æ—à–µ–ª—ë–∫</span>
    </button>

    <!-- –ú–û–ò -->
    <button class="btn" onclick="openScreen('mine')">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <defs><linearGradient id="grad4" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
        <path d="M4 7h16M6 11h12M8 15h8" stroke="url(#grad4)" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="btn-text">üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</span>
    </button>

    <!-- –æ—Ç–∫—Ä—ã—Ç—å –≤ —á–∞—Ç–µ -->
    <button class="btn secondary" id="openInChat">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <defs><linearGradient id="grad5" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
        <path d="M21 11c0 4.418-4.03 8-9 8-1.2 0-2.35-.2-3.4-.57L3 20l1.7-4.1A7.6 7.6 0 0 1 3 11c0-4.418 4.03-8 9-8s9 3.582 9 8z" stroke="url(#grad5)" stroke-width="2"/>
      </svg>
      <span class="btn-text">–û—Ç–∫—Ä—ã—Ç—å –≤ —á–∞—Ç–µ</span>
    </button>
  </div>
</section>

<!-- –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã -->
<section id="find" class="screen" aria-labelledby="findTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="findTitle">–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã</h1>

    <!-- –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ -->
    <div style="display:flex; gap:10px; margin-bottom:10px">
      <button class="btn secondary" id="toggleFilter" type="button">
        <svg class="icon" viewBox="0 0 24 24" fill="none">
          <defs><linearGradient id="grad6" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
          <path d="M4 6h16M6 12h12M8 18h8" stroke="url(#grad6)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="btn-text">‚öô –§–∏–ª—å—Ç—Ä</span>
      </button>
    </div>

    <!-- –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π —Ñ–∏–ª—å—Ç—Ä -->
    <div id="filterWrap" class="collapse">
      <div class="wrap">
        <form id="filterForm">
          <div class="row">
            <div>
              <label for="f-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select id="f-category" name="category">
                <option value="">–õ—é–±–∞—è</option>
                <option>–ö—É—Ä—å–µ—Ä</option><option>–£–±–æ—Ä–∫–∞</option><option>–†–µ–º–æ–Ω—Ç</option>
                <option>–î–∏–∑–∞–π–Ω</option><option>IT</option><option>–î—Ä—É–≥–æ–µ</option>
              </select>
            </div>
            <div>
              <label for="f-city">–ì–æ—Ä–æ–¥</label>
              <input id="f-city" name="city" placeholder="–ê–ª–º–∞—Ç—ã / –ê—Å—Ç–∞–Ω–∞" />
            </div>
          </div>
          <div class="row">
            <div><label for="f-min">–ë—é–¥–∂–µ—Ç –æ—Ç (‚Ç∏)</label><input id="f-min" name="min" type="number" min="0" placeholder="0" /></div>
            <div><label for="f-max">–ë—é–¥–∂–µ—Ç –¥–æ (‚Ç∏)</label><input id="f-max" name="max" type="number" min="0" placeholder="100000" /></div>
          </div>
          <button class="btn" type="submit">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <defs><linearGradient id="grad7" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
              <path d="M10 17l-4-4 1.4-1.4L10 14.2l6.6-6.6L18 9" stroke="url(#grad7)" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="btn-text">üîé –ü—Ä–∏–º–µ–Ω–∏—Ç—å</span>
          </button>
        </form>
      </div>
    </div>

    <div class="spacer"></div>
    <div id="findList" class="list" aria-live="polite"></div>
  </div>
</section>

<!-- –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ -->
<section id="create" class="screen" aria-labelledby="createTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="createTitle">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h1>
    <div class="wrap">
      <form id="createForm">
        <div class="row">
          <div>
            <label for="c-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="c-category" name="category" required>
              <option>–ö—É—Ä—å–µ—Ä</option><option>–£–±–æ—Ä–∫–∞</option><option>–†–µ–º–æ–Ω—Ç</option>
              <option>–î–∏–∑–∞–π–Ω</option><option>IT</option><option>–î—Ä—É–≥–æ–µ</option>
            </select>
          </div>
          <div>
            <label for="c-city">–ì–æ—Ä–æ–¥</label>
            <input id="c-city" name="city" placeholder="–ê–ª–º–∞—Ç—ã" required />
          </div>
        </div>
        <div class="row">
          <div><label for="c-budget">–ë—é–¥–∂–µ—Ç (‚Ç∏)</label><input id="c-budget" name="budget" type="number" min="0" placeholder="15000" required /></div>
          <div><label for="c-deadline">–î–µ–¥–ª–∞–π–Ω</label><input id="c-deadline" name="deadline" type="date" required /></div>
        </div>
        <label for="c-desc">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
        <textarea id="c-desc" name="desc" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å? –ê–¥—Ä–µ—Å, –≤—Ä–µ–º—è, –¥–µ—Ç–∞–ª–∏‚Ä¶" required></textarea>
        <div class="row">
          <div><label for="c-contact">–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="c-contact" name="contact" placeholder="@username –∏–ª–∏ +7‚Ä¶" required /></div>
          <div><label for="c-name">–ò–º—è</label><input id="c-name" name="name" placeholder="–ò–º—è –∑–∞–∫–∞–∑—á–∏–∫–∞" required /></div>
        </div>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <button class="btn" type="submit">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <defs><linearGradient id="grad8" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
              <path d="M12 5v14M5 12h14" stroke="url(#grad8)" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="btn-text">üöÄ –°–æ–∑–¥–∞—Ç—å</span>
          </button>
          <button class="btn secondary" type="button" id="sendOrderToBot">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <defs><linearGradient id="grad9" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
              <path d="M4 12h10M9 7l5 5-5 5" stroke="url(#grad9)" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="btn-text">üì§ –í –±–æ—Ç</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- –ú–æ–∏ –∑–∞–∫–∞–∑—ã -->
<section id="mine" class="screen" aria-labelledby="mineTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="mineTitle">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
    <div id="mineList" class="list"><div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ ‚Üí</div></div>
    <div class="row" style="grid-template-columns:1fr 1fr; margin-top:10px">
      <button class="btn secondary" id="exportJson">
        <svg class="icon" viewBox="0 0 24 24" fill="none">
          <defs><linearGradient id="grad10" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
          <path d="M12 3v12m0 0l-4-4m4 4l4-4M4 21h16" stroke="url(#grad10)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="btn-text">‚¨á –≠–∫—Å–ø–æ—Ä—Ç JSON</span>
      </button>
      <button class="btn secondary" id="clearAll">
        <svg class="icon" viewBox="0 0 24 24" fill="none">
          <defs><linearGradient id="grad11" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b37aff"/><stop offset="100%" stop-color="#7BFF5A"/></linearGradient></defs>
          <path d="M4 7h16M9 7v12m6-12v12M6 7l1-3h10l1 3" stroke="url(#grad11)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="btn-text">üóë –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</span>
      </button>
    </div>
  </div>
</section>

<!-- –ö–æ—à–µ–ª—ë–∫ -->
<section id="wallet" class="screen" aria-labelledby="walletTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="walletTitle">–ö–æ—à–µ–ª—ë–∫</h1>
    <div class="wrap">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
        <div>
          <div class="muted">–ë–∞–ª–∞–Ω—Å</div>
          <div id="balance" style="font-size:28px; font-weight:800; color:var(--green)">‚Ç∏ 0</div>
        </div>
        <div style="display:grid; gap:8px; grid-template-columns:repeat(2,1fr)">
          <button class="btn" type="button" id="btnTopup"><span class="btn-text">‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å</span></button>
          <button class="btn" type="button" id="btnPay"><span class="btn-text">üí≥ –û–ø–ª–∞—Ç–∏—Ç—å</span></button>
          <button class="btn" type="button" id="btnTransfer"><span class="btn-text">üîÅ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏</span></button>
          <button class="btn" type="button" id="btnWithdraw"><span class="btn-text">‚Üò –í—ã–≤–µ—Å—Ç–∏</span></button>
        </div>
      </div>
    </div>
    <div class="spacer"></div>
    <div class="wrap">
      <div class="muted" style="margin-bottom:8px">–ò—Å—Ç–æ—Ä–∏—è</div>
      <div id="history" class="list"><div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div></div>
    </div>
  </div>
</section>

<!-- –ú–æ–¥–∞–ª–∫–∞ ¬´–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ü–µ–Ω—É¬ª -->
<div id="bidModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="bidTitle">
  <div class="panel">
    <h2 id="bidTitle" style="margin:0 0 10px; font-size:24px">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ü–µ–Ω—É</h2>
    <div id="bidOrderInfo" class="muted" style="margin-bottom:10px"></div>
    <div class="wrap">
      <form id="bidForm">
        <div class="row">
          <div><label for="b-price">–í–∞—à–∞ —Ü–µ–Ω–∞ (‚Ç∏)</label><input id="b-price" name="price" type="number" min="0" placeholder="15000" required /></div>
          <div><label for="b-name">–ò–º—è</label><input id="b-name" name="name" placeholder="–í–∞—à–µ –∏–º—è" required /></div>
        </div>
        <label for="b-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
        <textarea id="b-comment" name="comment" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ —Å—Ä–æ–∫–∞—Ö, –¥–µ—Ç–∞–ª—è—Ö –∏ —Ç.–¥."></textarea>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <button class="btn secondary" type="button" id="bidCancel"><span class="btn-text">–û—Ç–º–µ–Ω–∞</span></button>
          <button class="btn" type="submit"><span class="btn-text">üí∏ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</span></button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è) -->
<div id="walletModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="walletModalTitle">
  <div class="panel">
    <h2 id="walletModalTitle" style="margin:0 0 10px; font-size:24px">–û–ø–µ—Ä–∞—Ü–∏—è</h2>
    <div class="wrap">
      <form id="walletForm">
        <div id="walletFields"></div>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <button class="btn secondary" type="button" id="walletCancel"><span class="btn-text">–û—Ç–º–µ–Ω–∞</span></button>
          <button class="btn" type="submit"><span class="btn-text" id="walletSubmitText">–ì–æ—Ç–æ–≤–æ</span></button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
/* Telegram init */
const tg = window.Telegram?.WebApp;
const isInTelegram = !!tg;
if(isInTelegram){ try{ tg.ready(); tg.expand(); document.body.classList.toggle('tg-light', tg.colorScheme==='light'); }catch(e){} }

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è –æ–∫–æ–Ω */
function openScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
}
function closeScreens(){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); }

/* Deep link (–∑–∞–º–µ–Ω–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) */
const BOT_USERNAME='GiDCityBot', STARTAPP_KEY='menu';
document.getElementById('openInChat').onclick=()=> {
  const url = `https://t.me/${BOT_USERNAME}?startapp=${encodeURIComponent(STARTAPP_KEY)}`;
  if(isInTelegram){ try{ tg.openTelegramLink(url); }catch(e){ window.open(url,'_blank'); } } else { window.open(url,'_blank'); }
};

/* Storage */
const LS_ORDERS='gid_orders_v1', LS_PROFILE='gid_profile_v1', LS_WALLET='gid_wallet_v1';
const Store={
  getOrders(){ try{return JSON.parse(localStorage.getItem(LS_ORDERS))||[]}catch(_){return[]} },
  setOrders(x){ localStorage.setItem(LS_ORDERS, JSON.stringify(x)); },
  addOrder(o){ const l=this.getOrders(); l.unshift(o); this.setOrders(l); return l; },
  updateOrder(id, mutator){ const l=this.getOrders(); const i=l.findIndex(x=>x.id===id); if(i>-1){ mutator(l[i]); this.setOrders(l);} return l; },
  deleteOrder(id){ const l=this.getOrders().filter(x=>x.id!==id); this.setOrders(l); return l; },
  getProfile(){ try{return JSON.parse(localStorage.getItem(LS_PROFILE))||null}catch(_){return null} },
  setProfile(p){ localStorage.setItem(LS_PROFILE, JSON.stringify(p)); },
  getWallet(){ try{return JSON.parse(localStorage.getItem(LS_WALLET))||{balance:0,history:[]} }catch(_){return {balance:0,history:[]}} },
  setWallet(w){ localStorage.setItem(LS_WALLET, JSON.stringify(w)); }
};

/* Seed orders */
function todayISO(){ return new Date().toISOString().slice(0,10); }
function daysFromNow(n){ const d=new Date(); d.setDate(d.getDate()+n); return d.toISOString().slice(0,10); }
if(Store.getOrders().length===0){
  Store.setOrders([
    { id:'seed1', category:'–ö—É—Ä—å–µ—Ä', city:'–ê–ª–º–∞—Ç—ã', budget:10000, deadline:daysFromNow(1), desc:'–û—Ç–≤–µ–∑—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ –ê –≤ –ë', contact:'@client1', name:'–ê–π–¥–∞—Ä', bids:[] },
    { id:'seed2', category:'–£–±–æ—Ä–∫–∞', city:'–ê—Å—Ç–∞–Ω–∞', budget:15000, deadline:todayISO(), desc:'2-—Ö –∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞', contact:'@client2', name:'–°–∞–ª—Ç–∞–Ω–∞—Ç', bids:[] }
  ]);
}

/* Utils */
const findList=document.getElementById('findList'), mineList=document.getElementById('mineList'), ordersBadge=document.getElementById('ordersCountBadge');
const balanceEl=document.getElementById('balance'), histEl=document.getElementById('history');
function escapeHTML(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]))}
function prettyDeadline(iso){
  try{
    const d=new Date(iso+'T00:00:00'), t=new Date(todayISO()+'T00:00:00'); const diff=Math.round((d-t)/86400000);
    if(diff===0) return '—Å–µ–≥–æ–¥–Ω—è';
    if(diff===1) return '–¥–æ –∑–∞–≤—Ç—Ä–∞';
    if(diff<0) return '–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ';
    return '–¥–æ ' + d.toLocaleDateString('ru-KZ');
  }catch(e){ return iso; }
}
function money(n){ return '‚Ç∏ ' + Number(n||0).toLocaleString('ru-RU'); }

/* –†–µ–Ω–¥–µ—Ä –∑–∞–∫–∞–∑–æ–≤ */
function renderOrders(container, list, ctx){
  container.innerHTML='';
  if(!list||list.length===0){ container.innerHTML='<div class="muted">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>'; return; }
  list.forEach(o=>{
    const el=document.createElement('div'); el.className='item';
    const bidsCount = Array.isArray(o.bids)? o.bids.length : 0;
    const actions = (ctx==='find')
      ? `<button class="btn" data-act="bid" data-id="${o.id}"><span class="btn-text">üí∏ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ü–µ–Ω—É</span></button>`
      : `<button class="btn secondary" data-act="send" data-id="${o.id}"><span class="btn-text">üì§ –í –±–æ—Ç</span></button>
         <button class="btn secondary" data-act="delete" data-id="${o.id}"><span class="btn-text">üóë –£–¥–∞–ª–∏—Ç—å</span></button>`;
    el.innerHTML=`
      <div class="title2">${escapeHTML(o.category)} ‚Ä¢ ${escapeHTML(o.city)}
        <span class="badge">${money(o.budget)}</span>
      </div>
      <div class="muted">${prettyDeadline(o.deadline)} ‚Ä¢ –∑–∞—è–≤–æ–∫: ${bidsCount}</div>
      <div>${escapeHTML(o.desc)}</div>
      <div class="muted">–ö–æ–Ω—Ç–∞–∫—Ç: ${escapeHTML(o.contact)} ‚Ä¢ ${escapeHTML(o.name)}</div>
      <div style="display:flex; gap:8px; margin-top:8px">
        ${actions}
      </div>`;
    container.appendChild(el);
  });
  container.querySelectorAll('button[data-act]').forEach(b=>{
    b.onclick=(e)=>{
      const id=e.currentTarget.getAttribute('data-id'), act=e.currentTarget.getAttribute('data-act');
      const order=Store.getOrders().find(x=>x.id===id);
      if(act==='delete'){ Store.deleteOrder(id); refreshAll(); }
      if(act==='send' && order){ sendToBot({type:'order', payload:order}); }
      if(act==='bid' && order){ openBidModal(order); }
    };
  });
}

/* –§–∏–ª—å—Ç—Ä –≤ ¬´–ù–∞–π—Ç–∏¬ª */
const toggleFilterBtn=document.getElementById('toggleFilter');
const filterWrap=document.getElementById('filterWrap');
toggleFilterBtn.onclick=()=>{ filterWrap.classList.toggle('open'); };
document.getElementById('filterForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  const fd=new FormData(e.currentTarget);
  const cat=(fd.get('category')||'').trim(), city=(fd.get('city')||'').trim().toLowerCase();
  const min=Number(fd.get('min')||0), max=Number(fd.get('max')||0);
  const list=Store.getOrders().filter(o=>{
    let ok=true;
    if(cat) ok=ok&&o.category===cat;
    if(city) ok=ok&&o.city.toLowerCase().includes(city);
    if(min) ok=ok&&Number(o.budget)>=min;
    if(max) ok=ok&&Number(o.budget)<=max;
    return ok;
  });
  renderOrders(findList, list, 'find');
});

/* –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ */
document.getElementById('createForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  const fd=new FormData(e.currentTarget);
  const order={
    id: Math.random().toString(36).slice(2,10)+Date.now().toString(36),
    category:fd.get('category'), city:fd.get('city'),
    budget:Number(fd.get('budget')), deadline:fd.get('deadline'),
    desc:fd.get('desc'), contact:fd.get('contact'), name:fd.get('name'),
    isMine:true, bids:[]
  };
  if(!(order.category&&order.city&&order.deadline&&order.desc&&order.contact&&order.name)){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
  if(!(order.budget>=0)){ alert('–ë—é–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º'); return; }
  Store.addOrder(order);
  e.currentTarget.reset(); document.getElementById('c-deadline').value=todayISO();
  openScreen('find'); refreshAll();
});
document.getElementById('sendOrderToBot').onclick=()=>{
  const last=Store.getOrders()[0]; if(!last){ alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏'); return; }
  sendToBot({type:'order', payload:last});
};

/* –≠–∫—Å–ø–æ—Ä—Ç / –æ—á–∏—Å—Ç–∫–∞ */
document.getElementById('exportJson').onclick=()=>{
  const data={orders:Store.getOrders(), profile:Store.getProfile(), wallet:Store.getWallet()};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='gidcity-data.json'; a.click(); URL.revokeObjectURL(url);
};
document.getElementById('clearAll').onclick=()=>{ if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')){ localStorage.clear(); refreshAll(); } };

/* ====== –ë–ò–î–´ ====== */
const bidModal=document.getElementById('bidModal');
const bidForm=document.getElementById('bidForm');
const bidCancel=document.getElementById('bidCancel');
const bidInfo=document.getElementById('bidOrderInfo');
let currentBidOrderId=null;

function openBidModal(order){
  currentBidOrderId=order.id;
  bidInfo.innerHTML = '<b>' + escapeHTML(order.category) + ' ‚Ä¢ ' + escapeHTML(order.city) + '</b> ‚Äî –±—é–¥–∂–µ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞: ' + money(order.budget);
  bidForm.reset();
  bidModal.classList.add('active');
}
function closeBidModal(){ bidModal.classList.remove('active'); currentBidOrderId=null; }

bidCancel.onclick=closeBidModal;
bidModal.addEventListener('click', (e)=>{ if(e.target===bidModal) closeBidModal(); });

bidForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  if(!currentBidOrderId) return;
  const fd=new FormData(bidForm);
  const price=Number(fd.get('price')||0);
  const name=(fd.get('name')||'').trim();
  const comment=(fd.get('comment')||'').trim();
  if(!(price>0)){ alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É'); return; }
  if(!name){ alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è'); return; }

  Store.updateOrder(currentBidOrderId, (o)=>{
    if(!Array.isArray(o.bids)) o.bids=[];
    o.bids.push({ price, name, comment, createdAt:new Date().toISOString() });
  });
  closeBidModal();
  alert('–í–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ');
  refreshAll();
});

/* ====== –ö–û–®–ï–õ–Å–ö ====== */
const walletModal=document.getElementById('walletModal');
const walletFields=document.getElementById('walletFields');
const walletCancel=document.getElementById('walletCancel');
const walletForm=document.getElementById('walletForm');
const walletSubmitText=document.getElementById('walletSubmitText');
const walletTitle=document.getElementById('walletModalTitle');

let walletAction=null;

function openWalletModal(action){
  walletAction=action;
  walletFields.innerHTML='';
  if(action==='topup'){
    walletTitle.textContent='–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ';
    walletFields.innerHTML=`
      <label for="w-amount">–°—É–º–º–∞ (‚Ç∏)</label><input id="w-amount" name="amount" type="number" min="0" placeholder="10000" required />
      <label for="w-note">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input id="w-note" name="note" placeholder="–ò—Å—Ç–æ—á–Ω–∏–∫/–º–µ—Ç–æ–¥" />
    `;
    walletSubmitText.textContent='–ü–æ–ø–æ–ª–Ω–∏—Ç—å';
  } else if(action==='pay'){
    walletTitle.textContent='–û–ø–ª–∞—Ç–∞';
    walletFields.innerHTML=`
      <label for="w-amount">–°—É–º–º–∞ (‚Ç∏)</label><input id="w-amount" name="amount" type="number" min="0" placeholder="5000" required />
      <label for="w-note">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞</label><input id="w-note" name="note" placeholder="ID –∑–∞–∫–∞–∑–∞ / –æ–ø–∏—Å–∞–Ω–∏–µ" />
    `;
    walletSubmitText.textContent='–û–ø–ª–∞—Ç–∏—Ç—å';
  } else if(action==='transfer'){
    walletTitle.textContent='–ü–µ—Ä–µ–≤–æ–¥';
    walletFields.innerHTML=`
      <label for="w-to">–ö–æ–º—É</label><input id="w-to" name="to" placeholder="@username" required />
      <label for="w-amount">–°—É–º–º–∞ (‚Ç∏)</label><input id="w-amount" name="amount" type="number" min="0" placeholder="5000" required />
      <label for="w-note">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input id="w-note" name="note" placeholder="–∑–∞ —É—Å–ª—É–≥—É / –∞–≤–∞–Ω—Å" />
    `;
    walletSubmitText.textContent='–ü–µ—Ä–µ–≤–µ—Å—Ç–∏';
  } else if(action==='withdraw'){
    walletTitle.textContent='–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤';
    walletFields.innerHTML=`
      <label for="w-amount">–°—É–º–º–∞ (‚Ç∏)</label><input id="w-amount" name="amount" type="number" min="0" placeholder="20000" required />
      <label for="w-note">–†–µ–∫–≤–∏–∑–∏—Ç—ã</label><input id="w-note" name="note" placeholder="–ö–∞—Ä—Ç–∞/IBAN/–ö–∞—Å–ø–∏" required />
    `;
    walletSubmitText.textContent='–í—ã–≤–µ—Å—Ç–∏';
  }
  walletForm.reset();
  walletModal.classList.add('active');
}
function closeWalletModal(){ walletModal.classList.remove('active'); walletAction=null; }
walletCancel.onclick=closeWalletModal;
walletModal.addEventListener('click', (e)=>{ if(e.target===walletModal) closeWalletModal(); });

document.getElementById('btnTopup').onclick = ()=> openWalletModal('topup');
document.getElementById('btnPay').onclick = ()=> openWalletModal('pay');
document.getElementById('btnTransfer').onclick = ()=> openWalletModal('transfer');
document.getElementById('btnWithdraw').onclick = ()=> openWalletModal('withdraw');

walletForm.addEventListener('submit',(e)=>{
  e.preventDefault();
  const fd=new FormData(walletForm);
  const w=Store.getWallet();
  const amount=Number(fd.get('amount')||0);
  const note=(fd.get('note')||'').trim();
  if(!(amount>0)){ alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É'); return; }

  const ts=new Date().toISOString();

  if(walletAction==='topup'){
    w.balance += amount;
    w.history.unshift({type:'topup', amount, note, ts});
  }else if(walletAction==='pay'){
    if(w.balance<amount){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
    w.balance -= amount;
    w.history.unshift({type:'pay', amount, note, ts});
  }else if(walletAction==='transfer'){
    const to=(fd.get('to')||'').trim();
    if(!to){ alert('–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è'); return; }
    if(w.balance<amount){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
    w.balance -= amount;
    w.history.unshift({type:'transfer', amount, to, note, ts});
  }else if(walletAction==='withdraw'){
    if(w.balance<amount){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
    w.balance -= amount;
    w.history.unshift({type:'withdraw', amount, note, ts});
  }

  Store.setWallet(w);
  closeWalletModal();
  renderWallet();
});

/* –†–µ–Ω–¥–µ—Ä –∫–æ—à–µ–ª—å–∫–∞ */
function renderWallet(){
  const w=Store.getWallet();
  balanceEl.textContent = money(w.balance);
  if(!w.history.length){ histEl.innerHTML='<div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>'; return; }
  histEl.innerHTML='';
  w.history.forEach(h=>{
    const row=document.createElement('div'); row.className='item';
    const titleMap={topup:'–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', pay:'–û–ø–ª–∞—Ç–∞', transfer:'–ü–µ—Ä–µ–≤–æ–¥', withdraw:'–í—ã–≤–æ–¥'};
    const sign = (h.type==='topup')? '+' : '-';
    const extra = h.to ? ` ‚Üí ${escapeHTML(h.to)}` : '';
    const noteHTML = h.note ? `<div>${escapeHTML(h.note)}</div>` : '';
    row.innerHTML = `
      <div class="title2">${titleMap[h.type]}${extra} <span class="badge">${sign} ${money(h.amount)}</span></div>
      <div class="muted">${new Date(h.ts).toLocaleString('ru-KZ')}</div>
      ${noteHTML}
    `;
    histEl.appendChild(row);
  });
}

/* –°–≤—è–∑–∫–∞ —Å –±–æ—Ç–æ–º */
function sendToBot(message){
  const payload=JSON.stringify(message);
  if(isInTelegram){
    try{ tg.sendData(payload); tg.showAlert('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–æ—Ç ‚úÖ'); }
    catch(e){ try{ tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: '+e.message); }catch(_){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: '+e.message); } }
  }else{
    console.log('Payload for bot:', payload);
    alert('–û—Ç–∫—Ä—ã—Ç–æ –≤–Ω–µ Telegram. JSON –ø–æ–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ –±—É–¥–µ—Ç —Å–∫–∞—á–∞–Ω.');
    const blob=new Blob([payload],{type:'application/json'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=`gidcity-${message.type}.json`; a.click(); URL.revokeObjectURL(url);
  }
}

/* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è */
function refreshAll(){
  const orders=Store.getOrders();
  renderOrders(findList, orders, 'find');               // ¬´–ù–∞–π—Ç–∏¬ª ‚Äî –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫
  renderOrders(mineList, orders.filter(o=>o.isMine), 'mine'); // ¬´–ú–æ–∏¬ª ‚Äî —Ç–æ–ª—å–∫–æ –º–æ–∏
  if(orders.length>0){ ordersBadge.style.display='flex'; ordersBadge.textContent=orders.length; }
  else { ordersBadge.style.display='none'; }
  renderWallet();
}

/* Set default deadline input to today on page load */
document.addEventListener('DOMContentLoaded', ()=> {
  const dd = document.getElementById('c-deadline'); if(dd) dd.value = todayISO();
  refreshAll();
});
</script>
</body>
</html>
