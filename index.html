<!doctype html>
<html lang="ru" data-theme="violet">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GiD City ‚Äî –°—Ñ–µ—Ä–∞ —É—Å–ª—É–≥ & –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* =================== –¢–ï–ú–´ =================== */
:root{
  --bg-1:#0a0f1a; --bg-2:#0b0e1c; --bg-3:#0b0e1e;
  --radial-a:#1e1b3a; --radial-b:#08152a;

  --surface:rgba(20,24,40,.92);
  --line:rgba(160,170,230,.28);

  --accent-a:#a970ff; --accent-b:#32ffd2; --accent-c:#6a8cff;
  --danger:#ff4f6a; --gold:#ffd84d;

  --text:#ffffff; --text-dim:#d8dcff; --text-muted:#9aa6d9; --text-invert:#0b0f18;

  --radius:16px; --ui-font:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  --ui-font-size:14px;
  --shadow:0 16px 46px rgba(0,0,0,.45);
  --glass: rgba(255,255,255,0.02);
}
html[data-theme="violet"]{ --accent-a:#a970ff; --accent-b:#32ffd2; --accent-c:#6a8cff; --bg-1:#060614; --bg-2:#07081a; --bg-3:#090b22; --line:rgba(160,170,230,.28); }
html[data-theme="navy"]  { --accent-a:#6aa7ff; --accent-b:#7ef3ff; --accent-c:#65d0ff; --bg-1:#04101c; --bg-2:#041426; --bg-3:#061a32; --line:rgba(120,140,200,.14); }
html[data-theme="emerald"]{ --accent-a:#33e09d; --accent-b:#b7ff78; --accent-c:#75ffd9; --bg-1:#081710; --bg-2:#082019; --bg-3:#071a12; --line:rgba(80,220,200,.12); }
html[data-theme="sunset"]{ --accent-a:#ff6dab; --accent-b:#ffcc6d; --accent-c:#ff9b6d; --bg-1:#1a080a; --bg-2:#22090b; --bg-3:#2c0b10; --line:rgba(255,140,100,.12); }
html[data-theme="light1"]{
  --bg-1:#ffffff; --bg-2:#f6f7fb; --bg-3:#eef1f7;
  --text:#1a1a1a; --text-dim:#2c2c2c; --text-muted:#555; --text-invert:#ffffff;
  --surface:#ffffff; --line:#e5e8f0;
  --accent-a:#6a5cff; --accent-b:#22c1c3; --accent-c:#6a8cff;
}
html[data-theme="light2"]{
  --bg-1:#fefefe; --bg-2:#edf6ff; --bg-3:#e6f0ff;
  --text:#191c22; --text-dim:#2a2f36; --text-muted:#4b5563; --text-invert:#ffffff;
  --surface:#ffffff; --line:#e1e7f0;
  --accent-a:#8a65ff; --accent-b:#4de0c2; --accent-c:#74a6ff;
}

/* =================== –§–û–ù =================== */
*{box-sizing:border-box}
body{
  margin:0; min-height:100vh; padding:18px; color:var(--text);
  font: var(--ui-font-size) var(--ui-font);
  background:
    radial-gradient(900px at 20% -10%, var(--radial-a) 0%, transparent 70%),
    radial-gradient(700px at 120% 20%, var(--radial-b) 0%, transparent 70%),
    linear-gradient(180deg,var(--bg-1),var(--bg-2),var(--bg-3));
  display:flex; justify-content:center;
}
.wrapper{ width:100%; max-width:1100px; display:flex; flex-direction:column; gap:16px; }

/* =================== –•–ï–î–ï–† =================== */
.header{ display:flex; justify-content:space-between; align-items:flex-start; gap:12px; padding:6px 2px; }
.brand{ display:flex; flex-direction:column; gap:6px; }
.brand h1{
  margin:0; font-weight:800; font-size:22px;
  background:linear-gradient(90deg,var(--accent-a),var(--accent-b));
  -webkit-background-clip:text; color:transparent;
}
.header-sub{ font-size:13px; color:var(--text-muted) }
.header-right{ display:flex; flex-direction:column; gap:10px; align-items:flex-end }

/* date center */
.header-center{ display:flex; align-items:center; justify-content:center; gap:12px; flex:1; }
#centerDate{ font-weight:700; cursor:pointer; background:var(--glass); padding:6px 12px; border-radius:10px; border:1px solid var(--line); }

/* =================== –ö–ù–û–ü–ö–ò =================== */
.btn{ appearance:none; border:none; cursor:pointer; font-weight:800; color:var(--text);
  padding:10px 14px; border-radius:12px; line-height:1;
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.18));
  border:1px solid var(--line); box-shadow:var(--shadow); transition:transform .12s, box-shadow .25s, background .18s;
}
.btn:hover{ transform:translateY(-1px) }
.btn:active{ transform:translateY(0) }
.btn.primary{ background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:var(--text-invert); }
.btn.ghost{ background:transparent; }
.controls-row{ display:flex; gap:8px }
.btn-with-badge{ position:relative }
.badge-dot{ position:absolute; top:-6px; right:-6px; min-width:18px; height:18px; padding:0 5px;
  display:flex; align-items:center; justify-content:center; background:var(--danger); color:#fff; border-radius:999px; font-size:12px; font-weight:900; box-shadow:0 0 0 2px rgba(0,0,0,.7);
}

/* =================== ROLE TABS (moved top center) =================== */
.role-tabs{ display:flex; gap:12px; align-items:center; justify-content:center; margin-top:6px; }
.role-tab{
  min-width:220px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; gap:8px;
  font-weight:900; background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.12));
  border:1px solid var(--line); cursor:pointer; transition:transform .18s, box-shadow .18s, color .12s, border-color .12s, background .12s;
  color:var(--text-dim); position:relative; overflow:hidden;
}
.role-tab .label{ font-weight:900; font-size:13px; }
.role-tab.active{ transform:scale(1.02); color:var(--gold); border-color:rgba(255,216,77,.9); box-shadow:0 10px 30px rgba(255,200,80,.06); background:linear-gradient(90deg, rgba(255,216,77,.04), rgba(169,112,255,.02)); }

/* =================== CONTAINER / MENU =================== */
.container{ width:100%; border-radius:20px; padding:18px; background:var(--surface); border:1px solid var(--line); box-shadow:var(--shadow); overflow:hidden }
.panel-top{ display:flex; justify-content:space-between; align-items:center; margin-bottom:12px }
.panel-top h2{ margin:0; font-size:18px; font-weight:900 }
.panel-note{ font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; margin-top:6px; }

/* menu grid: centered with equal margins */
.menu-grid{ display:flex; gap:12px; width:100%; justify-content:center; flex-wrap:wrap; align-items:flex-start; padding:12px 6px; }
.menu-btn{
  display:flex; align-items:center; gap:12px; cursor:pointer;
  min-height:64px; padding:12px 16px; border-radius:14px; border:1px solid var(--line);
  background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.16)); box-shadow:0 8px 26px rgba(0,0,0,.35);
  color:var(--text); transition:transform .18s, box-shadow .2s, background .16s;
  flex: 0 1 320px; max-width:360px; width:calc(33% - 24px); min-width:230px;
  justify-content:flex-start;
}
.menu-btn .left{ width:36px; height:36px; border-radius:10px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg, rgba(255,255,255,.03), rgba(0,0,0,.06)); flex-shrink:0; }
.menu-btn .title{ font-weight:900; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.menu-btn .note{ font-size:12px; color:var(--text-muted) }
.menu-btn.primary{ background:linear-gradient(135deg, rgba(169,112,255,.12), rgba(50,255,210,.06)); border-color: rgba(169,112,255,.16); }
.menu-btn.disabled{ opacity:.6; pointer-events:none }

/* =================== CARDS / AVATARS =================== */
.card{ background:linear-gradient(180deg, rgba(12,16,30,.9), rgba(8,12,26,.9)); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:var(--shadow); display:flex; gap:12px; align-items:flex-start }
.avatar{ width:32px; height:32px; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:12px; color:#fff }
.avatar img{ width:100%; height:100%; object-fit:cover }

/* =================== INPUTS / MODAL SYMMETRY =================== */
.input, textarea, select{
  width:100%; padding:12px; border-radius:12px; border:1px solid var(--line);
  background:rgba(12,16,36,.75); color:var(--text); font-size:14px; outline:none; box-sizing:border-box;
}
.input:focus, textarea:focus, select:focus{ border-color:var(--accent-a); box-shadow:0 0 0 3px rgba(169,112,255,.08) }
textarea{ min-height:110px; resize:vertical }
.row{ display:flex; gap:8px; flex-wrap:wrap } .col{ flex:1 1 260px }
.small{ font-size:12px; color:var(--text-muted) }
/* –°–ò–ú–ú–ï–¢–†–ò–Ø –¥–µ–¥–ª–∞–π–Ω/–±—é–¥–∂–µ—Ç */
.form-stack .input{ height:48px; min-height:48px; display:flex; align-items:center }

/* modal content */
.screen{ position:fixed; inset:0; display:none; z-index:120; padding:12px; background:rgba(0,0,0,.55); backdrop-filter:blur(8px); align-items:flex-start; justify-content:center }
.screen.active{ display:flex }
.modal{ width:100%; max-width:1100px; max-height:88vh; overflow:auto; background:var(--surface); color:var(--text); box-shadow:var(--shadow); border:1px solid var(--line); border-radius:18px; padding:16px }
.modal .content-inner{ padding:6px; display:block }

/* scrollbars */
::-webkit-scrollbar{ width:10px; height:10px; }
::-webkit-scrollbar-track{ background:transparent; }
::-webkit-scrollbar-thumb{ background: linear-gradient(180deg, rgba(169,112,255,.22), rgba(50,255,210,.12)); border-radius:999px; border:2px solid rgba(0,0,0,.12); }

/* create tabs vertical scroller */
#createTabs{ display:flex; gap:8px; flex-direction:column; max-height:220px; overflow:auto; padding-right:6px; }

/* theme list scroller hidden until open */
#themePicker{ max-height:240px; overflow:auto; display:none; flex-direction:column; gap:8px; padding-right:6px; margin-top:8px; }

/* city posts */
.post-card{ background:linear-gradient(180deg, rgba(12,16,30,.92), rgba(8,12,26,.9)); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:var(--shadow); margin-bottom:10px }
.post-img{ width:100%; border-radius:12px; margin-top:8px; max-height:360px; object-fit:cover }
.post-actions{ display:flex; gap:8px; margin-top:8px; flex-wrap:wrap }
.comment{ background:rgba(255,255,255,.04); border:1px solid var(--line); border-radius:10px; padding:8px; margin-top:6px }

/* fixed small share panel in city chat */
.city-share-panel{ position:sticky; bottom:8px; left:0; right:0; display:flex; gap:8px; align-items:center; padding:8px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)); border:1px solid var(--line); }

/* responsive */
@media (max-width:900px){
  .menu-btn{ width:100%; flex-basis:100%; }
  .role-tab{ width:48%; }
}
</style>
</head>
<body>
<div class="wrapper">
  <header class="header">
    <div class="brand">
      <h1>GiD City</h1>
      <div id="topCity" class="header-sub">–ì–æ—Ä–æ–¥: ‚Äî</div>
    </div>

    <div class="header-center">
      <!-- centered date -->
      <div id="centerDate">‚Äî</div>
    </div>

    <div class="header-right">
      <div class="controls-row">
        <button id="openSettings" class="btn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <!-- notification button moved to panel-top (rendered dynamically there) -->
      </div>
      <div style="margin-top:8px;">
        <!-- role tabs are top center (kept here visually but CSS centers them) -->
        <div class="role-tabs" id="roleTabs">
          <div class="role-tab" data-role="user" id="roleUserBtn"><span class="label">–°—Ñ–µ—Ä–∞ —É—Å–ª—É–≥</span></div>
          <div class="role-tab" data-role="worker" id="roleWorkerBtn"><span class="label">–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</span></div>
        </div>
      </div>
    </div>
  </header>

  <main class="container" role="main" aria-live="polite">
    <div class="panel-top">
      <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
      <!-- notification placeholder moved here -->
      <div id="panelNotifPlace"></div>
    </div>

    <div class="menu-grid" id="menuGrid"></div>

    <div class="panel-note">KASSEN Technology Inc.</div>
  </main>
</div>

<!-- CALENDAR MODAL -->
<section id="calendarModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h3>
    <button onclick="closeScreen('calendarModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
  <div style="margin-top:12px;">
    <input id="reminderDate" type="datetime-local" class="input">
    <div style="margin-top:8px; display:flex; gap:8px;">
      <input id="reminderText" class="input" placeholder="–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è">
      <button id="addReminderBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</button>
    </div>
    <div style="margin-top:12px;" id="remindersList"></div>
  </div>
</div></section>

<!-- SETTINGS -->
<section id="settingsModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <button onclick="closeScreen('settingsModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
  <div style="margin-top:12px;">
    <div style="font-weight:900">–¢–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
    <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
      <button id="openThemePicker" class="btn">–í—ã–±—Ä–∞—Ç—å —Ç–µ–º—É</button>
    </div>
    <div id="themePicker"></div>

    <div style="margin-top:12px; font-weight:900">–ì–æ—Ä–æ–¥</div>
    <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
      <select id="citySelect" class="input" style="max-width:320px"></select>
      <button id="saveCityBtn" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
      <label><input id="autoSyncToggle" type="checkbox"> –ê–≤—Ç–æ-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</label>
      <button id="syncNowBtn" class="btn">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å</button>
    </div>

    <div style="margin-top:12px; font-weight:900">–ü—Ä–æ—Ñ–∏–ª—å</div>
    <div style="display:flex; gap:8px; align-items:center;">
      <button id="openProfile" class="btn">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    </div>
  </div>
</div></section>

<!-- CREATE ORDER -->
<section id="createScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0">–ó–ê–ö–ê–ó–ê–¢–¨</h3>
    <button onclick="closeScreen('createScreen')" class="btn ghost">–ù–∞–∑–∞–¥</button>
  </div>
  <div style="margin-top:10px;">
    <div id="createTabs" style="display:flex; gap:8px; flex-direction:column; max-height:220px; overflow:auto;">
      <div class="tab active" data-val="–°–ü–ï–¶. –ó–ê–ö–ê–ó">–°–ü–ï–¶. –ó–ê–ö–ê–ó</div>
      <div class="tab" data-val="–¢–∞–∫—Å–∏">–¢–∞–∫—Å–∏</div>
      <div class="tab" data-val="–ö—É—Ä—å–µ—Ä">–ö—É—Ä—å–µ—Ä</div>
      <div class="tab" data-val="–î–æ—Å—Ç–∞–≤–∫–∞">–î–æ—Å—Ç–∞–≤–∫–∞</div>
      <div class="tab" data-val="–ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–æ–º">–ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–æ–º</div>
      <div class="tab" data-val="–ú–∞—Å—Ç–µ—Ä">–ú–∞—Å—Ç–µ—Ä</div>
      <div class="tab" data-val="–ü—Ä–æ—á–∏–µ">–ü—Ä–æ—á–∏–µ</div>
    </div>

    <form id="createForm" style="margin-top:12px; display:grid; gap:8px;">
      <textarea id="c-desc" class="input" placeholder="–ó–∞–∫–∞–∂–∏ –ª—é–±—É—é —É—Å–ª—É–≥—É ‚Äî –º—ã –Ω–∞–π–¥—ë–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è"></textarea>

      <div id="createExtraFields" class="form-field" style="margin-top:0; max-height:220px; overflow:auto; padding-right:6px;"></div>

      <div class="form-stack" style="display:flex; gap:8px; margin-top:0; flex-wrap:wrap;">
        <input id="c-datetime" class="input" type="datetime-local" placeholder="–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è" style="flex:1; min-width:220px;">
        <input id="c-budget" class="input" type="number" placeholder="–ë—é–¥–∂–µ—Ç (‚Ç∏)" style="width:160px;">
      </div>

      <div style="display:flex; gap:12px; margin-top:6px; align-items:center; flex-wrap:wrap">
        <button class="btn primary" id="orderNowBtn" type="submit" style="min-width:220px; padding:14px 18px; font-size:15px">–ó–ê–ö–ê–ó–ê–¢–¨</button>
        <button class="btn ghost" type="button" onclick="closeScreen('createScreen')">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </form>
  </div>
</div></section>

<!-- FIND ORDERS -->
<section id="findScreen" class="screen"><div class="modal">
  <div class="content-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0; font-size:22px; letter-spacing:.5px">–ù–ê–ô–¢–ò –ó–ê–ö–ê–ó–´</h3>
      <button onclick="closeScreen('findScreen')" class="btn ghost">–ù–∞–∑–∞–¥</button>
    </div>
    <div style="margin-top:8px">
      <div style="display:flex; gap:8px;"><input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..."><button id="applySearch" class="btn">–ü–æ–∏—Å–∫</button></div>
      <div id="findList" class="list" style="margin-top:12px"></div>
    </div>
  </div>
</div></section>

<!-- MINE -->
<section id="mineScreen" class="screen"><div class="modal">
  <div class="content-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h3><button onclick="closeScreen('mineScreen')" class="btn ghost">–ù–∞–∑–∞–¥</button>
    </div>
    <div id="mineList" class="list" style="margin-top:12px"></div>
  </div>
</div></section>

<!-- BIDS -->
<section id="bidsModal" class="screen"><div class="modal">
  <div class="content-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 id="bidsModalTitle" style="margin:0">–ó–∞—è–≤–∫–∏</h3><button onclick="closeScreen('bidsModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="bidsList" style="margin-top:12px"></div>
  </div>
</div></section>

<!-- MESSENGER -->
<section id="messengerScreen" class="screen"><div class="modal">
  <div class="content-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</h3><button onclick="closeScreen('messengerScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="chatsList" style="margin-top:12px"></div>
  </div>
</div></section>

<!-- CITY THREAD -->
<section id="cityThreadScreen" class="screen"><div class="modal">
  <div class="content-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0">–ß–∞—Ç —Ç–≤–æ–µ–≥–æ –≥–æ—Ä–æ–¥–∞</h3>
      <button onclick="closeScreen('cityThreadScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div style="margin-top:12px;">
      <!-- fixed small share panel (one row) -->
      <div id="citySharePanel" class="city-share-panel" style="display:flex;align-items:center;justify-content:space-between;">
        <div style="display:flex; align-items:center; gap:8px;">
          <div id="shareAvatar" class="avatar" style="width:28px;height:28px">–Ø</div>
          <div id="shareName" style="font-weight:800">–í—ã</div>
        </div>
        <div style="margin-left:auto; color:var(--text-muted); cursor:pointer;" id="sharePlaceholder">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è...</div>
      </div>

      <div id="cityPosts" style="margin-top:12px; max-height:52vh; overflow:auto; padding-right:6px;"></div>
    </div>
  </div>
</div></section>

<!-- QUICK POST MODAL (opens from share panel) -->
<section id="quickPostModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –ª–µ–Ω—Ç–µ</h3>
    <button onclick="closeScreen('quickPostModal')" class="btn ghost">–û—Ç–º–µ–Ω–∞</button>
  </div>
  <div style="margin-top:12px;">
    <textarea id="quickPostText" class="input" placeholder="–û —á—ë–º —Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å?"></textarea>
    <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
      <input id="quickPostImage" type="file" accept="image/*" style="display:none">
      <button id="quickPostFileBtn" class="btn">üìé</button>
      <div id="quickPostPreview" style="margin-top:8px; flex:1;"></div>
    </div>
    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
      <button id="quickPostSend" class="btn primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>
  </div>
</div></section>

<!-- NOTIFICATIONS -->
<section id="notificationsModal" class="screen"><div class="modal">
  <div class="content-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
      <button onclick="closeScreen('notificationsModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="notificationsList" style="margin-top:12px; max-height:60vh; overflow:auto"></div>
  </div>
</div></section>

<!-- PROFILE -->
<section id="profileScreen" class="screen"><div class="modal">
  <div class="content-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ü—Ä–æ—Ñ–∏–ª—å</h3><button onclick="closeScreen('profileScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    <div id="profileWrap" style="margin-top:12px"></div>
  </div>
</div></section>

<script>
/* Simplified store and wiring adapted from your code, preserving logic */
const LS_ORD='gid_orders_v13', LS_CHAT='gid_chats_v13', LS_PROFILE='gid_profile_v1', LS_ROLE='gid_role_v1', LS_CITY='gid_city_v1', LS_NOTIF='gid_notif_v1', LS_THEME='gid_theme_v1', LS_CITY_FEED='gid_city_feed_v3', LS_REM='gid_reminders_v1';

const $=id=>document.getElementById(id);
const uid=()=>Math.random().toString(36).slice(2,9);
const nowISO=()=>new Date().toISOString();

const Store={
  getOrders(){try{return JSON.parse(localStorage.getItem(LS_ORD))||[]}catch(e){return[]}}, setOrders(v){localStorage.setItem(LS_ORD,JSON.stringify(v))},
  addOrder(o){const a=this.getOrders(); a.unshift(o); this.setOrders(a); return a},
  updateOrder(id,fn){const a=this.getOrders(); const i=a.findIndex(x=>x.id===id); if(i>-1){ fn(a[i]); this.setOrders(a); } return a},
  getChats(){try{return JSON.parse(localStorage.getItem(LS_CHAT))||[]}catch(e){return[]}}, setChats(v){localStorage.setItem(LS_CHAT,JSON.stringify(v))},
  addChat(c){const a=this.getChats(); a.unshift(c); this.setChats(a); return a},
  updateChat(id,fn){const a=this.getChats(); const i=a.findIndex(x=>x.id===id); if(i>-1){ fn(a[i]); this.setChats(a); } return a},
  getProfile(){try{return JSON.parse(localStorage.getItem(LS_PROFILE))||null}catch(e){return null}}, setProfile(p){localStorage.setItem(LS_PROFILE,JSON.stringify(p))},
  getRole(){return localStorage.getItem(LS_ROLE)||'user'}, setRole(r){localStorage.setItem(LS_ROLE,r)},
  getCity(){return localStorage.getItem(LS_CITY)||'–ö–∞—Ä–∞–≥–∞–Ω–¥–∞'}, setCity(c){localStorage.setItem(LS_CITY,c)},
  getNotifs(){try{return JSON.parse(localStorage.getItem(LS_NOTIF))||[]}catch(e){return[]}}, setNotifs(a){localStorage.setItem(LS_NOTIF,JSON.stringify(a))},
  getTheme(){return localStorage.getItem(LS_THEME)||'violet'}, setTheme(t){localStorage.setItem(LS_THEME,t); applyTheme()},
  getCityFeed(){try{return JSON.parse(localStorage.getItem(LS_CITY_FEED))||{}}catch(e){return{}}}, setCityFeed(obj){localStorage.setItem(LS_CITY_FEED,JSON.stringify(obj))},
  getReminders(){try{return JSON.parse(localStorage.getItem(LS_REM))||[]}catch(e){return[]}}, setReminders(a){localStorage.setItem(LS_REM,JSON.stringify(a))}
};

function applyTheme(){ document.documentElement.setAttribute('data-theme', Store.getTheme()); }
function updateCityLabel(){ const c=Store.getCity()||'‚Äî'; $('topCity').textContent='–ì–æ—Ä–æ–¥: '+c; }
function refreshNotifBadge(){ const n=Store.getNotifs().length; const b= $('notifBadge'); if(b){ if(n>0){ b.style.display='flex'; b.textContent=n>99?'99+':String(n);} else b.style.display='none'; } }

// menu generation
function iconSVG(name){
  // flat monochrome SVGs
  const svgs = {
    order:`<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M3 7h18"/><rect x="3" y="7" width="18" height="14" rx="2"/></svg>`,
    find:`<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6"><circle cx="11" cy="11" r="6"/><path d="M21 21l-4.35-4.35"/></svg>`,
    city:`<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M3 21v-8a2 2 0 0 1 2-2h3v10"/><path d="M14 21V10h4v11"/></svg>`,
    ads:`<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M3 11h18"/><path d="M7 6v6"/></svg>`,
    chat:`<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>`,
    wallet:`<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3v4"/></svg>`
  };
  return svgs[name]||svgs.order;
}

function menuBtnObj(id,title,note,iconName,extraClass){
  const el = document.createElement('div'); el.id=id; el.className='menu-btn'+(extraClass?(' '+extraClass):'');
  el.innerHTML = `<div class="left">${iconSVG(iconName)}</div><div style="flex:1"><div class="title">${title}</div><div class="note" style="text-align:right">${note||''}</div></div>`;
  return el;
}

function applyRoleUI(){
  const role = Store.getRole(); document.querySelectorAll('.role-tab').forEach(t=>t.classList.toggle('active', t.dataset.role===role));
  const grid=$('menuGrid'); grid.innerHTML='';
  if(role==='user'){
    grid.appendChild(menuBtnObj('btnOrder','–ó–ê–ö–ê–ó–ê–¢–¨','–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É','order','primary'));
    grid.appendChild(menuBtnObj('btnAds','–û–ë–™–Ø–í–õ–ï–ù–ò–ï –£–°–õ–£–ì','–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π','ads'));
    grid.appendChild(menuBtnObj('btnCityThread','–ß–∞—Ç —Ç–≤–æ–µ–≥–æ –≥–æ—Ä–æ–¥–∞','–õ–µ–Ω—Ç–∞ –∫–∞–∫ —Å–æ—Ü—Å–µ—Ç—å','city'));
    grid.appendChild(menuBtnObj('btnMine','–ú–æ–∏ –∑–∞–∫–∞–∑—ã','–í–∞—à–∏ –∑–∞—è–≤–∫–∏','order'));
    grid.appendChild(menuBtnObj('btnMessenger','–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä','–î–∏–∞–ª–æ–≥–∏','chat'));
    grid.appendChild(menuBtnObj('btnWallet','–ö–æ—à–µ–ª—ë–∫','–ë–∞–ª–∞–Ω—Å','wallet'));
  } else {
    grid.appendChild(menuBtnObj('btnFind','–ù–ê–ô–¢–ò –ó–ê–ö–ê–ó–´','–î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π','find','primary'));
    grid.appendChild(menuBtnObj('btnAds','–û–ë–™–Ø–í–õ–ï–ù–ò–ï –£–°–õ–£–ì','–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π','ads'));
    grid.appendChild(menuBtnObj('btnCityThread','–ß–∞—Ç —Ç–≤–æ–µ–≥–æ –≥–æ—Ä–æ–¥–∞','–õ–µ–Ω—Ç–∞ –∫–∞–∫ —Å–æ—Ü—Å–µ—Ç—å','city'));
    grid.appendChild(menuBtnObj('btnMine','–ú–æ–∏ –∑–∞–∫–∞–∑—ã','–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ/–º–æ–∏','order'));
    grid.appendChild(menuBtnObj('btnMessenger','–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä','–î–∏–∞–ª–æ–≥–∏','chat'));
    grid.appendChild(menuBtnObj('btnWallet','–ö–æ—à–µ–ª—ë–∫','–ë–∞–ª–∞–Ω—Å','wallet'));
  }
  wireMainButtons();
}

// move notification button to panel-top
function ensurePanelNotification(){
  const place = $('panelNotifPlace'); if(!place) return;
  place.innerHTML = `<button id="panelNotifBtn" class="btn btn-with-badge" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" style="background:transparent;border:1px solid var(--line)">${iconSVG('chat')} <span id="panelNotifCount" class="badge-dot" style="display:none"></span></button>`;
  $('panelNotifBtn').addEventListener('click', ()=>{ renderNotifs(); openScreen('notificationsModal'); });
  refreshPanelNotif();
}
function refreshPanelNotif(){
  const n = Store.getNotifs().length; const b = $('panelNotifCount');
  if(b){ if(n>0){ b.style.display='flex'; b.textContent = n>99?'99+':String(n);} else b.style.display='none'; }
}

// initialize theme picker
const THEMES = [
  {k:'violet', name:'Violet'}, {k:'navy', name:'Navy'}, {k:'emerald', name:'Emerald'},
  {k:'sunset', name:'Sunset'}, {k:'mint', name:'Mint'}, {k:'light1', name:'Light 1'}, {k:'light2', name:'Light 2'}
];
function renderThemePicker(){
  const wrap = $('themePicker'); wrap.innerHTML='';
  THEMES.forEach(t=>{
    const b=document.createElement('button'); b.className='btn'; b.textContent=t.name; b.addEventListener('click', ()=>{ Store.setTheme(t.k); applyTheme(); });
    wrap.appendChild(b);
  });
}
$('openThemePicker')?.addEventListener('click', ()=>{ const w=$('themePicker'); w.style.display = w.style.display==='flex'?'none':'flex'; });

// populate city select with Kazakhstan cities
const CITIES = ['–ê–ª–º–∞—Ç—ã','–ê—Å—Ç–∞–Ω–∞','–ö–∞—Ä–∞–≥–∞–Ω–¥–∞','–®—ã–º–∫–µ–Ω—Ç','–ê–∫—Ç–æ–±–µ','–ü–∞–≤–ª–æ–¥–∞—Ä','–£—Å—Ç—å-–ö–∞–º–µ–Ω–æ–≥–æ—Ä—Å–∫','–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫','–¢–∞—Ä–∞–∑','–ö–æ—Å—Ç–∞–Ω–∞–π','–°–µ–º–µ–π','–ö—ã–∑—ã–ª–æ—Ä–¥–∞','–ê—Ç—ã—Ä–∞—É','–ê–∫—Ç–∞—É','–¢–∞–ª–¥—ã–∫–æ—Ä–≥–∞–Ω','–¢–µ–º–∏—Ä—Ç–∞—É','–ñ–µ–∑–∫–∞–∑–≥–∞–Ω','–≠–∫–∏–±–∞—Å—Ç—É–∑','–ö–æ–∫—à–µ—Ç–∞—É','–®–∞—Ö—Ç–∏–Ω—Å–∫'];
function populateCitySelect(){
  const sel = $('citySelect'); sel.innerHTML=''; CITIES.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); });
  sel.value = Store.getCity() || '–ö–∞—Ä–∞–≥–∞–Ω–¥–∞';
}
$('saveCityBtn')?.addEventListener('click', ()=>{ const v=$('citySelect').value; if(!v) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥'); Store.setCity(v); updateCityLabel(); alert('–ì–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω'); renderCityPosts(); });

// reminders/calendar
function renderCenterDate(){
  const el = $('centerDate'); const d = new Date(); el.textContent = d.toLocaleDateString('ru-RU', {day:'2-digit', month:'long', year:'numeric'});
  el.addEventListener('click', ()=> openScreen('calendarModal'));
}
function loadReminders(){
  const list = Store.getReminders(); const wrap=$('remindersList'); wrap.innerHTML=''; if(!list.length){ wrap.innerHTML='<div class="small">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω–µ—Ç</div>'; return; }
  list.forEach(r=>{ const row=document.createElement('div'); row.className='card'; row.innerHTML=`<div style="flex:1"><div style="font-weight:900">${esc(r.text)}</div><div class="small">${new Date(r.dt).toLocaleString()}</div></div>`; wrap.appendChild(row); });
}
$('addReminderBtn')?.addEventListener('click', ()=>{
  const dt = $('reminderDate').value; const text = $('reminderText').value.trim()||'–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ';
  if(!dt) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è');
  const rem = { id:'rem_'+uid(), dt, text };
  const arr = Store.getReminders(); arr.push(rem); Store.setReminders(arr); loadReminders(); alert('–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
});

// check reminders to push notifications (simple interval)
setInterval(()=>{
  const now = new Date(); const arr=Store.getReminders(); let changed=false;
  for(const r of arr.slice()){ if(new Date(r.dt) <= now){ // trigger
    const not = { id:'n_'+uid(), type:'reminder', title:'–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ', body: r.text, ts: nowISO() };
    const n = Store.getNotifs(); n.unshift(not); Store.setNotifs(n); // remove reminder
    arr.splice(arr.indexOf(r),1); Store.setReminders(arr); changed=true; refreshPanelNotif();
  } }
  if(changed) loadReminders();
}, 60*1000);

// create/order tabs behavior (vertical scroller already)
document.addEventListener('click', e=>{
  const t = e.target.closest('#createTabs .tab'); if(!t) return;
  document.querySelectorAll('#createTabs .tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active'); const cat = t.dataset.val || t.textContent;
  $('c-desc').placeholder = cat==='–°–ü–ï–¶. –ó–ê–ö–ê–ó' ? '–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É' : cat;
  // render extra fields
  const extra = $('createExtraFields'); extra.innerHTML='';
  if(cat==='–¢–∞–∫—Å–∏') extra.innerHTML = '<div class="row"><input class="input" id="f-from" placeholder="–û—Ç–∫—É–¥–∞"><input class="input" id="f-to" placeholder="–ö—É–¥–∞"></div>';
  if(cat==='–ö—É—Ä—å–µ—Ä') extra.innerHTML = '<div class="row"><input class="input" id="f-pick" placeholder="–ó–∞–±—Ä–∞—Ç—å"><input class="input" id="f-drop" placeholder="–î–æ—Å—Ç–∞–≤–∏—Ç—å"></div>';
  if(cat==='–ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–æ–º') extra.innerHTML = '<div class="row"><input class="input" id="f-area" placeholder="–†–∞–π–æ–Ω"><input class="input" id="f-rooms" placeholder="–ö–æ–º–Ω–∞—Ç"></div>';
});

// submit create order
$('createForm')?.addEventListener('submit', e=>{
  e.preventDefault();
  const profile = Store.getProfile(); if(!profile){ alert('–í–æ–π–¥–∏—Ç–µ'); openScreen('authScreen'); return; }
  const cat = document.querySelector('#createTabs .tab.active')?.dataset.val || '–°–ü–ï–¶. –ó–ê–ö–ê–ó';
  const desc = $('c-desc').value.trim(); const dt = $('c-datetime').value; const budget = Number($('c-budget').value||0);
  if(!desc || !dt) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –¥–∞—Ç—É');
  const order = { id:'o_'+uid(), category:cat, desc, datetime:dt, budget, city: Store.getCity(), ownerId: profile.id, ownerName: profile.name, bids:[], status:'open', createdAt: nowISO() };
  Store.addOrder(order);
  const not = Store.getNotifs(); not.unshift({ id:'n_'+uid(), type:'created', title:'–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω', body:`–í–∞—à –∑–∞–∫–∞–∑ "${cat}" –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω`, ts: nowISO(), payload:{orderId: order.id} }); Store.setNotifs(not); closeScreen('createScreen'); renderFindList(); renderMineList(); refreshPanelNotif(); alert('–ó–∞–∫–∞–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω');
});

// render find list
function renderFindList(){
  const wrap=$('findList'); wrap.innerHTML=''; const city=Store.getCity(); let items=Store.getOrders().filter(o=>o.status==='open');
  const q = ($('searchInput')?.value||'').toLowerCase();
  if(q) items = items.filter(o=> (o.category+' '+o.desc+' '+o.city).toLowerCase().includes(q));
  if(city) items = items.filter(o=>!o.city || o.city===city);
  if(!items.length){ wrap.innerHTML='<div class="small">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>'; return; }
  items.forEach(o=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<div style="flex:0 0 36px"><div class="avatar">${(o.ownerName||'–ü')[0]}</div></div><div style="flex:1"><div style="font-weight:900">${esc(o.category)} ‚Ä¢ <span class="small">${esc(o.city)}</span></div><div style="margin-top:6px">${esc(o.desc)}</div><div style="margin-top:8px"><button class="btn" data-id="${o.id}" data-act="offer">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É—Å–ª—É–≥—É</button></div></div>`;
    wrap.appendChild(card);
    card.querySelector('[data-act="offer"]').addEventListener('click', (ev)=>{ const id = ev.target.dataset.id; const price = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ü–µ–Ω—É (‚Ç∏):'); if(!price) return; const profile=Store.getProfile()||{id:'u_demo', name:'–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'}; Store.updateOrder(id, o=>{ o.bids = o.bids||[]; o.bids.push({ performerId: profile.id, name: profile.name, price: Number(price), comment:'', createdAt: nowISO() }); }); const not = Store.getNotifs(); not.unshift({ id:'n_'+uid(), type:'bid', title:'–ù–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', body:`–ù–∞ –≤–∞—à –∑–∞–∫–∞–∑ –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ ‚Ç∏ ${price}`, ts: nowISO(), payload:{orderId: id} }); Store.setNotifs(not); refreshPanelNotif(); alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'); renderFindList(); });
  });
}
$('applySearch')?.addEventListener('click', renderFindList);

// render mine
function renderMineList(){
  const wrap = $('mineList'); wrap.innerHTML=''; const p=Store.getProfile(); if(!p){ wrap.innerHTML='<div class="small">–í–æ–π–¥–∏—Ç–µ</div>'; return; }
  const items = Store.getOrders().filter(o=>o.ownerId===p.id);
  if(!items.length){ wrap.innerHTML='<div class="small">–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>'; return; }
  items.forEach(o=>{
    const card = document.createElement('div'); card.className='card';
    const bids = (o.bids||[]).length;
    card.innerHTML = `<div style="flex:0 0 36px"><div class="avatar">${(p.name||'–ü')[0]}</div></div><div style="flex:1"><div style="font-weight:900">${esc(o.category)} ${bids?('‚Ä¢ '+bids+' –∑–∞—è–≤–æ–∫'):''}</div><div class="small" style="margin-top:6px">–î–µ–¥–ª–∞–π–Ω: ${(o.datetime||'').replace('T',' ')}</div><div style="margin-top:8px">${esc(o.desc)}</div><div style="margin-top:8px"><button class="btn" data-act="view" data-id="${o.id}">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫–∏</button></div></div>`;
    wrap.appendChild(card);
    card.querySelector('[data-act="view"]').addEventListener('click', ()=>openBidsModal(o.id));
  });
}

// bids modal
function openBidsModal(orderId){
  const order = Store.getOrders().find(x=>x.id===orderId); if(!order) return alert('–ù–µ –Ω–∞–π–¥–µ–Ω');
  openScreen('bidsModal'); const list = $('bidsList'); list.innerHTML='';
  const header = document.createElement('div'); header.innerHTML = `<div style="font-weight:900">${esc(order.category)} ‚Ä¢ ${esc(order.city)}</div><div class="small">–ó–∞–∫–∞–∑—á–∏–∫: ${esc(order.ownerName)}</div>`; list.appendChild(header);
  const bids = order.bids || []; if(!bids.length){ list.innerHTML += '<div class="small">–ó–∞—è–≤–æ–∫ –Ω–µ—Ç</div>'; return; }
  bids.forEach((b,idx)=>{
    const row = document.createElement('div'); row.className='card';
    row.innerHTML = `<div style="flex:0 0 36px"><div class="avatar">${(b.name||'–ò')[0]}</div></div><div style="flex:1"><div style="font-weight:900">${esc(b.name)} ‚Äî ‚Ç∏ ${Number(b.price).toLocaleString('ru-RU')}</div><div class="small" style="margin-top:6px">${new Date(b.createdAt).toLocaleString()}</div><div style="margin-top:8px">${esc(b.comment||'')}</div><div style="margin-top:8px"><button class="btn primary" data-act="accept" data-idx="${idx}">–ü—Ä–∏–Ω—è—Ç—å</button> <button class="btn" data-act="decline" data-idx="${idx}">–û—Ç–∫–∞–∑–∞—Ç—å</button></div></div>`;
    list.appendChild(row);
    row.querySelector('[data-act="accept"]').addEventListener('click', ()=>{
      Store.updateOrder(orderId, o=>{ o.status='in_progress'; o.assigned = { performerId: b.performerId, performerName: b.name, price: b.price }; });
      const chat = { id:'chat_'+uid(), orderId, title: order.category, participants: [order.ownerId, b.performerId], messages:[{from:'system', text:'–ß–∞—Ç —Å–æ–∑–¥–∞–Ω –ø–æ –∑–∞–∫–∞–∑—É', ts: nowISO()}], unread: {} };
      Store.addChat(chat);
      const not = Store.getNotifs(); not.unshift({ id:'n_'+uid(), type:'accepted', title:'–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞', body:`–û—Ç–∫—Ä—ã—Ç —á–∞—Ç —Å ${b.name}`, ts: nowISO(), payload:{chatId: chat.id} }); Store.setNotifs(not); refreshPanelNotif();
      closeScreen('bidsModal'); openChatWindow(chat.id); renderMineList(); renderFindList();
    });
    row.querySelector('[data-act="decline"]').addEventListener('click', ()=>{ Store.updateOrder(orderId, o=>{ o.bids = (o.bids||[]).filter((_,i)=>i!==idx); }); openBidsModal(orderId); });
  });
}

// city posts
function renderCityPosts(){
  const container = $('cityPosts'); if(!container) return; container.innerHTML=''; const city = Store.getCity()||'‚Äî'; const feed = Store.getCityFeed(); const posts = Array.isArray(feed[city])? feed[city] : [];
  if(!posts.length){ container.innerHTML = '<div class="small">–ü–æ–∫–∞ –Ω–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</div>'; return; }
  posts.forEach(p=>{
    const card = document.createElement('div'); card.className='post-card';
    const likes = Object.keys(p.likes?.byUser||{}).length;
    card.innerHTML = `<div style="display:flex; gap:8px; align-items:center;"><div class="avatar">${(p.authorName||'–ü')[0]}</div><div style="font-weight:900">${esc(p.authorName)}</div><div class="small" style="margin-left:auto">${new Date(p.ts).toLocaleString()}</div></div><div style="margin-top:8px">${esc(p.text||'')}</div>${p.image?`<img class="post-img" src="${p.image}" alt="">`:''}<div class="post-actions"><button class="btn" data-act="like">–ù—Ä–∞–≤–∏—Ç—Å—è (${likes})</button><button class="btn" data-act="comment">–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å</button><button class="btn" data-act="repost">–†–µ–ø–æ—Å—Ç</button></div><div class="comments" style="margin-top:8px; display:none"><div style="display:flex; gap:8px;"><input class="input comment-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."><button class="btn primary" data-act="sendComment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div><div class="comments-list"></div></div>`;
    container.appendChild(card);
    card.querySelector('[data-act="like"]').addEventListener('click', ()=>{ toggleLike(p.id); });
    card.querySelector('[data-act="comment"]').addEventListener('click', ()=>{ const c=card.querySelector('.comments'); c.style.display = c.style.display==='none'?'block':'none'; });
    card.querySelector('[data-act="sendComment"]').addEventListener('click', ()=>{ const input = card.querySelector('.comment-input'); sendComment(p.id, input.value.trim()); input.value=''; });
    card.querySelector('[data-act="repost"]').addEventListener('click', ()=>{ openRepostPicker(p); });
  });
}

// quick post handlers from share panel
$('sharePlaceholder')?.addEventListener('click', ()=> openScreen('quickPostModal'));
$('sharePlaceholder')?.addEventListener('click', ()=> openScreen('quickPostModal'));
$('quickPostFileBtn')?.addEventListener('click', ()=> $('quickPostImage').click());
$('quickPostImage')?.addEventListener('change', e=>{ const f = e.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ $('quickPostPreview').innerHTML = `<img src="${r.result}" style="max-width:120px; border-radius:8px">`; $('quickPostPreview').dataset.img = r.result; }; r.readAsDataURL(f); });
$('quickPostSend')?.addEventListener('click', ()=>{
  const text = $('quickPostText').value.trim(); const img = $('quickPostPreview').dataset.img || null;
  if(!text && !img) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ');
  const city = Store.getCity()||'‚Äî'; const p = Store.getProfile() || {id:'u_demo', name:'–ì–æ—Å—Ç—å'};
  const post = { id:'post_'+uid(), authorName: p.name, text, image: img, ts: nowISO(), likes:{byUser:{}}, comments:[] };
  const feed = Store.getCityFeed(); feed[city] = feed[city] || []; feed[city].unshift(post); Store.setCityFeed(feed); closeScreen('quickPostModal'); renderCityPosts(); alert('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ');
});

// repost picker (simple)
function openRepostPicker(post){
  openScreen('repostScreen'); const list = $('repostList'); list.innerHTML=''; const chats = Store.getChats();
  if(!chats.length){ list.innerHTML = '<div class="small">–ù–µ—Ç —á–∞—Ç–æ–≤</div>'; return; }
  chats.forEach(c=>{ const item = document.createElement('div'); item.className='card'; item.innerHTML = `<div style="font-weight:900">${esc(c.title||'–ß–∞—Ç')}</div><div class="small" style="margin-top:6px">${esc(c.meta?.context||'')}</div>`; item.addEventListener('click', ()=>{ repostToChat(c.id, post); closeScreen('repostScreen'); openChatWindow(c.id); }); list.appendChild(item); });
}
function repostToChat(chatId, post){
  Store.updateChat(chatId, c=>{ const me = Store.getProfile()||{id:'u_demo', name:'–í—ã'}; const snippet = `üîÅ –†–µ–ø–æ—Å—Ç: ${post.text||''}`; c.messages.push({fromId: me.id, text: snippet, image: post.image||null, ts: nowISO()}); });
  const n = Store.getNotifs(); n.unshift({ id:'n_'+uid(), type:'message', title:'–†–µ–ø–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', body:'–ü–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç', ts: nowISO() }); Store.setNotifs(n); refreshPanelNotif();
}

// like/comment helpers
function sendComment(postId, text){ if(!text) return; const me = Store.getProfile()||{name:'–í—ã'}; const feed = Store.getCityFeed(); const city = Store.getCity()||'‚Äî'; const posts = feed[city]||[]; const post = posts.find(p=>p.id===postId); if(!post) return; post.comments = post.comments||[]; post.comments.push({ id:'c_'+uid(), authorName: me.name, text, ts: nowISO() }); Store.setCityFeed(feed); renderCityPosts(); }
function toggleLike(postId){ const me = Store.getProfile()?.id || 'u_demo'; const feed = Store.getCityFeed(); const city = Store.getCity()||'‚Äî'; const posts = feed[city]||[]; const post = posts.find(p=>p.id===postId); if(!post) return; post.likes = post.likes || { byUser:{} }; if(post.likes.byUser[me]) delete post.likes.byUser[me]; else post.likes.byUser[me]=true; Store.setCityFeed(feed); renderCityPosts(); }

// chats
function renderChats(){ const wrap = $('chatsList'); wrap.innerHTML=''; const chats = Store.getChats(); if(!chats.length) { wrap.innerHTML='<div class="small">–ü–æ–∫–∞ –Ω–µ—Ç —á–∞—Ç–æ–≤</div>'; return; } chats.forEach(c=>{ const card = document.createElement('div'); card.className='card'; card.innerHTML=`<div style="flex:0 0 36px"><div class="avatar">${(c.title||'–ß')[0]}</div></div><div style="flex:1"><div style="font-weight:900">${esc(c.title)}</div><div class="small" style="margin-top:6px">${esc(c.meta?.context||'')}</div></div>`; card.addEventListener('click', ()=> openChatWindow(c.id)); wrap.appendChild(card); }); }
let __currentChatId = null;
function openChatWindow(chatId){
  const chat = Store.getChats().find(c=>c.id===chatId); if(!chat) return alert('–ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω'); __currentChatId = chatId; openScreen('messengerScreen'); renderChats();
}

// wire main buttons
function wireMainButtons(){
  ['btnOrder','btnFind','btnMessenger','btnWallet','btnMine','btnAds','btnCityThread'].forEach(id=>{
    const el = $(id); if(!el) return;
    el.onclick = ()=>{
      if(id==='btnOrder') { openScreen('createScreen'); }
      if(id==='btnFind') { openScreen('findScreen'); renderFindList(); }
      if(id==='btnMessenger'){ openScreen('messengerScreen'); renderChats(); }
      if(id==='btnWallet'){ openScreen('walletScreen'); }
      if(id==='btnMine'){ openScreen('mineScreen'); renderMineList(); }
      if(id==='btnAds'){ openScreen('adsScreen'); renderAds && renderAds(); }
      if(id==='btnCityThread'){ openScreen('cityThreadScreen'); renderCityPosts(); }
    };
  });
}

// ads rendering (simple)
function renderAds(){ const wrap=$('adsList'); if(!wrap) return; wrap.innerHTML=''; const ads=[]; if(!ads.length) wrap.innerHTML='<div class="small">–û–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ—Ç</div>'; }

// profile
$('openProfile')?.addEventListener('click', ()=>{ openScreen('profileScreen'); renderProfile(); });
function renderProfile(){ const wrap = $('profileWrap'); const p = Store.getProfile() || {id:'u_demo', name:'–ì–æ—Å—Ç—å'}; wrap.innerHTML = `<div class="card"><div style="flex:0 0 36px"><div class="avatar">${(p.name||'–ì')[0]}</div></div><div style="flex:1"><div style="font-weight:900">${esc(p.name)}</div><div style="margin-top:8px"><button class="btn" id="editProfileBtn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></div></div></div>`; $('editProfileBtn')?.addEventListener('click', ()=>{ const name = prompt('–ò–º—è', p.name||''); if(!name) return; p.name = name; Store.setProfile(p); renderProfile(); updateShareProfile(); }); }

// auth (simple)
document.addEventListener('DOMContentLoaded', ()=>{ if(!Store.getProfile()){ Store.setProfile({ id:'u_'+uid(), name:'–í—ã' }); } applyTheme(); populateCitySelect(); updateCityLabel(); renderThemePicker(); renderCenterDate(); loadReminders(); ensurePanelNotification(); applyRoleUI(); renderCityPosts(); renderFindList(); renderMineList(); renderChats(); runWelcomeSequence(); });

// welcome overlay
function runWelcomeSequence(){ const overlay = document.createElement('div'); overlay.innerHTML=''; } // kept minimal (you had welcome earlier)

// simple helpers
function esc(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }
function openScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); const el=$(id); if(el) el.classList.add('active'); }
function closeScreen(id){ const el=$(id); if(el) el.classList.remove('active'); }

// share panel behavior
function updateShareProfile(){ const p = Store.getProfile(); $('shareAvatar').textContent = (p.name||'–í—ã')[0]; $('shareName').textContent = p.name||'–í—ã'; }
$('sharePlaceholder')?.addEventListener('click', ()=> openScreen('quickPostModal'));
$('sharePlaceholder')?.addEventListener('click', ()=> openScreen('quickPostModal'));
$('sharePlaceholder')?.addEventListener('keydown', ()=> openScreen('quickPostModal'));
$('sharePlaceholder')?.addEventListener('click', ()=> openScreen('quickPostModal'));

updateShareProfile();
</script>
</body>
</html>
