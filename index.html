<!doctype html>
<html lang="ru" data-theme="violet">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GiD City ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg-1:#060614; --bg-2:#07081a; --bg-3:#090b22;
  --surface:rgba(20,24,40,.76);
  --line:rgba(160,170,230,.18);
  --accent:#a970ff; --accent2:#32ffd2; --gold:#ffd84d;
  --text:#ffffff; --muted:#9aa6d9;
  --ui-font:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --glass-border: rgba(255,255,255,.06);
}
[data-theme="violet"]{ --accent:#a970ff; --accent2:#32ffd2; --line:rgba(160,170,230,.22); --surface:rgba(20,24,40,.92); }
[data-theme="navy"]{ --accent:#44a0ff; --accent2:#76f1ff; --line:rgba(120,170,235,.18); --surface:rgba(10,18,34,.9); }
[data-theme="emerald"]{ --accent:#2fe4a3; --accent2:#27d8ff; --line:rgba(120,230,200,.16); --surface:rgba(5,28,20,.88); }
[data-theme="sunset"]{ --accent:#ff7a5c; --accent2:#ffd471; --line:rgba(255,180,140,.12); --surface:rgba(30,18,12,.86); }
[data-theme="mint"]{ --accent:#5ef2c6; --accent2:#6bd1ff; --line:rgba(140,240,220,.14); --surface:rgba(8,22,18,.88); }
[data-theme="coral"]{ --accent:#ff6b6b; --accent2:#ffd08a; --line:rgba(255,150,120,.12); --surface:rgba(28,18,20,.88); }
[data-theme="cyan"]{ --accent:#2be7ff; --accent2:#2b9eff; --line:rgba(120,230,255,.12); --surface:rgba(6,18,20,.88); }
[data-theme="indigo"]{ --accent:#6b5cff; --accent2:#9a8bff; --line:rgba(150,130,255,.12); --surface:rgba(8,10,28,.9); }
[data-theme="rose"]{ --accent:#ff8ab3; --accent2:#ff6f8f; --line:rgba(255,140,180,.12); --surface:rgba(28,12,16,.9); }
[data-theme="lime"]{ --accent:#c6ff4d; --accent2:#8cff6b; --line:rgba(200,255,120,.12); --surface:rgba(12,20,8,.9); }

/* base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font:14px var(--ui-font); color:var(--text);
  background:
    radial-gradient(900px at 20% -10%, rgba(30,27,58,.35) 0%, transparent 70%),
    linear-gradient(180deg,var(--bg-1),var(--bg-2),var(--bg-3));
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
.wrapper{ max-width:1000px; margin:18px auto; padding:0 14px; display:flex; flex-direction:column; gap:12px; }

/* glass basics */
.modal, .menu-btn, .btn, .input, textarea, select, .post-card, .city-composer-top {
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06));
  border:1px solid var(--glass-border);
  border-radius:12px;
  backdrop-filter: blur(8px) saturate(120%);
}
.btn{ padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:900; border:1px solid var(--glass-border); color:var(--text); }
.btn.primary{ background: linear-gradient(90deg,var(--accent),var(--accent2)); color:#061018; border:none; }

/* header */
.header{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.brand{ display:flex; gap:12px; align-items:center; flex-direction:column; }
.brand-row{ display:flex; gap:12px; align-items:center; width:100%; justify-content:flex-start; }
.brand h1{ margin:0; font-size:20px; font-weight:900; background:linear-gradient(90deg,var(--accent),var(--accent2)); -webkit-background-clip:text; color:transparent; }
.buildInfo{ font-size:12px; color:var(--muted); display:flex; gap:12px; align-items:center; }
#time { font-weight:900; font-size:14px; }

/* main container */
.container{ border-radius:18px; background:var(--surface); border:1px solid var(--line); box-shadow:0 16px 46px rgba(0,0,0,.45); overflow:hidden }
.panel-top{ display:flex; align-items:center; justify-content:space-between; padding:14px; border-bottom:1px solid rgba(255,255,255,.02) }
.panel-top h2{ margin:0; font-weight:900; font-size:18px; display:flex; gap:10px; align-items:center; }

/* current city (static) */
.current-city { font-weight:900; color:var(--muted); font-size:13px; margin-left:8px; }

/* menu grid */
.menu-grid{ display:grid; gap:10px; padding:16px; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); align-items:stretch; }
.menu-btn{ display:flex; gap:12px; align-items:center; padding:12px; border-radius:12px; border:1px solid var(--line); background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.12)); cursor:pointer; justify-content:space-between; transition:transform .12s ease; }
.menu-btn:hover{ transform: translateY(-4px); }
.menu-btn .title{ font-weight:900; display:flex; gap:10px; align-items:center; }
.menu-btn .small{ color:var(--muted); font-weight:700; font-size:12px; }
.neon-icon{ width:34px; height:34px; display:inline-grid; place-items:center; border-radius:10px; color:var(--accent2); filter: drop-shadow(0 0 8px rgba(50,255,200,.08)); }

/* screen/modal */
.screen{ position:fixed; inset:0; display:none; z-index:90; align-items:flex-start; justify-content:center; padding:18px; background:rgba(0,0,0,.45); backdrop-filter:blur(6px); }
.screen.active{ display:flex; }
.modal{ width:100%; max-width:980px; max-height:88vh; overflow:auto; background:var(--surface); color:var(--text); border-radius:12px; border:1px solid var(--line); padding:14px; box-shadow:0 16px 46px rgba(0,0,0,.45) }

/* inputs */
.input, textarea, select{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line); background:rgba(12,16,36,.75); color:var(--text); outline:none; font-size:14px; }
textarea{ min-height:120px; resize:vertical }

/* city composer */
.city-composer-top{ position:sticky; top:18px; z-index:30; display:flex; gap:10px; align-items:center; padding:10px 12px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)); border:1px solid rgba(255,255,255,.03); }
.city-composer-top .avatar{ width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,var(--accent),var(--accent2)); font-weight:800; }
.city-composer-top .placeholder{ padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.02); flex:1; color:var(--muted); cursor:pointer; }

/* post card */
.post-card{ background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.04); border-radius:12px; padding:12px; margin-bottom:10px; }
.post-top{ display:flex; gap:10px; align-items:center; }
.post-top .avatar{ width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,var(--accent),var(--accent2)); font-weight:800; }
.post-actions{ display:flex; gap:10px; margin-top:8px; align-items:center; }
.post-actions .act{ background:transparent; border:none; color:var(--muted); cursor:pointer; font-weight:800; padding:6px 8px; border-radius:8px; }

/* file icon */
.file-ic{ width:44px; height:44px; border-radius:10px; display:inline-grid; place-items:center; border:1px solid var(--glass-border); background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)); cursor:pointer; color:var(--muted); }

/* small */
.small{ font-size:12px; color:var(--muted) }

/* responsive */
@media (max-width:900px){
  .menu-grid{ grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); }
}
</style>
</head>
<body>
<div class="wrapper">

  <header class="header">
    <div class="brand">
      <div class="brand-row">
        <h1>GiDCity</h1>
        <div class="buildInfo" style="margin-left:8px;">
          <div id="dateTime"><span id="time">‚Äî</span> <span id="date">‚Äî</span></div>
          <div id="weather"><span>‚õÖ</span> ‚Äî</div>
        </div>
        <div class="current-city" id="currentCity">–ö–∞—Ä–∞–≥–∞–Ω–¥–∞</div>
      </div>
    </div>

    <div style="display:flex; gap:8px; align-items:center;">
      <button id="openSettings" class="btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
      <button id="notifBtnTop" class="btn" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">üîî <span id="notifBadgeTop" class="small" style="margin-left:6px;display:none">0</span></button>
    </div>
  </header>

  <div id="roleTabs" class="role-tabs" style="display:flex;gap:8px;"></div>

  <main class="container" role="main" aria-live="polite">
    <div class="panel-top">
      <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
      <div></div>
    </div>

    <div id="menuGrid" class="menu-grid"></div>
  </main>

  <div class="footer-note small">KASSEN Technology Inc</div>
</div>

<!-- settings modal: CITY & THEMES scrollers -->
<section id="settingsModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <button onclick="closeScreen('settingsModal')" class="btn">–ù–∞–∑–∞–¥</button>
  </div>

  <div style="margin-top:12px; display:flex; gap:12px; flex-direction:column;">
    <div style="font-weight:900">–ü—Ä–æ—Ñ–∏–ª—å</div>
    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
      <input id="profileName" class="input" placeholder="–í–∞—à–µ –∏–º—è" style="max-width:220px">
      <input id="profileAvatar" class="input" placeholder="–ê–≤–∞—Ç–∞—Ä (emoji)" style="max-width:140px">
      <button id="saveProfileBtn" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <div style="margin-top:12px; font-weight:900">–í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞</div>
    <div style="display:flex; gap:8px; overflow:auto; padding:8px 4px;" id="cityScroller"></div>
    <div class="small">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ ‚Äî —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ª–µ–Ω—Ç—É –∏ –ø–æ–≥–æ–¥—É</div>

    <div style="margin-top:12px; font-weight:900">–¢–µ–º–∞</div>
    <div style="display:flex; gap:8px; overflow:auto; padding:8px 4px;" id="themeScroller"></div>
    <div class="small">10 —Ç–µ–º ‚Äî –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å</div>

    <div style="margin-top:12px; font-weight:900">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (JSONBin)</div>
    <div style="display:flex; gap:8px; align-items:center;">
      <label class="small">–ê–≤—Ç–æ</label>
      <input id="syncToggle" type="checkbox">
      <button id="syncNowBtn" class="btn">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å</button>
    </div>
  </div>
</div></section>

<!-- city thread -->
<section id="cityThreadScreen" class="screen"><div class="modal" style="width:100%; max-width:980px; height:88vh; overflow:hidden;">
  <div style="display:flex; justify-content:space-between; align-items:center; padding-bottom:8px;">
    <h3 style="margin:0">–ß–∞—Ç –≥–æ—Ä–æ–¥–∞ ‚Äî <span id="cityThreadTitle">–ö–∞—Ä–∞–≥–∞–Ω–¥–∞</span></h3>
    <button onclick="closeScreen('cityThreadScreen')" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <div class="city-thread-wrap" style="height:calc(100% - 48px); display:flex; flex-direction:column;">
    <div class="city-composer-top">
      <div class="avatar" id="topComposerAvatar">–Ø</div>
      <div class="placeholder" id="topComposerPlaceholder">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç...</div>
      <div style="display:flex; gap:8px; align-items:center;">
        <div id="quickFileBtn" class="file-ic" title="–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ">üìé</div>
      </div>
    </div>

    <div id="cityScroll" style="overflow:auto; padding:12px; flex:1;">
      <div id="cityPosts"></div>
    </div>
  </div>
</div></section>

<!-- quick post -->
<section id="quickPostModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –ª–µ–Ω—Ç–µ</h3>
    <button onclick="closeScreen('quickPostModal')" class="btn">–û—Ç–º–µ–Ω–∞</button>
  </div>
  <div style="margin-top:12px;">
    <textarea id="quickPostText" class="input" placeholder="–û —á—ë–º —Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å?"></textarea>
    <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
      <input id="quickPostImage" type="file" accept="image/*" style="display:none">
      <div id="quickPostFileBtn" class="file-ic" title="–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª">üì∑</div>
      <div id="quickPostPreview" style="margin-top:8px; flex:1;"></div>
    </div>
    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
      <button id="quickPostSend" class="btn primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>
  </div>
</div></section>

<!-- create order (kept minimal for demo) -->
<section id="createScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3 style="margin:0">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h3>
    <button onclick="closeScreen('createScreen')" class="btn">–ù–∞–∑–∞–¥</button>
  </div>
  <div style="margin-top:12px;">
    <div id="createTabs" style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px"></div>
    <form id="createForm">
      <textarea id="c-desc" class="input" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É"></textarea>
      <div style="display:flex; gap:8px; margin-top:12px;">
        <input id="c-datetime" class="input" type="datetime-local" style="flex:1">
        <input id="c-budget" class="input" type="number" style="width:160px" placeholder="‚Ç∏">
      </div>
      <div style="display:flex; gap:12px; margin-top:18px; justify-content:flex-end;">
        <button class="btn" type="button" onclick="closeScreen('createScreen')">–û—Ç–º–µ–Ω–∞</button>
        <button id="submitOrderBtn" class="btn primary" type="button">–ó–∞–∫–∞–∑–∞—Ç—å</button>
      </div>
    </form>
  </div>
</div></section>

<!-- messenger (kept) -->
<section id="messengerScreen" class="screen"><div class="modal" style="width:100%; max-width:980px; height:88vh; overflow:hidden;">
  <div style="display:flex; justify-content:space-between; align-items:center; padding-bottom:8px;">
    <h3 style="margin:0">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</h3>
    <div>
      <button id="createChatBtn" class="btn">–°–æ–∑–¥–∞—Ç—å —á–∞—Ç</button>
      <button onclick="closeScreen('messengerScreen')" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
  <div style="display:flex; height:calc(100% - 48px); gap:12px;">
    <div style="flex:1; display:flex; flex-direction:column; gap:8px;">
      <div style="font-weight:900">–î–∏–∞–ª–æ–≥–∏</div>
      <div id="chatsList" style="overflow:auto; flex:1; padding-right:6px;"></div>
    </div>
    <div id="chatPane" style="width:420px; border-left:1px solid rgba(255,255,255,.02); padding-left:12px; display:flex; flex-direction:column;">
      <div id="chatWindowHeader" class="chat-top" style="display:none;">
        <div class="avatar" id="chatHeaderAvatar">–ë</div>
        <div>
          <div id="chatHeaderName" style="font-weight:900">–°–æ–±–µ—Å–µ–¥–Ω–∏–∫</div>
          <div class="small" id="chatHeaderSub">–ò–Ω—Ñ–æ</div>
        </div>
      </div>
      <div id="chatWindow" style="display:none; flex:1; flex-direction:column;">
        <div id="chatMsgs" class="msgs"></div>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <input id="chatInput" class="input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
          <button id="chatSend" class="btn primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
      <div id="chatEmpty" style="display:flex; align-items:center; justify-content:center; flex:1; color:var(--muted);">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π</div>
    </div>
  </div>
</div></section>

<script>
/* state */
const LS_KEY = 'gid_state_v12';
const $ = id=>document.getElementById(id);
const uid = ()=> Math.random().toString(36).slice(2,9);
const nowISO = ()=> new Date().toISOString();

let STATE = {
  profile:{id:'u_me',name:'–í—ã',avatar:'ü§ñ'},
  city:'–ö–∞—Ä–∞–≥–∞–Ω–¥–∞',
  theme:'violet',
  orders:[], feed:{}, chats:[], notifs:[], syncEnabled:true
};
try{ const s=localStorage.getItem(LS_KEY); if(s) STATE=Object.assign(STATE,JSON.parse(s)); }catch(e){}

/* helpers */
function save(){ localStorage.setItem(LS_KEY, JSON.stringify(STATE)); }
function openScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); const el=$(id); if(el) el.classList.add('active'); }
function closeScreen(id){ const el=$(id); if(el) el.classList.remove('active'); }
function esc(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

/* date/time + weather (simple) */
function updateDateTime(){ const now=new Date(); $('time').textContent = now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0'); $('date').textContent = now.toLocaleDateString('ru-RU',{day:'numeric',month:'long',year:'numeric'}); }
updateDateTime(); setInterval(updateDateTime,60000);

/* render role tabs */
const ROLES=[{k:'user',label:'–°–§–ï–†–ê –£–°–õ–£–ì'},{k:'worker',label:'–ü–û–î–†–ê–ë–û–¢–ö–ê'}];
function renderRoleTabs(){ const container = document.getElementById('roleTabs'); container.innerHTML=''; ROLES.forEach(r=>{ const d=document.createElement('div'); d.className='role-tab'; d.textContent=r.label; d.style.padding='10px 18px'; d.style.borderRadius='12px'; d.style.cursor='pointer'; d.style.fontWeight='900'; if(STATE.role===r.k) d.style.background='var(--gold)'; d.onclick=()=>{ STATE.role=r.k; save(); renderRoleTabs(); renderMenu(); }; container.appendChild(d); }); }
STATE.role = STATE.role || 'user';
renderRoleTabs();

/* menu with unique icons */
function menuBtn(id,title,note,icon){
  const el=document.createElement('div'); el.className='menu-btn'; el.id=id;
  el.innerHTML = `<div style="display:flex;align-items:center;gap:12px;">
    <div class="neon-icon" aria-hidden style="font-size:18px">${icon}</div>
    <div style="display:flex;flex-direction:column;">
      <div class="title">${title}</div>
      <div class="small">${note||''}</div>
    </div></div><div style="margin-left:12px">‚Ä∫</div>`;
  return el;
}
function renderMenu(){
  const grid=$('menuGrid'); grid.innerHTML='';
  if(STATE.role==='user'){
    grid.appendChild(menuBtn('btnOrder','–ó–ê–ö–ê–ó–ê–¢–¨','–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É','üìù'));
    grid.appendChild(menuBtn('btnBook','–ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨','–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ','üìÖ'));
    grid.appendChild(menuBtn('btnCity','–ß–ê–¢ –ì–û–†–û–î–ê','–õ–µ–Ω—Ç–∞ –≥–æ—Ä–æ–¥–∞','üèôÔ∏è'));
    grid.appendChild(menuBtn('btnMine','–ú–û–ò –ó–ê–ö–ê–ó–´','–í–∞—à–∏ –∑–∞—è–≤–∫–∏','üìÇ'));
    grid.appendChild(menuBtn('btnMessenger','–ú–ï–°–°–ï–ù–î–ñ–ï–†','–î–∏–∞–ª–æ–≥–∏','üí¨'));
    grid.appendChild(menuBtn('btnAds','–û–ë–™–Ø–í–õ–ï–ù–ò–Ø','–°–ø–∏—Å–æ–∫','üì£'));
    grid.appendChild(menuBtn('btnWallet','–ö–û–®–ï–õ–Å–ö','–ë–∞–ª–∞–Ω—Å','üí≥'));
  } else {
    grid.appendChild(menuBtn('btnFind','–ù–ê–ô–¢–ò –ó–ê–ö–ê–ó–´','–î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π','üîé'));
    grid.appendChild(menuBtn('btnCity','–ß–ê–¢ –ì–û–†–û–î–ê','–õ–µ–Ω—Ç–∞ –≥–æ—Ä–æ–¥–∞','üèôÔ∏è'));
    grid.appendChild(menuBtn('btnMine','–ú–û–ò –ó–ê–ö–ê–ó–´','–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ/–º–æ–∏','üìÇ'));
    grid.appendChild(menuBtn('btnMessenger','–ú–ï–°–°–ï–ù–î–ñ–ï–†','–î–∏–∞–ª–æ–≥–∏','üí¨'));
    grid.appendChild(menuBtn('btnAds','–û–ë–™–Ø–í–õ–ï–ù–ò–Ø','–°–ø–∏—Å–æ–∫','üì£'));
    grid.appendChild(menuBtn('btnWallet','–ö–û–®–ï–õ–Å–ö','–ë–∞–ª–∞–Ω—Å','üí≥'));
  }
  grid.querySelectorAll('.menu-btn').forEach(el=>{
    el.onclick=()=>{
      const id=el.id;
      if(id==='btnOrder'){ openScreen('createScreen'); initCreate(); }
      if(id==='btnBook'){ alert('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –¥–µ–º–æ'); }
      if(id==='btnCity'){ renderCity(); openScreen('cityThreadScreen'); }
      if(id==='btnMine'){ renderMine(); openScreen('bidsModal'); }
      if(id==='btnMessenger'){ renderChats(); openScreen('messengerScreen'); }
      if(id==='btnFind'){ renderFind(); openScreen('findScreen'); }
      if(id==='btnAds'){ alert('–û–±—ä—è–≤–ª–µ–Ω–∏—è ‚Äî –¥–µ–º–æ'); }
      if(id==='btnWallet'){ alert('–ö–æ—à–µ–ª—ë–∫ ‚Äî –¥–µ–º–æ'); }
    };
  });
}
renderMenu();

/* SETTINGS: CITY scroller and THEME scroller */
const KZ_CITIES = ['–ê–ª–º–∞—Ç—ã','–ê—Å—Ç–∞–Ω–∞','–®—ã–º–∫–µ–Ω—Ç','–ö–∞—Ä–∞–≥–∞–Ω–¥–∞','–ê–∫—Ç–æ–±–µ','–ü–∞–≤–ª–æ–¥–∞—Ä','–£—Å—Ç—å-–ö–∞–º–µ–Ω–æ–≥–æ—Ä—Å–∫','–°–µ–º–µ–π','–ö–æ—Å—Ç–∞–Ω–∞–π','–ö–æ–∫—à–µ—Ç–∞—É','–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫','–¢–∞—Ä–∞–∑','–£—Ä–∞–ª—å—Å–∫','–ê—Ç—ã—Ä–∞—É','–ö—ã–∑—ã–ª–æ—Ä–¥–∞','–ê–∫—Ç–∞—É','–¢–∞–ª–¥—ã–∫–æ—Ä–≥–∞–Ω','–ö–µ–Ω—Ç–∞—É','–ï–∫–∏–±–∞—Å—Ç—É–∑','–†—É–¥–Ω—ã–π'];
function renderSettingsPickers(){
  const cityWrap = $('cityScroller'); cityWrap.innerHTML='';
  KZ_CITIES.forEach(c=>{
    const chip=document.createElement('div'); chip.className='city-chip'; chip.textContent=c;
    chip.style.padding='10px 14px'; chip.style.borderRadius='12px'; chip.style.cursor='pointer'; chip.style.border='1px solid rgba(255,255,255,.04)'; chip.style.whiteSpace='nowrap';
    if(c===STATE.city){ chip.style.background='linear-gradient(90deg,var(--accent),var(--accent2))'; chip.style.color='#061018'; }
    chip.onclick=()=>{ STATE.city=c; save(); $('currentCity').textContent=c; document.querySelectorAll('#cityScroller .city-chip').forEach(x=>x.style.background=''); renderSettingsPickers(); renderCity(); renderFindList(); };
    cityWrap.appendChild(chip);
  });

  const THEMES = ['violet','navy','emerald','sunset','mint','coral','cyan','indigo','rose','lime'];
  const themeWrap = $('themeScroller'); themeWrap.innerHTML='';
  THEMES.forEach(t=>{
    const chip=document.createElement('div'); chip.className='theme-chip'; chip.textContent=t.charAt(0).toUpperCase()+t.slice(1);
    chip.style.padding='12px 16px'; chip.style.borderRadius='12px'; chip.style.cursor='pointer'; chip.style.border='1px solid rgba(255,255,255,.04)'; chip.style.whiteSpace='nowrap'; chip.style.marginRight='8px';
    if(t===STATE.theme){ chip.style.boxShadow='0 8px 30px rgba(0,0,0,.25)'; chip.style.background='linear-gradient(90deg,var(--accent),var(--accent2))'; chip.style.color='#061018'; }
    chip.onclick=()=>{ applyTheme(t); renderSettingsPickers(); };
    themeWrap.appendChild(chip);
  });
}
function applyTheme(t){ document.documentElement.setAttribute('data-theme', t); STATE.theme=t; save(); }
applyTheme(STATE.theme || 'violet');

/* notifications */
function refreshNotif(){ const n = (STATE.notifs||[]).length; const b=$('notifBadgeTop'); if(n>0){ b.style.display='inline-block'; b.textContent = n>99?'99+':String(n);} else b.style.display='none'; }
refreshNotif();

/* CREATE order (minimal) */
const CATS = ['–°–ü–ï–¶. –ó–ê–ö–ê–ó','–¢–∞–∫—Å–∏','–ö—É—Ä—å–µ—Ä','–î–æ—Å—Ç–∞–≤–∫–∞','–ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–æ–º','–ú–∞—Å—Ç–µ—Ä/–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç','–ü—Ä–æ—á–∏–µ'];
function initCreate(){ const wrap=$('createTabs'); wrap.innerHTML=''; CATS.forEach((c,i)=>{ const d=document.createElement('div'); d.textContent=c; d.style.padding='8px 12px'; d.style.cursor='pointer'; d.style.borderRadius='10px'; d.style.border='1px solid rgba(255,255,255,.04)'; if(i===0) d.style.background='var(--gold)'; d.onclick=()=>{ Array.from(wrap.children).forEach(x=>x.style.background=''); d.style.background='var(--gold)'; }; wrap.appendChild(d); }); }

/* FIND orders (placeholder) */
function renderFind(){ const sel = document.getElementById('filterCat'); if(sel){ sel.innerHTML='<option value="">–í—Å–µ</option>'; CATS.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); }); } renderFindList(); }
function renderFindList(){ const wrap=document.getElementById('findList'); if(!wrap) return; wrap.innerHTML=''; const items = (STATE.orders||[]).filter(o=>o.city===STATE.city); if(!items.length){ wrap.innerHTML='<div class="small">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>'; return; } items.forEach(o=>{ const card=document.createElement('div'); card.className='post-card'; card.innerHTML=`<div style="font-weight:900">${esc(o.category)} ‚Ä¢ ${esc(o.city)}</div><div class="small" style="margin-top:6px">${esc(o.desc)}</div>`; wrap.appendChild(card); }); }

/* MINE orders (placeholder) */
function renderMine(){ const wrap=document.getElementById('bidsList'); if(!wrap) return; wrap.innerHTML=''; const mine=(STATE.orders||[]).filter(o=>o.ownerId===STATE.profile.id); if(!mine.length){ wrap.innerHTML='<div class="small">–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>'; return; } mine.forEach(o=>{ const card=document.createElement('div'); card.className='post-card'; card.innerHTML=`<div style="font-weight:900">${esc(o.category)}</div><div class="small">${esc(o.desc)}</div>`; wrap.appendChild(card); }); }

/* CITY THREAD: render posts */
function renderCity(){
  $('cityThreadTitle').textContent = STATE.city;
  const wrap = $('cityPosts'); wrap.innerHTML='';
  const posts = (STATE.feed[STATE.city] || []);
  if(!posts.length){ wrap.innerHTML = '<div class="small">–ü–æ–∫–∞ –Ω–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</div>'; return; }
  posts.forEach(p=>{
    const el=document.createElement('div'); el.className='post-card';
    el.innerHTML = `<div class="post-top"><div class="avatar">${(p.authorName||'–ü')[0]}</div>
      <div style="display:flex;flex-direction:column;"><div style="font-weight:900">${esc(p.authorName)}</div><div class="small">${new Date(p.ts).toLocaleString()}</div></div></div>
      <div style="margin-top:8px;white-space:pre-wrap">${esc(p.text)}</div>
      ${p.image?`<img src="${p.image}" style="max-width:100%;margin-top:8px;border-radius:8px">`:''}
      <div class="post-actions"><button class="act">‚ù§Ô∏è</button><button class="act">üí¨</button></div>`;
    wrap.appendChild(el);
  });
}

/* QUICK POST (text + image) ‚Äî fixed and closes modal on success */
$('topComposerPlaceholder').addEventListener('click', ()=>{ $('quickPostText').value=''; $('quickPostPreview').innerHTML=''; $('quickPostImage').value=''; openScreen('quickPostModal'); });
$('quickPostFileBtn').addEventListener('click', ()=> $('quickPostImage').click());
$('quickFileBtn')?.addEventListener('click', ()=>{ $('quickPostImage').click(); openScreen('quickPostModal'); });

$('quickPostImage').addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{ $('quickPostPreview').innerHTML = `<img src="${r.result}" style="max-width:100%;border-radius:8px">`; $('quickPostPreview').dataset.img = r.result; };
  r.readAsDataURL(f);
});

$('quickPostSend').addEventListener('click', ()=>{
  const text = $('quickPostText').value.trim();
  const img = $('quickPostPreview').dataset.img || null;
  if(!text && !img){ alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ'); return; }
  const post = { id:'post_'+uid(), authorId:STATE.profile.id, authorName:STATE.profile.name||'–í—ã', text, image:img, ts: nowISO() };
  STATE.feed[STATE.city] = STATE.feed[STATE.city]||[]; STATE.feed[STATE.city].unshift(post);
  save();
  closeScreen('quickPostModal');
  closeScreen('createScreen'); // ensure create closed if open
  renderCity();
  alert('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω');
});

/* SETTINGS: save profile */
$('saveProfileBtn').addEventListener('click', ()=>{
  const name = $('profileName').value.trim(); const avat = $('profileAvatar').value.trim();
  if(name) STATE.profile.name = name;
  if(avat) STATE.profile.avatar = avat;
  save();
  alert('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
});

/* INITIALIZATION */
function init(){
  if(STATE.profile) $('topComposerAvatar').textContent = STATE.profile.avatar || '–Ø';
  $('currentCity').textContent = STATE.city;
  renderSettingsPickers();
  renderMenu();
  renderCity();
  renderFindList();
  refreshNotif();
}
init();

/* small helpers for screens */
document.querySelectorAll('.screen').forEach(s=>{
  s.addEventListener('click', (e)=>{ if(e.target===s) s.classList.remove('active'); });
});

/* expose debug */
window.GIDCITY = { STATE, save };
</script>
</body>
</html>
