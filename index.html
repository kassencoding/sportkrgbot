<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GiDCity –ú–µ–Ω—é</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --purple:#b37aff; --green:#7BFF5A; --text:#fff; --card:#111116; --muted:#9ba0a5;
  --focus: 0 0 0 3px rgba(123,255,90,.35);
  /* —Ñ–æ–Ω ‚Äî –∫–Ω–∏–∂–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è */
  --bg-img: url("data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?>\
<svg xmlns='http://www.w3.org/2000/svg' width='2400' height='1400'>\
<defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>\
<stop offset='0%' stop-color='%23b37aff'/><stop offset='55%' stop-color='%236671ff'/>\
<stop offset='100%' stop-color='%237BFF5A'/></linearGradient></defs>\
<rect fill='%230b0b12' width='100%' height='100%'/>\
<g opacity='0.88'>\
<path fill='url(%23g)' d='M0 300 C 400 200, 800 420, 1200 280 S 2000 220, 2400 340 L 2400 0 L 0 0 Z'/>\
<path fill='url(%23g)' opacity='0.45' d='M0 820 C 520 920, 920 700, 1420 820 S 2100 900, 2400 780 L 2400 1400 L 0 1400 Z'/>\
</g>\
<g fill='%23ffffff' fill-opacity='0.14'>\
<circle cx='200' cy='300' r='2'/><circle cx='420' cy='640' r='1.6'/>\
<circle cx='760' cy='180' r='1.8'/><circle cx='1220' cy='260' r='1.4'/>\
<circle cx='1680' cy='520' r='1.8'/><circle cx='2100' cy='940' r='1.6'/>\
</g></svg>");
}

/* —Ñ–æ–Ω */
body{
  margin:0; padding:20px; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text); min-height:100vh;
  background: linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.55)), var(--bg-img);
  background-size:cover; background-position:center; background-attachment:fixed;
}

/* –≥–ª–∞–≤–Ω–∞—è */
h1{margin:0 0 6px; font-weight:800; font-size:38px; color:var(--purple); text-shadow:0 0 14px rgba(179,122,255,.6)}
.tag{color:var(--green); margin-bottom:16px; text-shadow:0 0 8px rgba(123,255,90,.45)}
.tiles{display:grid; gap:14px; max-width:860px}

/* –∫–Ω–æ–ø–∫–∏ (glass) */
.btn{
  position:relative;
  display:flex; justify-content:center; align-items:center; gap:10px;
  width:100%; padding:16px 20px; border-radius:18px; cursor:pointer;
  text-decoration:none; font-size:18px; font-weight:800; letter-spacing:.2px;
  color:#fff; background:rgba(255,255,255,0.10); border:1px solid rgba(255,255,255,0.35);
  backdrop-filter:blur(18px);
  box-shadow:0 0 16px rgba(179,122,255,.35), 0 0 38px rgba(123,255,90,.28);
  transition:.25s ease;
}
.btn:hover{background:rgba(255,255,255,0.18); transform:translateY(-2px) scale(1.04)}
.btn:active{transform:scale(0.96)}
.btn:focus{outline:none; box-shadow:var(--focus)}
.secondary{background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.25); box-shadow:none}

/* –±–µ–π–¥–∂ —Å—á–µ—Ç—á–∏–∫–∞ */
.badge-btn{
  position:absolute; top:-8px; right:-8px;
  min-width:24px; height:24px; padding:0 6px;
  display:flex; align-items:center; justify-content:center;
  background:#ff4d4f; color:#fff; border-radius:999px; font-size:12px; border:2px solid rgba(255,255,255,.3);
}

/* –æ–∫–Ω–∞-–æ–≤–µ—Ä–ª–µ–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —Å–Ω–∏–∑—É */
.screen{ display:none; position:fixed; inset:0; padding:20px; overflow-y:auto; background:rgba(0,0,0,0.45); backdrop-filter:blur(16px) }
.screen.active{ display:block }
.panel{
  max-width:860px; margin:0 auto; background:rgba(0,0,0,0.55);
  border:1px solid rgba(255,255,255,0.25); border-radius:20px; padding:16px;
  transform:translateY(32px); opacity:0; animation:slideUp .28s cubic-bezier(.22,.8,.24,1) forwards;
}
@keyframes slideUp{ from{transform:translateY(34px);opacity:0} to{transform:translateY(0);opacity:1} }

.nav{display:flex; align-items:center; gap:10px; margin-bottom:8px}
.back{color:#fff; background:rgba(255,255,255,0.16); border:1px solid rgba(255,255,255,0.25); border-radius:12px; padding:8px 14px; text-decoration:none}
.wrap{background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.25); border-radius:16px; padding:16px}
label{font-size:13px; color:var(--muted)}
input,select,textarea{
  width:100%; margin-top:6px; margin-bottom:12px; background:rgba(255,255,255,0.06);
  color:#fff; border:1px solid rgba(255,255,255,0.25); border-radius:14px; padding:12px 14px; font-size:15px; outline:none; backdrop-filter:blur(10px)
}
input:focus,select:focus,textarea:focus{box-shadow:var(--focus); border-color:#3a3a59}
textarea{min-height:120px; resize:vertical}
.row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
@media(max-width:560px){ .row{grid-template-columns:1fr} }
.list{display:flex; flex-direction:column; gap:12px}
.item{background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.2); border-radius:16px; padding:14px; backdrop-filter:blur(14px)}
.title2{font-weight:700; font-size:17px}
.muted{color:var(--muted); font-size:13px}
.badge{display:inline-block; background:rgba(255,255,255,0.15); padding:4px 10px; border-radius:999px; margin-left:8px; font-size:12px}
.spacer{height:6px}
</style>
</head>
<body>

<!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
<section id="home">
  <h1>GiDCity</h1>
  <div class="tag">–ó–∞—à—ë–ª ‚Ä¢ –°–¥–µ–ª–∞–ª ‚Ä¢ –ó–∞—Ä–∞–±–æ—Ç–∞–ª</div>
  <div class="tiles">
    <button class="btn" onclick="openScreen('find')">üîç –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã <span id="ordersCountBadge" class="badge-btn" style="display:none">0</span></button>
    <button class="btn" onclick="openScreen('create')">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
    <button class="btn" onclick="openScreen('exec')">üõ† –°—Ç–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º</button>
    <button class="btn" onclick="openScreen('mine')">üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</button>
    <button class="btn secondary" id="openInChat">–û—Ç–∫—Ä—ã—Ç—å –≤ —á–∞—Ç–µ</button>
  </div>
</section>

<!-- –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ) -->
<section id="find" class="screen" aria-labelledby="findTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="findTitle">–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã</h1>
    <div class="wrap">
      <form id="filterForm">
        <div class="row">
          <div>
            <label for="f-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="f-category" name="category">
              <option value="">–õ—é–±–∞—è</option>
              <option>–ö—É—Ä—å–µ—Ä</option><option>–£–±–æ—Ä–∫–∞</option><option>–†–µ–º–æ–Ω—Ç</option>
              <option>–î–∏–∑–∞–π–Ω</option><option>IT</option><option>–î—Ä—É–≥–æ–µ</option>
            </select>
          </div>
          <div>
            <label for="f-city">–ì–æ—Ä–æ–¥</label>
            <input id="f-city" name="city" placeholder="–ê–ª–º–∞—Ç—ã / –ê—Å—Ç–∞–Ω–∞" />
          </div>
        </div>
        <div class="row">
          <div><label for="f-min">–ë—é–¥–∂–µ—Ç –æ—Ç (‚Ç∏)</label><input id="f-min" name="min" type="number" min="0" placeholder="0" /></div>
          <div><label for="f-max">–ë—é–¥–∂–µ—Ç –¥–æ (‚Ç∏)</label><input id="f-max" name="max" type="number" min="0" placeholder="100000" /></div>
        </div>
        <button class="btn" type="submit">üîé –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
      </form>
    </div>
    <div class="spacer"></div>
    <div id="findList" class="list" aria-live="polite"></div>
  </div>
</section>

<!-- –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ -->
<section id="create" class="screen" aria-labelledby="createTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="createTitle">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h1>
    <div class="wrap">
      <form id="createForm">
        <div class="row">
          <div>
            <label for="c-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="c-category" name="category" required>
              <option>–ö—É—Ä—å–µ—Ä</option><option>–£–±–æ—Ä–∫–∞</option><option>–†–µ–º–æ–Ω—Ç</option>
              <option>–î–∏–∑–∞–π–Ω</option><option>IT</option><option>–î—Ä—É–≥–æ–µ</option>
            </select>
          </div>
          <div>
            <label for="c-city">–ì–æ—Ä–æ–¥</label>
            <input id="c-city" name="city" placeholder="–ê–ª–º–∞—Ç—ã" required />
          </div>
        </div>
        <div class="row">
          <div><label for="c-budget">–ë—é–¥–∂–µ—Ç (‚Ç∏)</label><input id="c-budget" name="budget" type="number" min="0" placeholder="15000" required /></div>
          <div><label for="c-deadline">–î–µ–¥–ª–∞–π–Ω</label><input id="c-deadline" name="deadline" type="date" required /></div>
        </div>
        <label for="c-desc">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
        <textarea id="c-desc" name="desc" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å? –ê–¥—Ä–µ—Å, –≤—Ä–µ–º—è, –¥–µ—Ç–∞–ª–∏‚Ä¶" required></textarea>
        <div class="row">
          <div><label for="c-contact">–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="c-contact" name="contact" placeholder="@username –∏–ª–∏ +7‚Ä¶" required /></div>
          <div><label for="c-name">–ò–º—è</label><input id="c-name" name="name" placeholder="–ò–º—è –∑–∞–∫–∞–∑—á–∏–∫–∞" required /></div>
        </div>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <button class="btn" type="submit">üöÄ –°–æ–∑–¥–∞—Ç—å</button>
          <button class="btn secondary" type="button" id="sendOrderToBot">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç</button>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- –ú–æ–∏ –∑–∞–∫–∞–∑—ã (–ª–æ–∫–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ) -->
<section id="mine" class="screen" aria-labelledby="mineTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="mineTitle">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
    <div id="mineList" class="list"><div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ ‚Üí</div></div>
    <div class="row" style="grid-template-columns:1fr 1fr; margin-top:10px">
      <button class="btn secondary" id="exportJson">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
      <button class="btn secondary" id="clearAll">üóë –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
    </div>
  </div>
</section>

<!-- –ê–Ω–∫–µ—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è -->
<section id="exec" class="screen" aria-labelledby="execTitle">
  <div class="panel">
    <div class="nav"><a class="back" href="#" onclick="closeScreens()">‚Üê –ù–∞–∑–∞–¥</a></div>
    <h1 id="execTitle">–ê–Ω–∫–µ—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</h1>
    <div class="wrap">
      <form id="execForm">
        <div class="row">
          <div><label for="e-city">–ì–æ—Ä–æ–¥</label><input id="e-city" name="city" placeholder="–ê–ª–º–∞—Ç—ã" required /></div>
          <div><label for="e-skills">–ù–∞–≤—ã–∫–∏</label><input id="e-skills" name="skills" placeholder="–ö—É—Ä—å–µ—Ä, —Ä–µ–º–æ–Ω—Ç, —É–±–æ—Ä–∫–∞‚Ä¶" required /></div>
        </div>
        <label for="e-about">–û —Å–µ–±–µ</label>
        <textarea id="e-about" name="about" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ –≤–∞—à–µ–º –æ–ø—ã—Ç–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏" required></textarea>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <button class="btn" type="submit">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É</button>
          <button class="btn secondary" type="button" id="sendProfileToBot">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç</button>
        </div>
      </form>
    </div>
  </div>
</section>

<script>
/* Telegram init */
const tg = window.Telegram?.WebApp;
const isInTelegram = !!tg;
if(isInTelegram){ tg.ready(); tg.expand(); document.body.classList.toggle('tg-light', tg.colorScheme==='light'); }

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è –æ–∫–æ–Ω */
function openScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
}
function closeScreens(){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); }

/* Deep link (–∑–∞–º–µ–Ω–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ) */
const BOT_USERNAME='GiDCityBot', STARTAPP_KEY='menu';
document.getElementById('openInChat').onclick=()=> {
  const url=`https://t.me/${BOT_USERNAME}?startapp=${encodeURIComponent(STARTAPP_KEY)}`;
  if(isInTelegram){ tg.openTelegramLink(url); } else { window.open(url,'_blank'); }
};

/* Storage */
const LS_ORDERS='gid_orders_v1', LS_PROFILE='gid_profile_v1';
const Store={
  getOrders(){ try{return JSON.parse(localStorage.getItem(LS_ORDERS))||[]}catch(_){return[]} },
  setOrders(x){ localStorage.setItem(LS_ORDERS, JSON.stringify(x)); },
  addOrder(o){ const l=this.getOrders(); l.unshift(o); this.setOrders(l); return l; },
  deleteOrder(id){ const l=this.getOrders().filter(x=>x.id!==id); this.setOrders(l); return l; },
  getProfile(){ try{return JSON.parse(localStorage.getItem(LS_PROFILE))||null}catch(_){return null} },
  setProfile(p){ localStorage.setItem(LS_PROFILE, JSON.stringify(p)); }
};

/* Seed –¥–∞–Ω–Ω—ã–µ */
function todayISO(){ return new Date().toISOString().slice(0,10); }
function daysFromNow(n){ const d=new Date(); d.setDate(d.getDate()+n); return d.toISOString().slice(0,10); }
if(Store.getOrders().length===0){
  Store.setOrders([
    { id:'seed1', category:'–ö—É—Ä—å–µ—Ä', city:'–ê–ª–º–∞—Ç—ã', budget:10000, deadline:daysFromNow(1), desc:'–û—Ç–≤–µ–∑—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ –ê –≤ –ë', contact:'@client1', name:'–ê–π–¥–∞—Ä', isMine:false },
    { id:'seed2', category:'–£–±–æ—Ä–∫–∞', city:'–ê—Å—Ç–∞–Ω–∞', budget:15000, deadline:todayISO(), desc:'2-—Ö –∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞', contact:'@client2', name:'–°–∞–ª—Ç–∞–Ω–∞—Ç', isMine:false }
  ]);
}

/* –†–µ–Ω–¥–µ—Ä */
const findList=document.getElementById('findList'), mineList=document.getElementById('mineList'), ordersBadge=document.getElementById('ordersCountBadge');
function escapeHTML(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]))}
function prettyDeadline(iso){
  const d=new Date(iso+'T00:00:00'), t=new Date(todayISO()+'T00:00:00'); const diff=Math.round((d-t)/86400000);
  if(diff===0)return'—Å–µ–≥–æ–¥–Ω—è'; if(diff===1)return'–¥–æ –∑–∞–≤—Ç—Ä–∞'; if(diff<0)return'–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ'; return `–¥–æ ${d.toLocaleDateString('ru-KZ')}`;
}
function renderOrders(container, list){
  container.innerHTML='';
  if(!list||list.length===0){ container.innerHTML='<div class="muted">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>'; return; }
  list.forEach(o=>{
    const el=document.createElement('div'); el.className='item';
    const mineMark = o.isMine ? ' ‚Ä¢ <span class="muted">–º–æ–π</span>' : '';
    el.innerHTML=`
      <div class="title2">${escapeHTML(o.category)} ‚Ä¢ ${escapeHTML(o.city)} <span class="badge">‚Ç∏ ${Number(o.budget).toLocaleString('ru-RU')}</span>${mineMark}</div>
      <div class="muted">${prettyDeadline(o.deadline)}</div>
      <div>${escapeHTML(o.desc)}</div>
      <div class="muted">–ö–æ–Ω—Ç–∞–∫—Ç: ${escapeHTML(o.contact)} ‚Ä¢ ${escapeHTML(o.name)}</div>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn secondary" data-act="send" data-id="${o.id}">üì§ –í –±–æ—Ç</button>
        <button class="btn secondary" data-act="delete" data-id="${o.id}">üóë –£–¥–∞–ª–∏—Ç—å</button>
      </div>`;
    container.appendChild(el);
  });
  container.querySelectorAll('button[data-act]').forEach(b=>{
    b.onclick=(e)=>{
      const id=e.currentTarget.getAttribute('data-id'), act=e.currentTarget.getAttribute('data-act');
      const order=Store.getOrders().find(x=>x.id===id);
      if(act==='delete'){ Store.deleteOrder(id); refreshAll(); }
      if(act==='send' && order){ sendToBot({type:'order', payload:order}); }
    };
  });
}

/* –§–∏–ª—å—Ç—Ä—ã –≤ "–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã" (–≤—Å–µ –∑–∞–∫–∞–∑—ã, –Ω–µ —Ç–æ–ª—å–∫–æ –º–æ–∏) */
document.getElementById('filterForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  const fd=new FormData(e.currentTarget);
  const cat=(fd.get('category')||'').trim(), city=(fd.get('city')||'').trim().toLowerCase();
  const min=Number(fd.get('min')||0), max=Number(fd.get('max')||0);
  const list=Store.getOrders().filter(o=>{
    let ok=true;
    if(cat) ok=ok&&o.category===cat;
    if(city) ok=ok&&o.city.toLowerCase().includes(city);
    if(min) ok=ok&&Number(o.budget)>=min;
    if(max) ok=ok&&Number(o.budget)<=max;
    return ok;
  });
  renderOrders(findList, list);
});

/* –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Üí –¥–æ–±–∞–≤–ª—è–µ–º, –æ—Ç–∫—Ä—ã–≤–∞–µ–º "–ù–∞–π—Ç–∏", –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ */
document.getElementById('createForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  const fd=new FormData(e.currentTarget);
  const order={
    id: Math.random().toString(36).slice(2,10)+Date.now().toString(36),
    category:fd.get('category'), city:fd.get('city'),
    budget:Number(fd.get('budget')), deadline:fd.get('deadline'),
    desc:fd.get('desc'), contact:fd.get('contact'), name:fd.get('name'),
    isMine:true
  };
  if(!(order.category&&order.city&&order.deadline&&order.desc&&order.contact&&order.name)){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
  if(!(order.budget>=0)){ alert('–ë—é–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º'); return; }
  Store.addOrder(order);
  e.currentTarget.reset(); document.getElementById('c-deadline').value=todayISO();
  openScreen('find'); refreshAll(); // –æ—Ç–∫—Ä—ã–≤–∞–µ–º "–ù–∞–π—Ç–∏" –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Å—å —Å–ø–∏—Å–æ–∫
});
document.getElementById('sendOrderToBot').onclick=()=>{
  const last=Store.getOrders()[0]; if(!last){ alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏'); return; }
  sendToBot({type:'order', payload:last});
};

/* –ê–Ω–∫–µ—Ç–∞ */
document.getElementById('execForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  const fd=new FormData(e.currentTarget);
  const profile={ city:fd.get('city'), skills:fd.get('skills'), about:fd.get('about'), updatedAt:new Date().toISOString() };
  if(!profile.city||!profile.skills||!profile.about){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∞–Ω–∫–µ—Ç—ã'); return; }
  Store.setProfile(profile); alert('–ê–Ω–∫–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ ‚úÖ');
});
document.getElementById('sendProfileToBot').onclick=()=>{
  const p=Store.getProfile(); if(!p){ alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É'); return; }
  sendToBot({type:'profile', payload:p});
};

/* –≠–∫—Å–ø–æ—Ä—Ç / –æ—á–∏—Å—Ç–∫–∞ */
document.getElementById('exportJson').onclick=()=>{
  const data={orders:Store.getOrders(), profile:Store.getProfile()};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='gidcity-data.json'; a.click(); URL.revokeObjectURL(url);
};
document.getElementById('clearAll').onclick=()=>{ if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')){ localStorage.clear(); refreshAll(); } };

/* –°–≤—è–∑–∫–∞ —Å –±–æ—Ç–æ–º */
function sendToBot(message){
  const payload=JSON.stringify(message);
  if(isInTelegram){
    try{ tg.sendData(payload); tg.showAlert('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–æ—Ç ‚úÖ'); }
    catch(e){ tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: '+e.message); }
  }else{
    console.log('Payload for bot:', payload);
    alert('–û—Ç–∫—Ä—ã—Ç–æ –≤–Ω–µ Telegram. JSON –ø–æ–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ –±—É–¥–µ—Ç —Å–∫–∞—á–∞–Ω.');
    const blob=new Blob([payload],{type:'application/json'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=`gidcity-${message.type}.json`; a.click(); URL.revokeObjectURL(url);
  }
}

/* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ –∏ –±–µ–π–¥–∂–∞ */
function refreshAll(){
  const orders=Store.getOrders();
  renderOrders(findList, orders);              // –≤ ¬´–ù–∞–π—Ç–∏¬ª ‚Äî –≤—Å–µ –∑–∞–∫–∞–∑—ã
  renderOrders(mineList, orders.filter(o=>o.isMine)); // –≤ ¬´–ú–æ–∏¬ª ‚Äî —Ç–æ–ª—å–∫–æ –º–æ–∏
  // –±–µ–π–¥–∂ —Å –æ–±—â–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–∫–∞–∑–æ–≤
  if(orders.length>0){ ordersBadge.style.display='flex'; ordersBadge.textContent=orders.length; }
  else { ordersBadge.style.display='none'; }
}
refreshAll();
</script>
</body>
</html>
