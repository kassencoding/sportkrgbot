<!doctype html>
<html lang="ru" data-theme="violet">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GiDCity ‚Äî Top Sheets + Stable Messenger</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* ========= BASE TOKENS ========= */
:root{
  --bg-1:#060910; --bg-2:#050815; --bg-3:#030711;
  --radial-a:#121a3a; --radial-b:#09203a;
  --surface:#0b1020; --surface-2:#0f1630; --line:#1a2346;
  --accent-a:#a970ff; --accent-b:#32ffd2; --accent-c:#6a8cff;
  --danger:#ff4d6d; --gold:#ffd84d;
  --text:#e7ebff; --text-dim:#c7d3ff; --text-muted:#9fb0ff; --text-invert:#0a0f1e;
  --radius:16px; --radius-sm:12px; --ui-font-size:14px;
  --glow-1: 0 0 14px rgba(169,112,255,.45);
  --glow-2: 0 0 22px rgba(50,255,210,.35);
  --shadow: 0 18px 50px rgba(0,0,0,.55);
}
/* THEMES */
html[data-theme="violet"]{ --accent-a:#a970ff; --accent-b:#32ffd2; --accent-c:#6a8cff; --bg-1:#060910; --bg-2:#050815; --bg-3:#030711; --radial-a:#121a3a; --radial-b:#09203a; }
html[data-theme="navy"]{ --accent-a:#6aa7ff; --accent-b:#7ef3ff; --accent-c:#65d0ff; --bg-1:#04080f; --bg-2:#061225; --bg-3:#07142b; --radial-a:#0c1a3a; --radial-b:#0a523a; }
html[data-theme="emerald"]{ --accent-a:#3fe0a8; --accent-b:#baff6a; --accent-c:#75ffd9; --bg-1:#04110c; --bg-2:#052017; --bg-3:#05261b; --radial-a:#0d3a2a; --radial-b:#0a5235; }
html[data-theme="sunset"]{ --accent-a:#ff7ab6; --accent-b:#ffd06a; --accent-c:#ff9f6a; --bg-1:#12080c; --bg-2:#1c0e17; --bg-3:#220f1b; --radial-a:#3a1223; --radial-b:#521a2c; }

/* RESET */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:18px; font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:
    radial-gradient(1200px 800px at 20% -10%, var(--radial-a) 0%, transparent 55%),
    radial-gradient(1000px 700px at 120% 20%, var(--radial-b) 0%, transparent 55%),
    linear-gradient(180deg,var(--bg-1),var(--bg-2) 40%, var(--bg-3) 100%);
  color:var(--text); font-size:var(--ui-font-size); display:flex; justify-content:center;
}

/* LAYOUT */
.wrapper{ width:100%; max-width:1100px; display:flex; flex-direction:column; gap:16px; }
.header{ display:flex; justify-content:space-between; align-items:flex-start; gap:12px; padding:8px 4px 6px; }
.brand{ display:flex; flex-direction:column; gap:6px; }
.brand h1{
  margin:0; font-weight:800; font-size:22px; letter-spacing:.4px;
  background: linear-gradient(90deg, var(--accent-a), var(--accent-b));
  -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow: 0 0 24px rgba(169,112,255,.35);
}
.header-sub{ font-size:13px; color:var(--text-muted); font-weight:700 }
.header-right{ display:flex; flex-direction:column; gap:10px; align-items:flex-end; }

/* Buttons + badge */
.btn{ appearance:none; border:none; cursor:pointer; font-weight:700; color:var(--text);
  padding:10px 14px; border-radius:12px; line-height:1;
  background: linear-gradient(180deg, rgba(169,112,255,.12), rgba(50,255,210,.08));
  border:1px solid rgba(138,165,255,.22);
  box-shadow: var(--shadow), inset 0 0 0 1px rgba(255,255,255,.03);
  transition: transform .12s ease, box-shadow .2s ease, background .2s ease;
}
.btn:hover{ box-shadow: var(--glow-1), var(--shadow); transform: translateY(-1px); }
.btn:active{ transform: translateY(0); }
.btn.primary{ background: linear-gradient(90deg, rgba(169,112,255,.28), rgba(50,255,210,.28)); border-color: rgba(138,165,255,.38); box-shadow: var(--glow-1), var(--glow-2), var(--shadow); }
.btn.ghost{ background: transparent; border-color: rgba(138,165,255,.25); }
.controls-row{ display:flex; gap:8px; }
.btn-with-badge{ position:relative; }
.badge-dot{ position:absolute; top:-6px; right:-6px; min-width:18px; height:18px; padding:0 5px; display:flex; align-items:center; justify-content:center; background:var(--danger); color:#fff; border-radius:999px; font-size:12px; font-weight:800; box-shadow: 0 0 0 2px rgba(6,9,16,.9); }

/* Role switch */
.role-switch{ display:flex; gap:8px; align-items:center; font-weight:700; color:var(--text-dim); }
.toggle{ width:64px; height:32px; border-radius:999px; padding:3px; position:relative; cursor:pointer;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.18));
  border:1px solid rgba(138,165,255,.28); box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
  transition: background .2s, border-color .2s;
}
.toggle .knob{ width:26px; height:26px; border-radius:999px; background:linear-gradient(180deg, #fff, #cfe3ff);
  position:absolute; top:3px; left:3px; transition:left .18s ease;
  box-shadow: 0 6px 16px rgba(0,0,0,.45), 0 0 12px rgba(169,112,255,.35);
}
.toggle.on{ background:linear-gradient(90deg, rgba(169,112,255,.36), rgba(50,255,210,.26)); border-color: rgba(169,112,255,.5); }
.toggle.on .knob{ left:35px; }

/* Main container */
.container{
  width:100%; border-radius:20px; padding:18px;
  background: linear-gradient(180deg, rgba(14,20,46,.72), rgba(10,15,35,.42));
  border:1px solid var(--line);
  box-shadow: var(--shadow), 0 0 0 1px rgba(255,255,255,.02) inset;
  color:var(--text);
}
.panel-top{ display:flex; justify-content:space-between; align-items:center; margin-bottom:14px }
.panel-top h2{ margin:0; font-size:18px; font-weight:800; color:var(--text); }

/* Menu LIST (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ, –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞) */
.menu-grid{ display:flex; flex-direction:column; gap:10px; }
.menu-btn{
  width:100%; min-height:64px; border-radius:14px; padding:14px 16px; cursor:pointer;
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.22));
  border:1px solid rgba(138,165,255,.22);
  display:flex; align-items:center; gap:10px; justify-content:space-between;
  transition: transform .14s, box-shadow .14s, border-color .2s; box-shadow: var(--shadow);
}
.menu-btn .title{ font-weight:800; font-size:16px; color:var(--text) }
.menu-btn .note{ font-size:12px; color:var(--text-muted) }
.menu-btn:hover{ transform: translateY(-2px); box-shadow: var(--glow-1), var(--shadow); border-color: rgba(169,112,255,.42); }
.menu-btn:active{ transform:translateY(0) }
.menu-btn.primary{ background: linear-gradient(135deg, rgba(169,112,255,.18), rgba(50,255,210,.14)); border-color: rgba(169,112,255,.6); box-shadow: var(--glow-1), var(--glow-2), var(--shadow); }
.menu-btn.violet{ background: linear-gradient(135deg, rgba(169,112,255,.24), rgba(106,140,255,.16)); border-color: rgba(138,165,255,.5); box-shadow: var(--glow-1), var(--shadow); }
.menu-btn.disabled{ opacity:.6; pointer-events:none; filter:saturate(.8) }

/* Cards */
.card{
  background: linear-gradient(180deg, rgba(10,14,30,.86), rgba(6,10,24,.78));
  color:var(--text); border-radius:14px; padding:12px; display:flex; gap:12px; align-items:flex-start;
  border:1px solid rgba(138,165,255,.22); box-shadow: var(--shadow);
}
.avatar{ width:56px; height:56px; border-radius:999px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#fff; overflow:hidden; }
.avatar img{ width:100%; height:100%; object-fit:cover; border-radius:999px; }

/* Sheets ‚Äì —Å–≤–µ—Ä—Ö—É */
.screen{
  position:fixed; inset:0; display:none; z-index:140; padding:0 12px; background: rgba(6,9,16,.64);
  align-items:flex-start; justify-content:center; backdrop-filter: blur(6px);
}
.screen.active{ display:flex }
.modal{
  width:100%; max-width:1100px; max-height:86vh; overflow:auto;
  background: linear-gradient(180deg, rgba(18,26,56,.96), rgba(12,18,42,.94));
  color:var(--text); box-shadow: var(--glow-1), var(--shadow); border:1px solid rgba(138,165,255,.28);
  border-radius:0 0 18px 18px; padding:18px 16px; margin-top:12px; /* TOP */
}

/* Forms */
.input, textarea, select{
  width:100%; padding:12px 12px; border-radius:12px; border:1px solid rgba(138,165,255,.24);
  background: rgba(12,16,36,.75); color:var(--text); font-size:14px; outline:none; transition: box-shadow .2s, border-color .2s, background .2s;
}
textarea{ min-height:110px; resize:vertical }
.input::placeholder, textarea::placeholder{ color:rgba(184,194,255,.6) }
.input:focus, textarea:focus, select:focus{ border-color: rgba(169,112,255,.6); box-shadow: 0 0 0 3px rgba(169,112,255,.18), var(--glow-1); background: rgba(16,20,46,.9); }
.small{ font-size:13px; color:var(--text-muted) }

/* Tabs */
.tabs{ display:flex; gap:8px; flex-wrap:wrap }
.tab{ padding:8px 12px; border-radius:999px; font-weight:700; cursor:pointer; border:1px solid rgba(138,165,255,.25);
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.16)); color:var(--text); }
.tab:hover{ box-shadow: var(--glow-1) }
.tab.active{ background: linear-gradient(90deg, rgba(169,112,255,.32), rgba(50,255,210,.24)); border-color: rgba(169,112,255,.6); box-shadow: var(--glow-1), var(--glow-2); }

/* Messenger */
.messenger{ display:flex; gap:12px; min-height:64vh; }
.chatlist{ width:340px; max-height:70vh; overflow:auto; }
.chatpane{ flex:1; display:flex; flex-direction:column; min-width:0; }
.msgs{ margin-top:12px; flex:1; overflow:auto; padding-right:8px; }
.msg-row{ margin-bottom:8px; }
.msg-me{ text-align:right; }
.msg-me .b{ display:inline-block; background:linear-gradient(90deg, rgba(169,112,255,.9), rgba(50,255,210,.9)); padding:8px 12px; border-radius:10px; color:#0a0f1e; font-weight:700 }
.msg-other .b{ display:inline-block; background:rgba(255,255,255,.06); border:1px solid rgba(138,165,255,.24); padding:8px 12px; border-radius:10px; }
.chat-badge{ margin-left:auto; background:var(--danger); color:#fff; border-radius:999px; font-size:12px; font-weight:800; padding:0 6px; min-width:18px; height:18px; display:flex; align-items:center; justify-content:center; }
.chatpane.hidden { display:none; }
.messenger.only-list .chatlist { width:100%; }
@media(max-width:920px){
  .chatlist{ width:100%; }
  .messenger.only-list .chatlist{ width:100%; }
  .messenger.has-chat .chatlist{ display:none; }
  .messenger.has-chat .chatpane{ display:flex; }
}
</style>
</head>
<body>
<div class="wrapper">
  <header class="header">
    <div class="brand">
      <h1>GiD City</h1>
      <div id="topCity" class="header-sub">–ì–æ—Ä–æ–¥: ‚Äî</div>
    </div>
    <div class="header-right">
      <div class="controls-row">
        <button id="openNotifications" class="btn btn-with-badge">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è<span id="notifBadge" class="badge-dot" style="display:none">0</span></button>
        <button id="openSettings" class="btn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </div>
    </div>
  </header>

  <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–æ–ª–µ–π -->
  <div class="role-switch">
    <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
    <div id="roleToggle" class="toggle"><div class="knob"></div></div>
    <span>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</span>
  </div>

  <main class="container" role="main" aria-live="polite">
    <div class="panel-top">
      <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
      <div style="width:140px"></div>
    </div>
    <div class="menu-grid">
      <div id="btnOrder" class="menu-btn primary" role="button" tabindex="0"><div class="title">–ó–ê–ö–ê–ó–ê–¢–¨</div><div class="note" id="orderNote">–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</div></div>
      <div id="btnReserve" class="menu-btn disabled" role="button" tabindex="-1"><div class="title">–ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨</div><div class="note">–°–ö–û–†–û</div></div>
      <div id="btnAds" class="menu-btn violet" role="button" tabindex="0"><div class="title">–û–ë–™–Ø–í–õ–ï–ù–ò–ï –£–°–õ–£–ì</div><div class="note">–û–±—ä—è–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</div></div>
      <div id="btnFind" class="menu-btn" role="button"><div class="title">–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã</div><div class="note">–î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</div></div>
      <div id="btnMessenger" class="menu-btn" role="button"><div class="title">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</div><div class="note">–ß–∞—Ç—ã</div></div>
      <div id="btnWallet" class="menu-btn" role="button"><div class="title">–ö–æ—à–µ–ª—ë–∫</div><div class="note">–ë–∞–ª–∞–Ω—Å –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</div></div>
      <div id="btnMine" class="menu-btn" role="button"><div class="title">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</div><div class="note">–í–∞—à–∏ –∑–∞—è–≤–∫–∏</div></div>
    </div>
  </main>
</div>

<!-- ===== Sheets —Å–≤–µ—Ä—Ö—É ===== -->
<section id="authScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–í—Ö–æ–¥</h3><button onclick="closeScreen('authScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <form id="authForm" style="margin-top:12px">
    <div class="form-field"><input id="authLogin" class="input" placeholder="Email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω" required /></div>
    <div class="form-field" style="margin-top:8px"><input id="authPass" class="input" placeholder="–ü–∞—Ä–æ–ª—å" type="password" required /></div>
    <div style="display:flex; gap:8px; margin-top:12px"><button type="submit" class="btn primary">–í–æ–π—Ç–∏</button><button type="button" id="registerBtn" class="btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button></div>
    <div class="small" style="margin-top:10px">–î–µ–º–æ: –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</div>
  </form>
</div></section>

<section id="createScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3><button onclick="closeScreen('createScreen')" class="btn ghost">–ù–∞–∑–∞–¥</button></div>
  <div style="margin-top:10px;">
    <div class="tabs" id="createTabs">
      <div class="tab active" data-val="–°–ü–ï–¶. –ó–ê–ö–ê–ó">–°–ü–ï–¶. –ó–ê–ö–ê–ó</div>
      <div class="tab" data-val="–¢–∞–∫—Å–∏">–¢–∞–∫—Å–∏</div>
      <div class="tab" data-val="–ö—É—Ä—å–µ—Ä">–ö—É—Ä—å–µ—Ä</div>
      <div class="tab" data-val="–î–æ—Å—Ç–∞–≤–∫–∞">–î–æ—Å—Ç–∞–≤–∫–∞</div>
      <div class="tab" data-val="–ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–æ–º">–ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–æ–º</div>
      <div class="tab" data-val="–ú–∞—Å—Ç–µ—Ä">–ú–∞—Å—Ç–µ—Ä</div>
      <div class="tab" data-val="–ü—Ä–æ—á–∏–µ">–ü—Ä–æ—á–∏–µ</div>
    </div>
    <form id="createForm" style="margin-top:12px">
      <div class="form-field"><textarea id="c-desc" class="input" placeholder="–∑–∞–∫–∞–∂–∏ –ª—é–±—É—é —É—Å–ª—É–≥—É –∏ –º—ã –Ω–∞–π–¥—ë–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è"></textarea></div>
      <div class="row" style="display:flex; gap:8px; margin-top:8px">
        <div class="col" style="flex:1"><input id="c-budget" class="input" type="number" placeholder="–ë—é–¥–∂–µ—Ç (‚Ç∏)" /></div>
        <div class="col" style="flex:1"><input id="c-datetime" class="input" type="datetime-local" /></div>
      </div>
      <div id="createExtraFields" class="form-field" style="margin-top:8px"></div>
      <div style="display:flex; gap:8px; margin-top:12px; align-items:center">
        <button class="btn primary" id="orderNowBtn" type="submit" style="min-width:160px">–ó–ê–ö–ê–ó–ê–¢–¨</button>
        <button class="btn ghost" type="button" onclick="closeScreen('createScreen')">–û—Ç–º–µ–Ω–∞</button>
        <div style="margin-left:auto; font-weight:800; color:var(--text-dim)" id="selectedCategory">–°–ü–ï–¶. –ó–ê–ö–ê–ó</div>
      </div>
    </form>
  </div>
</div></section>

<section id="findScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã</h3><button onclick="closeScreen('findScreen')" class="btn ghost">–ù–∞–∑–∞–¥</button></div>
  <div style="margin-top:8px"><div style="display:flex; gap:8px;"><input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..."><button id="applySearch" class="btn">–ü–æ–∏—Å–∫</button></div><div id="findList" class="list" style="margin-top:12px"></div></div>
</div></section>

<section id="mineScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h3><button onclick="closeScreen('mineScreen')" class="btn ghost">–ù–∞–∑–∞–¥</button></div>
  <div style="margin-top:12px"><div id="mineList" class="list"></div></div>
</div></section>

<section id="bidsModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 id="bidsModalTitle" style="margin:0">–ó–∞—è–≤–∫–∏</h3><button onclick="closeScreen('bidsModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <div id="bidsList" style="margin-top:12px"></div>
</div></section>

<section id="messengerScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</h3><button onclick="closeScreen('messengerScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <div id="messengerWrap" class="messenger only-list" style="margin-top:10px;">
    <div class="chatlist">
      <div id="chatsList"></div>
    </div>
    <div id="chatPane" class="chatpane hidden">
      <div id="chatHeader" style="display:flex; gap:12px; align-items:center;">
        <button id="chatBack" class="btn ghost" style="display:none">‚Üê –ù–∞–∑–∞–¥</button>
        <div id="chatAvatar" class="avatar" style="width:48px;height:48px"></div>
        <div><div id="chatTitle" style="font-weight:800"></div><div id="chatSub" class="small"></div></div>
      </div>
      <div id="messages" class="msgs"></div>
      <div style="display:flex; gap:8px; margin-top:8px;">
        <input id="messageInput" class="input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." />
        <button id="sendMsgBtn" class="btn primary" type="button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div></section>

<section id="adsScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–û–±—ä—è–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥</h3><button onclick="closeScreen('adsScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <div style="margin-top:12px; display:flex; gap:12px;">
    <div style="flex:1">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:800">–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
        <div><button id="createAdBtn" class="btn">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button></div>
      </div>
      <div id="adsList" class="list" style="margin-top:12px; max-height:60vh; overflow:auto"></div>
    </div>
    <div style="width:320px;">
      <div style="font-weight:800">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
      <div id="myAdsList" class="list" style="margin-top:8px; max-height:60vh; overflow:auto"></div>
    </div>
  </div>
</div></section>

<section id="adCreateModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h3><button onclick="closeScreen('adCreateModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <form id="adForm" style="margin-top:12px">
    <div class="form-field"><input id="adTitle" class="input" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏" required></div>
    <div class="form-field" style="margin-top:8px"><textarea id="adDesc" class="input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏"></textarea></div>
    <div style="display:flex; gap:8px; margin-top:8px;"><input id="adPhone" class="input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"><input id="adPrice" class="input" placeholder="–¶–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"></div>
    <div style="display:flex; gap:8px; margin-top:10px;"><button class="btn primary" type="submit">–°–æ–∑–¥–∞—Ç—å</button><button class="btn ghost" type="button" onclick="closeScreen('adCreateModal')">–û—Ç–º–µ–Ω–∞</button></div>
  </form>
</div></section>

<section id="notificationsModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3><button onclick="closeScreen('notificationsModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <div id="notificationsList" style="margin-top:12px; max-height:58vh; overflow:auto"></div>
  <div style="display:flex; gap:8px; margin-top:12px;"><button id="clearNotifications" class="btn">–û—á–∏—Å—Ç–∏—Ç—å</button></div>
</div></section>

<section id="settingsModal" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3><button onclick="closeScreen('settingsModal')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <div style="margin-top:10px">
    <div style="font-weight:800">–¢–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
    <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
      <button class="btn theme-btn" data-theme="violet">–§–∏–æ–ª–µ—Ç</button>
      <button class="btn theme-btn" data-theme="navy">–ù—ç–π–≤–∏</button>
      <button class="btn theme-btn" data-theme="emerald">–≠–º–µ—Ä–∞–ª–¥</button>
      <button class="btn theme-btn" data-theme="sunset">–°–∞–Ω—Å–µ—Ç</button>
    </div>
    <div style="margin-top:16px; font-weight:800">–ì–æ—Ä–æ–¥</div>
    <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
      <select id="citySelect" class="input" style="max-width:260px">
        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ ‚Äî</option>
        <option>–ê–ª–º–∞—Ç—ã</option><option>–ê—Å—Ç–∞–Ω–∞</option><option>–ö–∞—Ä–∞–≥–∞–Ω–¥–∞</option><option>–®—ã–º–∫–µ–Ω—Ç</option><option>–ê–∫—Ç–æ–±–µ</option>
      </select>
      <button id="saveCityBtn" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
    <div style="margin-top:12px"><button id="openProfile" class="btn">–ü—Ä–æ—Ñ–∏–ª—å</button></div>
  </div>
</div></section>

<section id="profileScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ü—Ä–æ—Ñ–∏–ª—å</h3><button onclick="closeScreen('profileScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <div id="profileWrap" style="margin-top:12px"></div>
</div></section>

<section id="walletScreen" class="screen"><div class="modal">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0">–ö–æ—à–µ–ª—ë–∫</h3><button onclick="closeScreen('walletScreen')" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  <div id="walletWrap" style="margin-top:12px"></div>
</div></section>

<script>
/* KEYS */
const LS_ORD='gid_orders_v13', LS_CHAT='gid_chats_v13', LS_ADS='gid_ads_v2', LS_PROFILE='gid_profile_v1', LS_ROLE='gid_role_v1', LS_CITY='gid_city_v1', LS_NOTIF='gid_notif_v1', LS_WALLET='gid_wallet_v1', LS_THEME='gid_theme_v1';
/* HELPERS */
const $=id=>document.getElementById(id);
const uid=()=>Math.random().toString(36).slice(2,9);
const nowISO=()=>new Date().toISOString();
function esc(s){return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m]))}
function initials(name){if(!name)return'?';const p=(name||'').split(/\s+/);return(p[0]||'').slice(0,2).toUpperCase()}
function avatarStyle(name,el){
  const p=Store.getProfile(); const t=p?.avatarType, d=p?.avatarData;
  el.innerHTML=''; if(t==='image'&&d){const img=document.createElement('img'); img.src=d; img.alt='avatar'; el.appendChild(img); return;}
  if(t==='emoji'&&d){el.textContent=d; el.style.fontSize='28px'; el.style.lineHeight='56px'; el.style.background='linear-gradient(135deg,#a970ff,#32ffd2)'; return;}
  const pal=['#a970ff','#6a8cff','#32ffd2','#61e6ff','#ffaa6b']; let h=0; for(let i=0;i<(name||'').length;i++)h+=name.charCodeAt(i);
  const a=pal[h%pal.length], b=pal[(h+1)%pal.length]; el.style.background=`linear-gradient(135deg, ${a}, ${b})`; el.textContent=initials(name||'');
}
/* STORE */
const Store={
  getOrders(){try{return JSON.parse(localStorage.getItem(LS_ORD))||[]}catch(e){return[]}}, setOrders(v){localStorage.setItem(LS_ORD,JSON.stringify(v))},
  addOrder(o){const a=this.getOrders();a.unshift(o);this.setOrders(a);return a},
  updateOrder(id,fn){const a=this.getOrders();const i=a.findIndex(x=>x.id===id);if(i>-1){fn(a[i]);this.setOrders(a);}return a},
  getChats(){try{return JSON.parse(localStorage.getItem(LS_CHAT))||[]}catch(e){return[]}}, setChats(v){localStorage.setItem(LS_CHAT,JSON.stringify(v))},
  addChat(c){const a=this.getChats();a.unshift(c);this.setChats(a);return a},
  updateChat(id,fn){const a=this.getChats();const i=a.findIndex(x=>x.id===id);if(i>-1){fn(a[i]);this.setChats(a);}return a},
  getAds(){try{return JSON.parse(localStorage.getItem(LS_ADS))||[]}catch(e){return[]}}, setAds(v){localStorage.setItem(LS_ADS,JSON.stringify(v))},
  getProfile(){try{return JSON.parse(localStorage.getItem(LS_PROFILE))||null}catch(e){return null}}, setProfile(p){localStorage.setItem(LS_PROFILE,JSON.stringify(p))},
  getRole(){return localStorage.getItem(LS_ROLE)||null}, setRole(r){localStorage.setItem(LS_ROLE,r)},
  getCity(){return localStorage.getItem(LS_CITY)||null}, setCity(c){localStorage.setItem(LS_CITY,c)},
  getNotifs(){try{return JSON.parse(localStorage.getItem(LS_NOTIF))||[]}catch(e){return[]}}, setNotifs(a){localStorage.setItem(LS_NOTIF,JSON.stringify(a))},
  getWallet(){try{return JSON.parse(localStorage.getItem(LS_WALLET))||{balance:0,ops:[]}}catch(e){return{balance:0,ops:[]}}}, setWallet(w){localStorage.setItem(LS_WALLET,JSON.stringify(w))},
  getTheme(){return localStorage.getItem(LS_THEME)||'violet'}, setTheme(t){localStorage.setItem(LS_THEME,t)}
};
/* SEED DEMO DATA */
if(!localStorage.getItem(LS_ORD)){
  Store.setOrders([
    { id:'o1', category:'–¢–∞–∫—Å–∏', city:'–ê–ª–º–∞—Ç—ã', budget:1200, datetime:new Date().toISOString().slice(0,16), desc:'–ü–æ–µ–∑–¥–∫–∞ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç', ownerId:'u_owner1', ownerName:'–ê–π–¥–∞—Ä', bids:[], status:'open', createdAt: nowISO() },
    { id:'o2', category:'–î–æ—Å—Ç–∞–≤–∫–∞', city:'–ê—Å—Ç–∞–Ω–∞', budget:900, datetime:new Date().toISOString().slice(0,16), desc:'–î–æ—Å—Ç–∞–≤–∫–∞ –æ–±–µ–¥–∞', ownerId:'u_owner2', ownerName:'–°–∞–ª—Ç–∞–Ω–∞—Ç', bids:[], status:'open', createdAt: nowISO() }
  ]);
}
if(!localStorage.getItem(LS_ADS)) Store.setAds([]);
/* –î–ï–ú–û-–ß–ê–¢, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Å—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å */
if(!localStorage.getItem(LS_CHAT)){
  const demo = [{
    id:'chat_demo1',
    orderId:null,
    title:'–î–µ–º–æ —á–∞—Ç ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞',
    participants:['u_demo_user','u_support'],
    meta:{ownerName:'–ü–æ–¥–¥–µ—Ä–∂–∫–∞', performerName:'–ü–æ–¥–¥–µ—Ä–∂–∫–∞'},
    messages:[
      {from:'system', text:'–ß–∞—Ç —Å–æ–∑–¥–∞–Ω', ts:nowISO()},
      {from:'other', text:'–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.', ts:nowISO()}
    ],
    unread:{ 'u_demo_user':1, 'u_support':0 }
  }];
  Store.setChats(demo);
}

/* UI CORE */
function applyTheme(){ document.documentElement.setAttribute('data-theme', Store.getTheme()||'violet'); }
function updateCityLabel(){ const c=Store.getCity()||'‚Äî'; $('topCity').textContent='–ì–æ—Ä–æ–¥: '+c; const sel=$('citySelect'); if(sel) sel.value=c||''; }
function refreshNotifBadge(){ const n=Store.getNotifs().length; const b=$('notifBadge'); if(n>0){b.style.display='flex'; b.textContent=n>99?'99+':String(n);} else b.style.display='none'; }
function openScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); const el=$(id); if(el) el.classList.add('active'); window.scrollTo(0,0); }
function closeScreen(id){ const el=$(id); if(el) el.classList.remove('active'); }

/* Role toggle */
function applyRoleUI(){
  const role=Store.getRole()||'user';
  if(role==='worker'){ $('roleToggle').classList.add('on'); $('btnOrder').style.display='none'; $('btnFind').style.display='block'; }
  else { $('roleToggle').classList.remove('on'); $('btnOrder').style.display='block'; $('btnFind').style.display='block'; }
}
function animateRole(newRole){
  const brand=document.querySelector('.brand h1'); if(brand){brand.style.transition='transform .3s'; brand.style.transform='scale(.98)'; setTimeout(()=>brand.style.transform='scale(1)',260);}
  Store.setRole(newRole); applyRoleUI();
}

/* NOTIFICATIONS */
function renderNotifs(){
  const list=$('notificationsList'); list.innerHTML='';
  const arr=Store.getNotifs();
  if(!arr.length){ list.innerHTML='<div class="small" style="padding:12px">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ—Ç</div>'; return; }
  arr.forEach((n,idx)=>{
    const node=document.createElement('div'); node.className='card'; node.style.cursor='pointer';
    node.innerHTML=`<div style="flex:1"><div style="font-weight:800">${esc(n.title)}</div><div class="small" style="margin-top:6px">${esc(n.body)}</div><div class="small" style="margin-top:8px">${new Date(n.ts).toLocaleString()}</div></div>`;
    node.addEventListener('click',()=>{
      if(n.type==='bid'&&n.orderId){ closeScreen('notificationsModal'); openBidsModal(n.orderId); }
      else if((n.type==='admsg'||n.type==='accepted')&&n.chatId){ closeScreen('notificationsModal'); openChat(n.chatId); }
      else if(n.type==='message'){ closeScreen('notificationsModal'); openScreen('messengerScreen'); showChatListOnly(); renderChats(); }
      const a=Store.getNotifs(); a.splice(idx,1); Store.setNotifs(a); renderNotifs(); refreshNotifBadge();
    });
    list.appendChild(node);
  });
}
function showChatListOnly(){ const mw=$('messengerWrap'), pane=$('chatPane'); if(mw&&pane){ mw.classList.add('only-list'); mw.classList.remove('has-chat'); pane.classList.add('hidden'); $('messages').innerHTML=''; const mi=$('messageInput'); if(mi) mi.value=''; } }

/* FIND */
function renderFindList(){
  const wrap=$('findList'); if(!wrap) return; wrap.innerHTML='';
  const items=Store.getOrders().filter(o=>o.status==='open');
  if(!items.length){ wrap.innerHTML='<div class="small" style="padding:12px">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>'; return; }
  items.forEach(o=>{
    const card=document.createElement('div'); card.className='card';
    const left=document.createElement('div'); left.style.flex='0 0 56px';
    const av=document.createElement('div'); av.className='avatar'; avatarStyle(o.ownerName||'–ó',av); left.appendChild(av);
    const body=document.createElement('div'); body.style.flex='1';
    body.innerHTML=`<div style="font-weight:800">${esc(o.category)} ‚Ä¢ ${esc(o.city)} ‚Äî ‚Ç∏ ${Number(o.budget||0).toLocaleString('ru-RU')}</div>
                    <div class="small" style="margin-top:6px">–î–µ–¥–ª–∞–π–Ω: ${o.datetime.replace('T',' ')}</div>
                    <div style="margin-top:8px">${esc(o.desc)}</div>`;
    const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px'; actions.style.marginTop='10px';
    const bidBtn=document.createElement('button'); bidBtn.className='btn'; bidBtn.textContent='–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ü–µ–Ω—É'; bidBtn.addEventListener('click',()=>openBidDialog(o.id));
    actions.appendChild(bidBtn); body.appendChild(actions);
    card.appendChild(left); card.appendChild(body); wrap.appendChild(card);
  });
}

/* MINE */
function renderMineList(){
  const wrap=$('mineList'); if(!wrap) return; wrap.innerHTML='';
  const profile=Store.getProfile();
  if(!profile){ wrap.innerHTML='<div class="small" style="padding:12px">–í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å</div>'; return; }
  const items=Store.getOrders().filter(o=>o.ownerId===profile.id);
  if(!items.length){ wrap.innerHTML='<div class="small" style="padding:12px">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>'; return; }
  items.forEach(o=>{
    const card=document.createElement('div'); card.className='card';
    const left=document.createElement('div'); left.style.flex='0 0 56px';
    const av=document.createElement('div'); av.className='avatar'; avatarStyle(o.ownerName||profile.name,av); left.appendChild(av);
    const body=document.createElement('div'); body.style.flex='1';
    const bidsCount=(o.bids||[]).length;
    body.innerHTML=`<div style="font-weight:800">${esc(o.category)} ‚Ä¢ ${esc(o.city)} ${bidsCount?(' ‚Ä¢ <span style="color:#ff9bb0">'+bidsCount+' –∑–∞—è–≤–æ–∫</span>'):''}</div>
                    <div class="small" style="margin-top:6px">–î–µ–¥–ª–∞–π–Ω: ${o.datetime.replace('T',' ')}</div>
                    <div style="margin-top:8px">${esc(o.desc)}</div>`;
    const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px'; actions.style.marginTop='10px';
    const viewBtn=document.createElement('button'); viewBtn.className='btn'; viewBtn.textContent='–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫–∏'; viewBtn.addEventListener('click',()=>openBidsModal(o.id));
    actions.appendChild(viewBtn); body.appendChild(actions);
    card.appendChild(left); card.appendChild(body); wrap.appendChild(card);
  });
}

/* BIDS */
function openBidsModal(orderId){
  const order=Store.getOrders().find(x=>x.id===orderId); if(!order) return alert('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
  openScreen('bidsModal');
  const list=$('bidsList'); list.innerHTML='';
  const header=document.createElement('div');
  header.innerHTML=`<div style="font-weight:800">${esc(order.category)} ‚Ä¢ ${esc(order.city)}</div><div class="small">–ó–∞–∫–∞–∑—á–∏–∫: ${esc(order.ownerName)}</div>`;
  list.appendChild(header);
  const bids=order.bids||[];
  if(!bids.length){ list.innerHTML+='<div class="small" style="padding:12px">–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</div>'; return; }
  bids.forEach((b,idx)=>{
    const row=document.createElement('div'); row.className='card';
    const left=document.createElement('div'); left.style.flex='0 0 56px';
    const av=document.createElement('div'); av.className='avatar'; avatarStyle(b.name||'–ò',av); left.appendChild(av);
    const body=document.createElement('div'); body.style.flex='1';
    body.innerHTML=`<div style="font-weight:800">${esc(b.name)} ‚Äî ‚Ç∏ ${Number(b.price).toLocaleString('ru-RU')}</div>
                    <div class="small" style="margin-top:6px">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ: ${new Date(b.createdAt||'').toLocaleString()}</div>
                    <div style="margin-top:8px">${esc(b.comment||'')}</div>`;
    const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px'; actions.style.marginTop='10px';
    const accept=document.createElement('button'); accept.className='btn primary'; accept.textContent='–ü—Ä–∏–Ω—è—Ç—å';
    accept.addEventListener('click',()=>{
      Store.updateOrder(orderId,o=>{o.status='in_progress'; o.assigned={performerId:b.performerId, performerName:b.name, price:b.price};});
      const chat={ id:'chat_'+uid(), orderId, title:`${order.category} ‚Ä¢ ${order.city}`, participants:[order.ownerId,b.performerId], meta:{ownerName:order.ownerName, performerName:b.name}, messages:[{from:'system', text:`–ß–∞—Ç —Å–æ–∑–¥–∞–Ω –ø–æ –∑–∞–∫–∞–∑—É`, ts:nowISO()}], unread:{[order.ownerId]:0,[b.performerId]:1} };
      Store.addChat(chat);
      const notifPerformer={id:'n_'+uid(), type:'accepted', title:'–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞', body:`–ó–∞–∫–∞–∑—á–∏–∫ –ø—Ä–∏–Ω—è–ª –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚Äî –æ—Ç–∫—Ä—ã–ª—Å—è —á–∞—Ç`, orderId, chatId:chat.id, ts:nowISO()};
      const notifOwner={id:'n_'+uid(), type:'accepted_owner', title:'–í—ã –ø—Ä–∏–Ω—è–ª–∏ –∑–∞—è–≤–∫—É', body:`–û—Ç–∫—Ä—ã–ª—Å—è —á–∞—Ç —Å ${b.name}`, orderId, chatId:chat.id, ts:nowISO()};
      const arr=Store.getNotifs(); arr.unshift(notifPerformer, notifOwner); Store.setNotifs(arr); refreshNotifBadge();
      closeScreen('bidsModal'); openScreen('messengerScreen'); showChatListOnly(); renderChats();
    });
    const decline=document.createElement('button'); decline.className='btn'; decline.textContent='–û—Ç–∫–∞–∑–∞—Ç—å';
    decline.addEventListener('click',()=>{ Store.updateOrder(orderId,o=>{o.bids=(o.bids||[]).filter((_,i)=>i!==idx)}); openBidsModal(orderId); renderMineList(); });
    actions.appendChild(accept); actions.appendChild(decline); body.appendChild(actions);
    row.appendChild(left); row.appendChild(body); list.appendChild(row);
  });
}

/* PLACE BID */
function openBidDialog(orderId){
  const price=prompt('–í–∞—à–∞ —Ü–µ–Ω–∞ (‚Ç∏):','1000'); if(!price) return;
  const comment=prompt('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (—Å—Ä–æ–∫–∏, –¥–µ—Ç–∞–ª–∏):','–ì–æ—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞ 2 —á–∞—Å–∞')||'';
  const profile=Store.getProfile()||{id:'u_guest_'+uid(), name:'–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'};
  Store.updateOrder(orderId,o=>{ if(!Array.isArray(o.bids)) o.bids=[]; o.bids.push({price:Number(price),name:profile.name||profile.login, performerId:profile.id, comment, createdAt:nowISO()}); });
  const order=Store.getOrders().find(x=>x.id===orderId);
  if(order){ const notif={id:'n_'+uid(), type:'bid', title:'–ù–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', body:`–ù–∞ –≤–∞—à –∑–∞–∫–∞–∑ "${order.category}" –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ —Ü–µ–Ω—É ${price}‚Ç∏`, orderId:order.id, ts:nowISO()}; const arr=Store.getNotifs(); arr.unshift(notif); Store.setNotifs(arr); refreshNotifBadge(); }
  alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'); renderFindList();
}

/* CHATS */
/* –†–µ–Ω–¥–µ—Ä + –î–ï–õ–ï–ì–ò–†–û–í–ê–ù–ò–ï –∫–ª–∏–∫–æ–≤ –ø–æ —Å–ø–∏—Å–∫—É */
function renderChats(){
  const wrap=$('chatsList'); if(!wrap) return; wrap.innerHTML='';
  const chats=Store.getChats(); const me=Store.getProfile();
  if(!chats.length){ wrap.innerHTML='<div class="small" style="padding:12px">–ü–æ–∫–∞ –Ω–µ—Ç —á–∞—Ç–æ–≤</div>'; return; }
  const frag=document.createDocumentFragment();
  chats.forEach(c=>{
    const unread=(c.unread&&me)?(c.unread[me.id]||0):((c.unread&&c.unread['u_demo_user'])||0);
    const node=document.createElement('div'); node.className='card'; node.style.cursor='pointer';
    node.setAttribute('data-chat-id', c.id);
    const left=document.createElement('div'); left.style.flex='0 0 56px';
    const av=document.createElement('div'); av.className='avatar'; avatarStyle(c.meta?.performerName||c.meta?.ownerName||'–ß',av); left.appendChild(av);
    const body=document.createElement('div'); body.style.flex='1';
    body.innerHTML=`<div style="display:flex; align-items:center; gap:8px">
      <div style="font-weight:800; flex:1; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis">${esc(c.title)}</div>
      ${unread?`<div class="chat-badge">${unread}</div>`:''}
    </div>
    <div class="small" style="margin-top:6px">${esc(c.meta?.performerName||'')}</div>`;
    node.appendChild(left); node.appendChild(body);
    frag.appendChild(node);
  });
  wrap.appendChild(frag);
  showChatListOnly();
}
/* –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –ª–æ–≤–∏–º –∫–ª–∏–∫ –Ω–∞ –ª—é–±–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ —Å data-chat-id */
$('chatsList').addEventListener('click',(e)=>{
  const card=e.target.closest('[data-chat-id]');
  if(card){ const id=card.getAttribute('data-chat-id'); openChat(id); }
});

function openChat(chatId){
  const chat=Store.getChats().find(c=>c.id===chatId); if(!chat){ alert('–ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }
  openScreen('messengerScreen');
  const mw=$('messengerWrap'), pane=$('chatPane'); if(mw&&pane){ mw.classList.remove('only-list'); mw.classList.add('has-chat'); pane.classList.remove('hidden'); }
  $('chatTitle').textContent=chat.title; $('chatSub').textContent=`–ó–∞–∫–∞–∑: ${chat.orderId||'‚Äî'}`; avatarStyle(chat.meta?.performerName||chat.meta?.ownerName||'–ß',$('chatAvatar'));
  const msgs=$('messages'); msgs.innerHTML='';
  (chat.messages||[]).forEach(m=>{
    if(m.from==='system'){ const d=document.createElement('div'); d.className='small'; d.style.textAlign='center'; d.textContent=m.text; msgs.appendChild(d); }
    else if(m.from==='me'){ const d=document.createElement('div'); d.className='msg-row msg-me'; d.innerHTML=`<span class="b">${esc(m.text)}</span>`; msgs.appendChild(d); }
    else { const d=document.createElement('div'); d.className='msg-row msg-other'; d.innerHTML=`<span class="b">${esc(m.text)}</span>`; msgs.appendChild(d); }
  });
  msgs.scrollTop=msgs.scrollHeight;
  const me=Store.getProfile()||{id:'u_demo_user'};
  Store.updateChat(chatId,c=>{ if(!c.unread) c.unread={}; c.unread[me.id]=0; });
  renderChats();

  $('sendMsgBtn').onclick=()=>{
    const v=$('messageInput').value.trim(); if(!v) return;
    const me=Store.getProfile()||{id:'u_demo_user'};
    Store.updateChat(chatId,c=>{
      c.messages.push({from:'me', text:v, ts:nowISO()});
      const otherId=(c.participants||[]).find(p=>p!==me.id);
      if(!c.unread) c.unread={}; if(otherId) c.unread[otherId]=(c.unread[otherId]||0)+1;
    });
    $('messageInput').value=''; openChat(chatId);
  };
  const back=$('chatBack');
  back.style.display=window.matchMedia('(max-width:920px)').matches?'inline-flex':'none';
  back.onclick=()=>{ showChatListOnly(); };
}

/* ADS */
function renderAds(){
  const ads=Store.getAds(); const wrap=$('adsList'); wrap.innerHTML=''; if(!ads.length) wrap.innerHTML='<div class="small" style="padding:12px">–û–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
  ads.forEach(ad=>{
    const card=document.createElement('div'); card.className='card';
    const left=document.createElement('div'); left.style.flex='0 0 56px';
    const av=document.createElement('div'); av.className='avatar'; avatarStyle(ad.authorName||'?',av); left.appendChild(av);
    const body=document.createElement('div'); body.style.flex='1';
    body.innerHTML=`<div style="font-weight:800">${esc(ad.title)}</div><div class="small" style="margin-top:6px">${esc(ad.price?('‚Ç∏ '+ad.price):'')}</div><div style="margin-top:8px">${esc(ad.desc)}</div>`;
    const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px'; actions.style.marginTop='8px';
    const contactBtn=document.createElement('button'); contactBtn.className='btn'; contactBtn.textContent='–°–≤—è–∑–∞—Ç—å—Å—è';
    contactBtn.addEventListener('click',()=>{
      const profile=Store.getProfile()||{id:'u_demo_user', name:'–î–µ–º–æ'};
      const chat={ id:'chat_'+uid(), orderId:null, title:`–û–±—ä—è–≤–ª–µ–Ω–∏–µ: ${ad.title}`, participants:[profile.id, ad.authorId||'u_ad_owner'], meta:{ ownerName:profile.name||'–í—ã', performerName:ad.authorName||'–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å' }, messages:[{from:'system', text:`–ß–∞—Ç —Å–æ–∑–¥–∞–Ω –ø–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—é "${ad.title}"`, ts:nowISO()}], unread:{[profile.id]:0,[ad.authorId||'u_ad_owner']:1} };
      Store.addChat(chat);
      const notif={id:'n_'+uid(), type:'admsg', title:'–ö—Ç–æ-—Ç–æ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª—Å—è –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º', body:`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${profile.name||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'} –Ω–∞–ø–∏—Å–∞–ª –ø–æ –≤–∞—à–µ–º—É –æ–±—ä—è–≤–ª–µ–Ω–∏—é "${ad.title}"`, adId:ad.id, chatId:chat.id, ts:nowISO()};
      const arr=Store.getNotifs(); arr.unshift(notif); Store.setNotifs(arr); refreshNotifBadge();
      openScreen('messengerScreen'); showChatListOnly(); renderChats();
    });
    const phoneBtn=document.createElement('button'); phoneBtn.className='btn'; phoneBtn.textContent='–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç';
    phoneBtn.addEventListener('click',()=>alert(ad.phone?('–¢–µ–ª–µ—Ñ–æ–Ω: '+ad.phone):'–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω'));
    actions.appendChild(contactBtn); actions.appendChild(phoneBtn); body.appendChild(actions);
    card.appendChild(left); card.appendChild(body); wrap.appendChild(card);
  });

  const myAdsWrap=$('myAdsList'); myAdsWrap.innerHTML=''; const profile=Store.getProfile();
  if(profile){
    const my=Store.getAds().filter(a=>a.authorId===profile.id);
    if(!my.length) myAdsWrap.innerHTML='<div class="small" style="padding:12px">–£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>';
    my.forEach(ad=>{
      const card=document.createElement('div'); card.className='card';
      const left=document.createElement('div'); left.style.flex='0 0 56px';
      const av=document.createElement('div'); av.className='avatar'; avatarStyle(ad.authorName||profile.name,av); left.appendChild(av);
      const body=document.createElement('div'); body.style.flex='1';
      body.innerHTML=`<div style="font-weight:800">${esc(ad.title)}</div><div class="small" style="margin-top:6px">${esc(ad.price?('‚Ç∏ '+ad.price):'')}</div><div style="margin-top:8px">${esc(ad.desc)}</div>`;
      const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px'; actions.style.marginTop='8px';
      const edit=document.createElement('button'); edit.className='btn'; edit.textContent='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'; edit.onclick=()=>editAd(ad.id);
      const del=document.createElement('button'); del.className='btn'; del.textContent='–£–¥–∞–ª–∏—Ç—å'; del.onclick=()=>{ if(confirm('–£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?')){ Store.setAds(Store.getAds().filter(x=>x.id!==ad.id)); renderAds(); } };
      actions.appendChild(edit); actions.appendChild(del); body.appendChild(actions);
      card.appendChild(left); card.appendChild(body); myAdsWrap.appendChild(card);
    });
  }else myAdsWrap.innerHTML='<div class="small" style="padding:12px">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—â–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>';
}
$('createAdBtn')?.addEventListener('click',()=>{ const p=Store.getProfile(); if(!p) return alert('–¢–æ–ª—å–∫–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è'); openScreen('adCreateModal'); });
$('adForm').addEventListener('submit',e=>{
  e.preventDefault();
  const title=$('adTitle').value.trim(), desc=$('adDesc').value.trim(), phone=$('adPhone').value.trim(), price=$('adPrice').value.trim();
  if(!title) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
  const profile=Store.getProfile()||{id:'u_demo_user', name:'–î–µ–º–æ'}; const ad={id:'ad_'+uid(), title, desc, phone, price, authorId: profile.id, authorName: profile.name || profile.login, createdAt: nowISO()};
  const arr=Store.getAds(); arr.unshift(ad); Store.setAds(arr);
  alert('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ'); closeScreen('adCreateModal'); renderAds();
});
function editAd(adId){
  const ad=Store.getAds().find(a=>a.id===adId); if(!ad) return;
  openScreen('adCreateModal'); $('adTitle').value=ad.title; $('adDesc').value=ad.desc; $('adPhone').value=ad.phone||''; $('adPrice').value=ad.price||'';
  $('adForm').onsubmit=ev=>{ ev.preventDefault(); ad.title=$('adTitle').value.trim(); ad.desc=$('adDesc').value.trim(); ad.phone=$('adPhone').value.trim(); ad.price=$('adPrice').value.trim(); Store.setAds(Store.getAds().map(x=>x.id===ad.id?ad:x)); alert('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ'); $('adForm').onsubmit=null; closeScreen('adCreateModal'); renderAds(); };
}

/* SETTINGS / PROFILE / WALLET */
$('openNotifications').addEventListener('click',()=>{ openScreen('notificationsModal'); renderNotifs(); });
$('clearNotifications').addEventListener('click',()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?')){ Store.setNotifs([]); renderNotifs(); refreshNotifBadge(); } });

$('openSettings').addEventListener('click',()=>{ openScreen('settingsModal'); $('citySelect').value=Store.getCity()||''; });
document.querySelectorAll('.theme-btn').forEach(btn=>btn.addEventListener('click',()=>{ Store.setTheme(btn.dataset.theme); applyTheme(); }));

$('saveCityBtn').addEventListener('click',()=>{ const v=$('citySelect').value.trim(); if(!v) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥'); Store.setCity(v); updateCityLabel(); alert('–ì–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω'); });
$('openProfile').addEventListener('click',()=>{ openScreen('profileScreen'); renderProfile(); closeScreen('settingsModal'); });

function renderProfile(){
  const wrap=$('profileWrap'); wrap.innerHTML=''; const p=Store.getProfile();
  if(!p){ wrap.innerHTML='<div class="small">–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ</div>'; return; }
  const card=document.createElement('div'); card.className='card';
  const left=document.createElement('div'); left.style.flex='0 0 56px';
  const av=document.createElement('div'); av.className='avatar'; avatarStyle(p.name||p.login,av); left.appendChild(av);
  const body=document.createElement('div'); body.style.flex='1';
  body.innerHTML=`
    <div style="font-weight:800">${esc(p.name||p.login)}</div>
    <div class="small" style="margin-top:6px">${esc(p.login||'')}</div>
    <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
      <label class="btn"><input type="file" id="avatarFile" accept="image/*" style="display:none">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</label>
      <button class="btn" id="avatarEmojiBtn">–≠–º–æ–¥–∑–∏</button>
      <button class="btn" id="logoutBtn">–í—ã–π—Ç–∏</button>
    </div>
    <div style="margin-top:16px; font-weight:800">–ê–Ω–∫–µ—Ç–∞</div>
    <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:8px; margin-top:8px;">
      <input id="pfName" class="input" placeholder="–ò–º—è" value="${esc(p.firstName||'')}">
      <input id="pfSurname" class="input" placeholder="–§–∞–º–∏–ª–∏—è" value="${esc(p.lastName||'')}">
      <input id="pfPhone" class="input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="${esc(p.phone||'')}">
      <input id="pfCity" class="input" placeholder="–ì–æ—Ä–æ–¥" value="${esc(Store.getCity()||'')}">
    </div>
    <div style="margin-top:10px; display:flex; gap:8px;">
      <button class="btn primary" id="saveProfileBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>`;
  card.appendChild(left); card.appendChild(body); wrap.appendChild(card);

  $('avatarFile').addEventListener('change',e=>{ const f=e.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ const prof=Store.getProfile(); prof.avatarType='image'; prof.avatarData=r.result; Store.setProfile(prof); renderProfile(); }; r.readAsDataURL(f); });
  $('avatarEmojiBtn').addEventListener('click',()=>{ const emo=prompt('–í–≤–µ–¥–∏—Ç–µ —ç–º–æ–¥–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, üòé)'); if(!emo) return; const prof=Store.getProfile(); prof.avatarType='emoji'; prof.avatarData=emo; Store.setProfile(prof); renderProfile(); });
  $('logoutBtn').addEventListener('click',()=>{ if(confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')){ localStorage.removeItem(LS_PROFILE); closeScreen('profileScreen'); openScreen('authScreen'); }});
  $('saveProfileBtn').addEventListener('click',()=>{ const prof=Store.getProfile(); prof.firstName=$('pfName').value.trim(); prof.lastName=$('pfSurname').value.trim(); prof.phone=$('pfPhone').value.trim(); const city=$('pfCity').value.trim(); if(city){ Store.setCity(city); updateCityLabel(); } prof.name=prof.firstName?prof.firstName:prof.name; Store.setProfile(prof); alert('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω'); renderProfile(); });
}

/* WALLET */
function renderWallet(){
  const wrap=$('walletWrap'); const w=Store.getWallet(); const p=Store.getProfile();
  wrap.innerHTML=`<div class="card"><div style="flex:1">
    <div style="font-weight:800; font-size:18px;">–ë–∞–ª–∞–Ω—Å: ‚Ç∏ ${Number(w.balance||0).toLocaleString('ru-RU')}</div>
    <div class="small" style="margin-top:6px">${esc(p?.name||p?.login||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å')}</div>
    <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
      <button class="btn" id="wTopUp">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
      <button class="btn" id="wTransfer">–ü–µ—Ä–µ–≤–æ–¥</button>
      <button class="btn" id="wWithdraw">–°–Ω—è—Ç—å</button>
    </div></div></div>
    <div style="margin-top:12px; font-weight:800">–û–ø–µ—Ä–∞—Ü–∏–∏</div>
    <div id="opsList" style="margin-top:8px;"></div>`;
  const opsList=$('opsList');
  if(!w.ops?.length){ opsList.innerHTML='<div class="small" style="padding:12px">–ü–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>'; }
  else{
    w.ops.slice(0,100).forEach(op=>{ const row=document.createElement('div'); row.className='card'; row.innerHTML=`<div style="flex:1"><div style="font-weight:800">${esc(op.type)} ‚Ä¢ ‚Ç∏ ${Number(op.amount).toLocaleString('ru-RU')}</div><div class="small" style="margin-top:6px">${new Date(op.ts).toLocaleString()} ‚Äî ${esc(op.note||'')}</div></div>`; opsList.appendChild(row); });
  }
  $('wTopUp').onclick=()=>{ const amt=Number(prompt('–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (‚Ç∏):','1000')||0); if(amt<=0)return; const w=Store.getWallet(); w.balance=(w.balance||0)+amt; (w.ops||(w.ops=[])).unshift({type:'–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ',amount:amt,ts:nowISO(),note:'–í–Ω–µ—Å–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤'}); Store.setWallet(w); renderWallet(); };
  $('wTransfer').onclick=()=>{ const to=prompt('–ü–æ–ª—É—á–∞—Ç–µ–ª—å (–ª–æ–≥–∏–Ω/ID):','u_...'); if(!to)return; const amt=Number(prompt('–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (‚Ç∏):','500')||0); if(amt<=0)return; const w=Store.getWallet(); if((w.balance||0)<amt){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; } w.balance-=amt; (w.ops||(w.ops=[])).unshift({type:'–ü–µ—Ä–µ–≤–æ–¥',amount:amt,ts:nowISO(),note:`–ü–æ–ª—É—á–∞—Ç–µ–ª—å: ${to}`}); Store.setWallet(w); const notif={id:'n_'+uid(), type:'wallet', title:'–ü–µ—Ä–µ–≤–æ–¥ –ø–æ–ª—É—á–µ–Ω', body:`–í–∞–º –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ ‚Ç∏ ${amt} (${to})`, ts:nowISO()}; const arr=Store.getNotifs(); arr.unshift(notif); Store.setNotifs(arr); refreshNotifBadge(); renderWallet(); };
  $('wWithdraw').onclick=()=>{ const amt=Number(prompt('–°—É–º–º–∞ —Å–Ω—è—Ç–∏—è (‚Ç∏):','500')||0); if(amt<=0)return; const w=Store.getWallet(); if((w.balance||0)<amt){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; } w.balance-=amt; (w.ops||(w.ops=[])).unshift({type:'–°–Ω—è—Ç–∏–µ',amount:amt,ts:nowISO(),note:'–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤'}); Store.setWallet(w); renderWallet(); };
}

/* CREATE ORDER */
document.querySelectorAll('#createTabs .tab').forEach(t=>t.addEventListener('click',()=>{ document.querySelectorAll('#createTabs .tab').forEach(x=>x.classList.remove('active')); t.classList.add('active'); $('selectedCategory').textContent=t.dataset.val||t.textContent; }));
$('createForm').addEventListener('submit',e=>{
  e.preventDefault();
  const profile=Store.getProfile(); if(!profile){ alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ'); openScreen('authScreen'); return; }
  const category=document.querySelector('#createTabs .tab.active')?.dataset.val||'–î—Ä—É–≥–æ–µ';
  const desc=$('c-desc').value.trim(); const budget=Number($('c-budget').value||0); const datetime=$('c-datetime').value||'';
  if(!desc||!datetime){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –¥–∞—Ç—É'); return; }
  const order={id:'o_'+uid(), category, desc, budget, datetime, city:Store.getCity()||'‚Äî', ownerId:profile.id, ownerName:profile.name||profile.login, bids:[], status:'open', createdAt:nowISO()};
  Store.addOrder(order);
  const notif={id:'n_'+uid(), type:'created', title:'–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω', body:`–í–∞—à –∑–∞–∫–∞–∑ "${category}" –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω`, orderId:order.id, ts:nowISO()};
  const arr=Store.getNotifs(); arr.unshift(notif); Store.setNotifs(arr); refreshNotifBadge();
  closeScreen('createScreen'); renderMineList(); renderFindList(); alert('–ó–∞–∫–∞–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω');
});

/* INITIAL & AUTH */
function initial(){
  applyTheme();
  if(!Store.getRole()) Store.setRole('user');
  updateCityLabel(); refreshNotifBadge();
  applyRoleUI(); renderFindList(); renderMineList(); renderAds(); renderNotifs(); renderChats();
  if(!Store.getProfile()) openScreen('authScreen');
}
initial();
$('authForm').addEventListener('submit',e=>{
  e.preventDefault();
  const login=$('authLogin').value.trim(), pass=$('authPass').value.trim(); if(!login||!pass) return alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ');
  const prof={id:'u_'+uid(), login, name:login.split('@')[0]||login, createdAt:nowISO()}; Store.setProfile(prof);
  alert('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω'); closeScreen('authScreen'); renderProfile(); initial();
});
$('registerBtn').addEventListener('click',()=>{ const email=prompt('Email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:','user@example.com'); if(!email) return; const prof={id:'u_'+uid(), login:email, name:email.split('@')[0]||email, createdAt:nowISO()}; Store.setProfile(prof); alert('–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ'); closeScreen('authScreen'); initial(); });

/* MAIN BUTTONS */
$('btnOrder').addEventListener('click',()=>{ const role=Store.getRole()||'user'; if(role!=='user'){ alert('–¢–æ–ª—å–∫–æ –¥–ª—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–º–µ–Ω–∏—Ç–µ —Ä–æ–ª—å –ø–æ–ª–∑—É–Ω–∫–æ–º –≤—ã—à–µ.'); return; } openScreen('createScreen'); });
$('btnFind').addEventListener('click',()=>{ const role=Store.getRole()||'user'; if(role!=='worker'){ alert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é.'); return; } openScreen('findScreen'); renderFindList(); });
$('btnMessenger').addEventListener('click',()=>{ openScreen('messengerScreen'); showChatListOnly(); renderChats(); });
$('btnWallet').addEventListener('click',()=>{ openScreen('walletScreen'); renderWallet(); });
$('btnMine').addEventListener('click',()=>{ openScreen('mineScreen'); renderMineList(); });
$('btnAds').addEventListener('click',()=>{ openScreen('adsScreen'); renderAds(); });

/* ROLE TOGGLE */
$('roleToggle').addEventListener('click',()=>{ const role=Store.getRole()||'user'; const next=role==='user'?'worker':'user'; animateRole(next); });

/* expose for debug */
window.renderFindList=renderFindList; window.renderMineList=renderMineList; window.renderAds=renderAds; window.renderChats=renderChats; window.openBidsModal=openBidsModal;
</script>
</body>
</html>
